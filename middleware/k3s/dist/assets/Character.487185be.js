var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{_ as l}from"./SubmitButton.99d990fd.js";import{_ as d}from"./BaseStencil.46c3d678.js";import{_ as m}from"./BaseForm.bc55ad6b.js";import{_ as n}from"./BaseTable.36f55649.js";import{o as c,a as u,b as p,e as b}from"./index.21c3d30d.js";import{d as f,_ as g}from"./element-plus.b44d97a8.js";import{d as h}from"./public.9c1d8f39.js";import{g as j}from"./formRule.f80f9ec7.js";import{e as y}from"./element-resize-detector.5b0b5621.js";import{u as k,m as v}from"./vuex.c868d4e0.js";import{_ as F}from"./lodash.d7ab6f48.js";import{g as w,h as C,j as x,G as D,n as _,t as V,q as P,B as z,L as O,o as T,a5 as B,J as N,e as E,w as L,c as A,a6 as I,v as S,S as U}from"./@vue.23a4bd1a.js";import{_ as H}from"./index.ab904951.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./verification.ecddc814.js";import"./batch-processor.94093b2a.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var M={name:"Character",components:{BaseTable:n,SubmitButton:l,BaseForm:m},setup(){const e=k(),l=w(null),d=v("common",["menus","info","tabs","tabActive"]),m=C(d.menus.bind({$store:e}));C(d.info.bind({$store:e}));const n=C((()=>F.find(m.value,{name:"Layout"}).children)),z=x({loading:!0,defaultCheck:[],defaultProps:{label:(e,a)=>e.meta.label},drawer:!1,height:null,uuid:"",isEdit:!1,addFormData:{},submitForm:{"page.currentPage":1,"page.pageSize":10},formData:{inline:!1,labelWidth:"110px",config:{size:"medium"},list:[{label:"角色名称",type:"INPUT",key:"roleName",placeholder:"请输入",rules:j("Input","角色名称"),config:{"show-word-limit":!0,maxlength:20}},{label:"描述",type:"INPUT",placeholder:"请输入",key:"description",config:{"show-word-limit":!0,type:"textarea",maxlength:100,autosize:{minRows:2}}}]},tableData:[],columns:[{type:"index",title:"序号",formConfig:{width:50}},{title:"角色名称",key:"roleName"},{title:"描述",key:"description"},{title:"最新更新时间",key:"updateTime",width:180},{title:"状态",key:"state",render:e=>1==e.state?"启用":"禁用"},{title:"操作",key:"options",render:e=>{let a=[{type:"text",innerHTML:"编辑",onClick:()=>{z.isEdit=!0,z.dialogFormVisible=!0,z.uuid=e.uuid,z.addFormData={roleName:e.roleName,description:e.description}}},{type:"text",innerHTML:1===e.state?"禁用":"启用",onClick:()=>{let a=1==e.state?"禁用":"启用";h({msg:`确定要${a}该角色吗?`,callback:()=>{c(e.uuid).then((e=>{O()}))}})}},{type:"text",innerHTML:"权限",show:2===e.state,onClick:()=>{let a=n.value.filter((a=>"系统管理员"===e.roleName||F.intersection([e.roleName],a.show).length?a:null));z.defaultCheck=a.map((e=>e.name)),z.drawer=!0}}];return D("div",a.map((e=>{if(!e.show)return D(f,e)})))}}],dialogFormVisible:!1,formLabelWidth:"90px"}),O=async()=>{let e=z.submitForm,{total:a}=e,t=((e,a)=>{var t={};for(var i in e)r.call(e,i)&&a.indexOf(i)<0&&(t[i]=e[i]);if(null!=e&&o)for(var i of o(e))a.indexOf(i)<0&&s.call(e,i)&&(t[i]=e[i]);return t})(e,["total"]);p(t).then((e=>{z.submitForm.total=e.totalCount,z.tableData=e.list,z.loading=!1}))};return _((()=>{(()=>{const e=y();setTimeout((()=>{e.listenTo(document.getElementById("tab"),(e=>{P((()=>{z.height=e.offsetHeight-130}))}))}),200)})(),O()})),T=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&i(e,t,a[t]);if(o)for(var t of o(a))s.call(a,t)&&i(e,t,a[t]);return e})({},V(z)),a(T,t({characterListPage:O,toAddCharacter:()=>{z.dialogFormVisible=!0,z.isEdit=!1},subAdd:async()=>{await l.value.verification()&&u(z.addFormData).then((e=>{z.dialogFormVisible=!1,z.addFormData={},g({type:"success",message:"添加成功"}),O()}))},addForm:l,subEdit:async()=>{let e={uuid:z.uuid,description:z.addFormData.description,roleName:z.addFormData.roleName};b(e).then((e=>{z.dialogFormVisible=!1,z.addFormData={},g({type:"success",message:"修改成功"}),O()}))},cancleAdd:()=>{z.dialogFormVisible=!1,z.addFormData={}},closeDialog:()=>{z.addFormData={}},menus:n}));var T}};const $={class:"character"},R=U(" 新增 "),W={class:"dialog-footer"},q=U("取 消"),G=U("确定"),J=U("确定");var K=H(M,[["render",function(e,a,t,o,r,s){const i=l,n=d,c=m,u=z("el-button"),p=z("el-dialog"),b=z("el-tree"),f=z("el-scrollbar"),g=z("el-drawer"),h=O("loading");return T(),B("div",$,[N(E(n,{class:"base-stencil","table-data":e.tableData,columns:e.columns,"submit-form":e.submitForm,"onUpdate:submit-form":a[0]||(a[0]=a=>e.submitForm=a),pagination:e.submitForm,select:o.characterListPage,draggable:!1,ref:"table"},{buttons:L((()=>[E(i,{size:"small",class:"addBtn",onClick:o.toAddCharacter},{default:L((()=>[R])),_:1},8,["onClick"])])),_:1},8,["table-data","columns","submit-form","pagination","select"]),[[h,e.loading]]),e.dialogFormVisible?(T(),A(p,{key:0,title:e.isEdit?"编辑角色管理":"新增角色管理",modelValue:e.dialogFormVisible,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dialogFormVisible=a),width:"420px",onClose:o.closeDialog},{footer:L((()=>[I("span",W,[E(u,{size:"small",onClick:o.cancleAdd},{default:L((()=>[q])),_:1},8,["onClick"]),e.isEdit?(T(),A(i,{key:1,size:"small",onClick:o.subEdit},{default:L((()=>[J])),_:1},8,["onClick"])):(T(),A(i,{key:0,size:"small",onClick:o.subAdd},{default:L((()=>[G])),_:1},8,["onClick"]))])])),default:L((()=>[E(c,{"form-data":e.formData,"submit-form":e.addFormData,"onUpdate:submit-form":a[1]||(a[1]=a=>e.addFormData=a),style:{"margin-top":"30px"},ref:"addForm"},null,8,["form-data","submit-form"])])),_:1},8,["title","modelValue","onClose"])):S("",!0),e.drawer?(T(),A(g,{key:1,modelValue:e.drawer,"onUpdate:modelValue":a[3]||(a[3]=a=>e.drawer=a),title:"权限管理"},{default:L((()=>[E(f,null,{default:L((()=>[E(b,{data:o.menus,"show-checkbox":"","node-key":"name",props:e.defaultProps,"default-checked-keys":e.defaultCheck},null,8,["data","props","default-checked-keys"])])),_:1})])),_:1},8,["modelValue"])):S("",!0)])}],["__scopeId","data-v-223a7b84"]]);export{K as default};
