var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,s=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))r.call(t,a)&&o(e,a,t[a]);return e},m=(e,i)=>t(e,a(i));import{_ as d}from"./BaseStencil.46c3d678.js";import{_ as u}from"./EditForm.8c35f1a6.js";import{e as p,S as n,g as b,j as c,D as f,t as g,B as y,o as h,a5 as v,w as j,a6 as w}from"./@vue.23a4bd1a.js";import{d as x}from"./index.7c4fa9df.js";import{u as F}from"./vuex.c868d4e0.js";import{a as k}from"./index.f5db11a4.js";import{g as S,f as E}from"./filter.c2c8f0b9.js";import{_ as T}from"./index.ab904951.js";import{a as C}from"./axios.7b768d2b.js";import{s as N}from"./businessRule.60794e55.js";import{_ as U}from"./lodash.d7ab6f48.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./dayjs.bad04745.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";function D(e,t,a){return{dialogForm:{labelWidth:"80px",inline:!0,list:[{label:"门店",type:"SELECT-BASE",config:{style:{width:"160px"}},placeholder:"请选择",key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>t.value,require:!0},{label:"日期",type:"DATEPICKER",key:"date",require:!0,placeholder:"请选择",config:{"value-format":"YYYY-MM-DD"}},{label:"时段",type:"SELECT-BASE",config:{style:{width:"160px"}},placeholder:"请选择",key:"timeInterval",list:()=>[{label:"上午",value:"上午"},{label:"下午",value:"下午"}],require:!0},{label:"区域",type:"SELECT-BASE",config:{style:{width:"160px"}},placeholder:"请选择",key:"area",list:()=>[{label:"常温区",value:"常温区"},{label:"阴凉区",value:"阴凉区"},{label:"冷藏区",value:"冷藏区"}],require:!0},{label:"温度",type:"INPUT",key:"temperatureOld",require:!0,suffix:{tempHtml:()=>p("div",{style:"margin-right: 10px;font-size: 14px;color: #313233;"},[n("℃")])},rules:[{required:!0,trigger:"blur",pattern:/^(\-|\+)?\d+(\.\d+)?$/}]},{label:"湿度",type:"INPUT",key:"humidityOld",require:!0,suffix:{tempHtml:()=>p("div",{style:"margin-right: 10px;font-size: 14px;color: #313233;"},[n("%")])},rules:[{required:!0,trigger:"blur",pattern:/^(\-|\+)?\d+(\.\d+)?$/}]},{label:"调控措施",type:"SELECT-BASE",config:{style:{width:"160px"},multiple:!0},placeholder:"请选择",key:"step",list:()=>[{label:"降温",value:"降温"},{label:"除湿",value:"除湿"},{label:"增温",value:"增温"},{label:"增湿",value:"增湿"},{label:"无需调控",value:"无需调控"}],require:!0},{label:"措施后温度",type:"INPUT",key:"temperatureNew",suffix:{tempHtml:()=>p("div",{style:"margin-right: 10px;font-size: 14px;color: #313233;"},[n("℃")])},rules:[{trigger:"blur",pattern:/^(\-|\+)?\d+(\.\d+)?$/}]},{label:"措施后湿度",type:"INPUT",key:"humidityNew",suffix:{tempHtml:()=>p("div",{style:"margin-right: 10px;font-size: 14px;color: #313233;"},[n("%")])},rules:[{trigger:"blur",pattern:/^(\-|\+)?\d+(\.\d+)?$/}]}]},form:{inline:!0,labelWidth:"100px",list:[{label:"",type:"LINKAGETIME",keys:["date.start","date.end"],design:{width:"240px"},config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"},key:""},{placeholder:"请选择时段",type:"SELECT",key:"timeInterval",list:()=>[{label:"上午",value:"上午"},{label:"下午",value:"下午"}]},{placeholder:"请选择区域",type:"SELECT",key:"area",list:()=>[{label:"常温区",value:"常温区"},{label:"阴凉区",value:"阴凉区"},{label:"冷藏区",value:"冷藏区"}]},{label:"",type:"SELECT",placeholder:"请选择门店",key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>t.value}]},tableConfig:{columns:[{title:"序号",type:"index",formConfig:{width:50},fixed:"left"},{title:"单据编号",key:"humitureNo"},{title:"日期",key:"date"},{title:"时段",key:"timeInterval"},{title:"区域",key:"area"},{title:"温度",key:"temperatureOld"},{title:"湿度",key:"humidityOld"},{title:"调控措施",key:"step"},{title:"措施后温度",key:"temperatureNew"},{title:"措施后湿度",key:"humidityNew"},{title:"创建人",key:"creator",width:76},{title:"门店",key:"business",width:100}]}}}var z={name:"TemperatureRecord",setup(e,t){const a=F(),i=new Date;let l=S(i,30,!0);b(null);const r=b([]),o=c({editForm:null,dialogVisible:!1,loading:!1,tableData:[],deepSearchTable:D(0,r),submitForm:{"page.currentPage":1,"page.pageSize":10,"date.start":l[0],"date.end":E(new Date),businessUuid:""},dialogSubmitForm:{date:E(new Date)},columns:[]}),d=()=>{var e;o.loading=!0,(e=o.submitForm,C.get("/gateway/chain-store/humiture/find/page",{params:e})).then((e=>{o.submitForm.currentPage=e.currentPage,o.submitForm.pageSize=e.pageSize,o.tableData=e.records,o.submitForm.total=e.total,o.loading=!1}))};f((async()=>{const e=await k();r.value=e,o.submitForm.businessUuid=e[0].uuid,d()}));return m(s({},g(o)),{getList:d,findList:r,exportExcel:async()=>{let{storeUuid:e}=a.state.common.info,t=await a.dispatch("common/mechanism"),i="";i=o.submitForm.businessUuid.length?N(o.submitForm.businessUuid):t.map((e=>e.uuid)).join(",");let l=x("/gateway/chain-store/humiture/exportHumiture",m(s({},o.submitForm),{storeUuid:e,businessUuid:i}));window.open(l,"_self")},cancelPointRatio:()=>{o.dialogVisible=!1,o.dialogSubmitForm={}},beforeDialogClose:e=>{o.dialogSubmitForm={},o.editForm.resetFields(),o.editForm.form.resetFields(),e()},oppenDialog:()=>{o.dialogSubmitForm={},o.dialogVisible=!0,o.dialogSubmitForm.date=E(new Date),o.dialogSubmitForm.businessUuid=r.value[0].uuid},addTemperature:async e=>{let t=U.cloneDeep(e);if(o.editForm.handleClick(t)){t.temperatureOld+="℃",t.humidityOld+="%",t.step=t.step.toString(),null==t.temperatureNew||null==t.temperatureNew?delete t.temperatureNew:t.temperatureNew+="℃",null===t.humidityNew||void 0===t.humidityNew?delete t.humidityNew:t.humidityNew+="%";let e=s({},t);(a=e,C.post("/gateway/chain-store/humiture/insert",a)).then((()=>{o.dialogVisible=!1,d()}))}var a}})}};const O={class:"supplier"},P=n(" 新增 "),_=n(" 导出 "),I={class:"dialogFoot"},L=n("取 消"),q=n("确 定");var V=T(z,[["render",function(e,t,a,i,l,r){const o=y("el-button"),s=d,m=u,n=y("el-dialog");return h(),v("div",O,[p(s,{"form-data":e.deepSearchTable.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.deepSearchTable.tableConfig.columns,pagination:e.submitForm,options:!0,optionShow:!1,ref:"form",select:i.getList,loading:e.loading},{buttons:j((()=>[p(o,{style:{"margin-bottom":"10px"},size:"small",type:"primary",onClick:i.oppenDialog},{default:j((()=>[P])),_:1},8,["onClick"]),p(o,{style:{"margin-bottom":"10px"},size:"small",plain:"",type:"primary",onClick:i.exportExcel},{default:j((()=>[_])),_:1},8,["onClick"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select","loading"]),p(n,{title:"新增温湿度记录",modelValue:e.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialogVisible=t),width:"300px","before-close":i.beforeDialogClose},{footer:j((()=>[w("div",I,[p(o,{size:"small",onClick:i.cancelPointRatio},{default:j((()=>[L])),_:1},8,["onClick"]),p(o,{size:"small",type:"primary",onClick:t[3]||(t[3]=t=>i.addTemperature(e.dialogSubmitForm))},{default:j((()=>[q])),_:1})])])),default:j((()=>[p(m,{"form-data":e.deepSearchTable.dialogForm,"onUpdate:form-data":t[1]||(t[1]=t=>e.deepSearchTable.dialogForm=t),"submit-form":e.dialogSubmitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.dialogSubmitForm=t),ref:"editForm"},null,8,["form-data","submit-form"])])),_:1},8,["modelValue","before-close"])])}],["__scopeId","data-v-5e26a8b6"]]);export{V as default};
