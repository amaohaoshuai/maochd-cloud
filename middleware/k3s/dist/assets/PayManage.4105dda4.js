var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,r=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&s(e,a,t[a]);if(i)for(var a of i(t))l.call(t,a)&&s(e,a,t[a]);return e};import{_ as n}from"./BaseStencil.46c3d678.js";import{_ as m}from"./BaseForm.bc55ad6b.js";import{j as p,e as d,J as u,Q as b,S as c,B as f,D as y,n as g,t as h,o as j,a5 as v,w as F,a6 as x}from"./@vue.23a4bd1a.js";import{c as C,d as w,e as k,f as T,h as V,i as P}from"./index.6037074b.js";import{u as O}from"./vuex.c868d4e0.js";import{_ as z}from"./index.ab904951.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var _={name:"PayManage",setup(e,s){const n=O(),m=p({isClear:!1,loading:!1,tableData:[],findOgList:[],baseForm:null,submitForm:{"page.currentPage":1,"page.pageSize":10,mechanismUuid:[]},pointsBaseForm:null,enterForm:{},pointsEnterForm:{purchaseDay:""},pointsVisible:!1,dialogVisible:!1,title:"",pointsTitle:"积分抵现配置",form:{inline:!0,labelWidth:"100px",list:[{placeholder:"付款方式",type:"INPUT",key:"payType"},{type:"SELECT",placeholder:"状态",key:"state",props:{label:"label",value:"value"},list:()=>[{label:"启用",value:1},{label:"禁用",value:2}]},{type:"SELECT",placeholder:"支付配置",key:"paymentConfig",props:{label:"label",value:"value"},list:()=>[{label:"未配置",value:0},{label:"已配置",value:1}]}]},columns:[{type:"index",title:"序号",width:52},{title:"付款方式",key:"payType",width:110,render:e=>[d("div",{type:"text",style:"color:#606266;display:flex;align-items:center"},[e.payType,u(d("div",{className:"msgColor",style:"color:#ffffff;background-color:#F5AD40;font-size:12px;margin-left:10px;width:28px;height:16px;line-height:16px;text-align:center;border-radius:2px;"},[c("默认")]),[[b,1===e.isDefault]])])]},{title:"状态",key:"state",width:80,render:e=>1==e.state?"启用":"禁用"},{title:"支付配置",key:"paymentConfig",width:80,render:e=>1==e.paymentConfig?"已配置":"未配置"},{title:"创建时间",width:180,key:"createTime"},{title:"备注",key:"remark"},{title:"操作",key:"options",width:200,render:e=>[u(d(f("el-button"),{type:"text",onClick:t=>{F(e.uuid)}},{default:()=>[0==e.isDefault?"设置默认":"取消默认"]}),[[b,!(7==e.payTypeId||2==e.payTypeId)]]),u(d(f("el-button"),{type:"text",onClick:t=>{m.pointsVisible=!0,m.pointsEnterForm.uuid=e.uuid,m.pointsEnterForm.deductRatio=n.state.common.points}},{default:()=>[c("配置")]}),[[b,7==e.payTypeId]]),d(f("el-button"),{type:"text",onClick:t=>{j(e.uuid)}},{default:()=>[1==e.state?"禁用":"启用"]}),u(d(f("el-button"),{type:"text",style:"color:#F56C6C",onClick:t=>{v(e.uuid)}},{default:()=>[c("删除")]}),[[b,1!=e.isFinal]])]}],formData:{inline:!0,labelWidth:"100px",list:[{type:"INPUT",placeholder:"请输入",key:"payType",label:"付款方式",rules:[{required:!0,message:"请输入付款方式",trigger:"blur"}],design:{width:"350px"}},{type:"INPUT",placeholder:"请输入不超过100字",key:"remark",rows:10,label:"备注",design:{width:"414px"},config:{maxlength:100,type:"textarea",autosize:{minRows:2},"show-word-limit":!0}}]},pointsForm:{inline:!0,labelWidth:"120px",list:[{type:"NUMBER-INPUT",placeholder:"请输入",label:"积分抵现比例",key:"deductRatio",design:{width:"80px"},config:{min:.01},precision:2,add2:'<span style="margin-left:4px;">积分=1元<span>',rules:[{required:!0,message:"请输入积分抵现比例",trigger:"blur"}]}]}});const j=async e=>{await C(e),x()},v=async e=>{try{await w(e),x()}catch(t){return t}},F=async e=>{await k(e),x()},x=()=>{let e=((e,t)=>{var a={};for(var s in e)o.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&i)for(var s of i(e))t.indexOf(s)<0&&l.call(e,s)&&(a[s]=e[s]);return a})(m.submitForm,[]),t=r({},e);T(t).then((e=>{m.submitForm.currentPage=e.currentPage,m.submitForm.pageSize=e.pageSize,m.tableData=e.list,m.submitForm.total=e.totalElements}))};return y((async()=>{const e=await n.dispatch("common/mechanism");m.findOgList=e,x()})),g((()=>{})),z=r({},h(m)),t(z,a({addMsg:function(){m.title="新增支付",m.dialogVisible=!0,m.enterForm.mechanismUuid=m.findOgList[0].uuid},getList:x,onChangeState:j,handleSubmit:function(){m.baseForm.verification().then((e=>{e&&V(m.enterForm).then((e=>{m.dialogVisible=!1,x(),m.enterForm={}})).finally((()=>{m.loading=!1}))}))},handleClose:function(e){m[e].handleRest()},setPoints:async e=>{if(await m.pointsBaseForm.verification()){let t={deductRatio:e.deductRatio,paymentManagementUuid:e.uuid};P(t).then((t=>{m.pointsVisible=!1,n.commit("common/POINTS",e.deductRatio),x()}))}}}));var z}};const E={class:"supplier"},U=c("新增"),S={class:"dialog-footer"},D=c("取 消"),I=c("确 定"),B=c(" //积分抵现配置弹窗 "),R={class:"dialog-footer"},L=c("取 消"),N=c("确 定");var M=z(_,[["render",function(e,t,a,i,o,l){const s=f("el-button"),r=n,p=m,u=f("el-dialog");return j(),v("div",E,[d(r,{"form-data":e.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.columns,pagination:e.submitForm,options:!0,select:i.getList,isClear:e.isClear},{buttons:F((()=>[d(s,{type:"primary",size:"small",onClick:i.addMsg},{default:F((()=>[U])),_:1},8,["onClick"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select","isClear"]),d(u,{title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialogVisible=t),width:"600px",onClose:t[5]||(t[5]=e=>i.handleClose("baseForm"))},{footer:F((()=>[x("span",S,[d(s,{size:"small",onClick:t[2]||(t[2]=t=>e.dialogVisible=!1)},{default:F((()=>[D])),_:1}),d(s,{type:"primary",size:"small",loading:e.loading,onClick:t[3]||(t[3]=e=>i.handleSubmit())},{default:F((()=>[I])),_:1},8,["loading"])])])),default:F((()=>[d(p,{"form-data":e.formData,"submit-form":e.enterForm,"onUpdate:submit-form":t[1]||(t[1]=t=>e.enterForm=t),style:{"margin-top":"30px"},ref:"baseForm"},null,8,["form-data","submit-form"])])),_:1},8,["title","modelValue"]),B,d(u,{title:e.pointsTitle,modelValue:e.pointsVisible,"onUpdate:modelValue":t[9]||(t[9]=t=>e.pointsVisible=t),width:"450px",onClosed:t[10]||(t[10]=e=>i.handleClose("pointsBaseForm"))},{footer:F((()=>[x("span",R,[d(s,{size:"small",onClick:t[7]||(t[7]=t=>e.pointsVisible=!1)},{default:F((()=>[L])),_:1}),d(s,{type:"primary",size:"small",loading:e.loading,onClick:t[8]||(t[8]=t=>i.setPoints(e.pointsEnterForm))},{default:F((()=>[N])),_:1},8,["loading"])])])),default:F((()=>[d(p,{"form-data":e.pointsForm,"submit-form":e.pointsEnterForm,"onUpdate:submit-form":t[6]||(t[6]=t=>e.pointsEnterForm=t),ref:"pointsBaseForm"},null,8,["form-data","submit-form"])])),_:1},8,["title","modelValue"])])}],["__scopeId","data-v-9b0914d0"]]);export{M as default};
