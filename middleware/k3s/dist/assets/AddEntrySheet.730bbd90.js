var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{_ as n}from"./BaseTable.36f55649.js";import{_ as o}from"./SelectTable.80e1f2f6.js";import{_ as d}from"./KeyBoard.96ba8d0b.js";import{_ as u}from"./BaseCard.46de0c24.js";import{g as p,h as c}from"./index.817e3859.js";import{b as m,u as b}from"./vue-router.91336ba9.js";import{_ as f}from"./element-plus.b44d97a8.js";import{_ as g}from"./lodash.d7ab6f48.js";import{d as y}from"./public.9c1d8f39.js";import{j as v,G as h,e as j,S as k,B as w,D as N,t as _,o as T,c as x,w as z,a6 as C,z as O,a9 as A,aa as R}from"./@vue.23a4bd1a.js";import{_ as S}from"./index.ab904951.js";import"./sortablejs.621e50ab.js";import"./vuex.c868d4e0.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var q={name:"AddEntrySheet",setup(){const e=m();b(),v({});const n=v({selectTable:null,batchHeader:["编码","品名","剂型","规格","生产厂家"],close:!1,go:{path:"/storage/inventory-entry-sheet",query:e.query},submitForm:{},baseTable:null,columns:[{title:"序号",type:"index",formConfig:{width:50}},{title:"商品编码",key:"code"},{title:"商品名称",key:"productName",width:180,formConfig:{"show-overflow-tooltip":!1}},{title:"批号",key:"batchNum"},{title:"生产日期",key:"producedTime"},{title:"有效期至",key:"indate"},{title:"库存数量",key:"deleavePackNum",width:100,align:"right",render:e=>h("div",[h("span",{innerText:e.overallPackNum}),h("span",{class:"unit",innerText:e.unit}),e.isSplit?h("div",[h("span",{innerText:e.deleavePackNum}),h("span",{class:"unit",innerText:e.splitUnit})]):""])},{title:"实盘整装数量",require:!0,header:()=>j("div",{class:"table-title"},[j("i",null,[k("*")]),k("实盘整装数量")]),key:"overallRealNum",width:120,render:(e,a,t,l)=>j("div",{class:"unit"},[j(w("el-input-number"),{class:e[`overallRealNum_${l}`],controls:!1,size:"medium","model-value":null===e.overallRealNum?void 0:e.overallRealNum,onChange:a=>{e.overallRealNum=a},min:0,max:999999.999999},null),j("i",null,[e.unit])])},{title:"实盘拆零数量",key:"deleaveRealNum",require:!0,header:()=>j("div",{class:"table-title"},[j("i",null,[k("*")]),k("实盘拆零数量")]),judgment:e=>e.isSplit,width:120,render:(e,a,t,l)=>e.isSplit?j("div",{class:"unit"},[j(w("el-input-number"),{class:e[`deleaveRealNum_${l}`],size:"medium",controls:!1,"model-value":null===e.deleaveRealNum?void 0:e.deleaveRealNum,onChange:a=>{e.deleaveRealNum=a},min:0,max:999999.999999},null),j("i",null,[e.splitUnit])]):"-"},{title:"柜组",key:"cabinetGroupName"},{title:"操作",key:"options",render:(e,a,t,l)=>j(w("el-button"),{type:"text",class:"delete",onClick:()=>{n.data.splice(l,1),n.pot=l}},{default:()=>[k("删除")]})}],data:[],selectArr:[],keys:["code","productName","dosageForm","specification","manufacturer"],pot:-1,pagination:{page:1,size:10,total:100}}),o=e=>{let{uuid:a}=e;g.find(n.data,{uuid:a});let{list:t}=g.cloneDeep(e);t.forEach((e=>{let{uuid:a}=e;g.find(n.data,{uuid:a})||n.data.push(e)})),n.pot=n.data.length-t.length,n.selectTable.ending(),n.selectArr=[]};return N((()=>{n.selectArr=[],n.submitForm=e.query})),d=((e,a)=>{for(var t in a||(a={}))r.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))i.call(a,t)&&s(e,t,a[t]);return e})({},_(n)),a(d,t({handleInput:async a=>{n.selectArr=await p({inventoryUuid:e.query.uuid,fuzzyValue:a}),1===n.selectArr.length?o(n.selectArr[0]):(n.selectArr=n.selectArr,n.selectLoading=!1)},handleChange:o,handleSubmit:async()=>{let a=!0,{data:t,baseTable:l}=n;if(t.length||(f.warning({message:"请添加商品信息",type:"warning"}),a=!1),t.length&&(a=l.verification()),!a)return!1;y({msg:"完成后，本次录入的实盘数量会增加至盘点任务中，此张录入单将不可再次进行修改，如需调整数量，可在盘点任务中编辑商品数量。",callback:async()=>{await c({details:t,inventoryUuid:e.query.uuid}),n.close=!0}})},clearMsg:()=>{n.selectArr=[]},delTable:e=>{let a=n.pagination.page-1;a=10*a+e,n.data.splice(a,1),n.pot=e},handlcurrentChange:e=>{n.pagination.page=e},handlSizeChange:e=>{n.pagination.size=e}}));var d}};const P=(e=>(A("data-v-0db95d22"),e=e(),R(),e))((()=>C("div",{class:"title"},"新增盘点录入单",-1))),I=k(" 完成 "),U={class:"main"},B={style:{"text-align":"left","margin-bottom":"10px"}},$={style:{"margin-right":"20px"}};var D=S(q,[["render",function(e,a,t,l,r,i){const s=w("el-button"),p=n,c=o,m=d,b=u;return T(),x(b,{close:e.close,route:e.go,class:"entry-sheet","t-id":"tab"},{header:z((()=>[P,C("div",null,[j(s,{size:"medium",type:"primary",onClick:l.handleSubmit},{default:z((()=>[I])),_:1},8,["onClick"])])])),default:z((()=>[j(m,{ref:"keyBoard",data:e.data.slice((e.pagination.page-1)*e.pagination.size,(e.pagination.page-1)*e.pagination.size+e.pagination.size),down:[".main .base-table .el-table__body-wrapper  .el-table__row"],range:[0,1],first:".main .select-input",pot:e.pot},{default:z((()=>[C("div",U,[j(p,{ref:"baseTable",columns:e.columns,"table-data":e.data,"class-id":"tab","reduce-num":110,delTable:l.delTable},{buttons:z((()=>[C("div",B,[C("span",$,"盘点任务单号："+O(e.$route.query.inventoryNo),1),C("span",null,"门店："+O(e.$route.query.business),1)])])),_:1},8,["columns","table-data","delTable"]),j(c,{class:"select-input",keys:e.keys,onOnInput:l.handleInput,onOnChange:l.handleChange,onClear:l.clearMsg,options:e.selectArr,"onUpdate:options":a[0]||(a[0]=a=>e.selectArr=a),head:e.batchHeader,ref:"selectTable",placeholder:"请输入商品编码/助记码/商品名称/条码",props:{label:"productName",value:"productUuid"}},null,8,["keys","onOnInput","onOnChange","onClear","options","head"])])])),_:1},8,["data","down","pot"])])),_:1},8,["close","route"])}],["__scopeId","data-v-0db95d22"]]);export{D as default};
