var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,r=(e,t)=>{for(var i in t||(t={}))s.call(t,i)&&l(e,i,t[i]);if(a)for(var i of a(t))o.call(t,i)&&l(e,i,t[i]);return e},n=(e,a)=>t(e,i(a));import{_ as d}from"./BaseStencil.46c3d678.js";import{d as u}from"./element-plus.b44d97a8.js";import{r as h,_ as p}from"./index.ab904951.js";import{g as m,a as c,r as w,b as y,c as g}from"./PurchaseWarehousing.4eba67da.js";import{s as f}from"./PurchaseAcceptance.9cfc0e35.js";import{g as k,f as b}from"./filter.c2c8f0b9.js";import{_ as x}from"./BaseName.1aa32b4b.js";import{s as T,g as j}from"./businessRule.60794e55.js";import{d as v}from"./index.7c4fa9df.js";import{u as N}from"./vuex.c868d4e0.js";import{j as C,G as L,n as U,D,t as P,q as A,B as V,o as F,a5 as S,e as O,w as _,a6 as E,z,c as B,v as H,S as M,a9 as R,aa as I}from"./@vue.23a4bd1a.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";/* empty css                                                             */var q={name:"PurchaseWarehousing",components:{BaseStencil:d},setup(){const e=new Date,t=N(),i=k(e,30,!0),l=C({storageTotal:{},formConfig:{border:!0},storeList:[],isClear:!1,baseNameList:["name","specification","unit","manufacturer"],type:"1",findOgList:[],dialogVisible:!1,pageTitle:"冲红",loading:!1,tloading:!1,btnData:{isAdd:!0,path:"/purchase/add-purchase-warehousing",name:"新增入库单"},dialogValue:{},formData:{inline:!0,labelWidth:"82px",list:[{type:"LINKAGETIME",design:{width:"240px"},keys:["createTimeStart","createTimeEnd"],key:"createTime",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{type:"SELECT",key:"supplierName",list:()=>l.supplierList,placeholder:"供应商名称"},{label:"",type:"SELECT",placeholder:"请选择门店",config:{multiple:!0},key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>l.findOgList},{type:"INPUT",key:"storageNo",placeholder:"入库单编号"},{type:"INPUT",key:"checkNo",placeholder:"验收单编号"},{type:"INPUT",key:"productInfo",placeholder:"商品信息",hidden:!0}]},tableData:[],columns:[],columnsList:[{title:"序号",type:"index",fixed:"left",width:50},{key:"storageNo",title:"入库单编号",width:135,render:e=>L(u,{type:"text",innerHTML:e.storageNo,onClick:t=>{h.push({path:"/purchase/add-purchase-warehousing",query:{uuid:e.uuid}})}})},{title:"随货同行单",key:"peer",width:180},{title:"开票日期",key:"invoiceTime",width:180},{key:"checkNo",title:"验收单编号",width:135,render:e=>L(u,{type:"text",innerHTML:e.checkNo,onClick:t=>{h.push({path:"/purchase/add-purchase-acceptance",query:{uuid:e.checkUuid,returnPath:"/purchase/purchase-warehousing",isDetail:!0}})}})},{key:"code",title:"商品编号",width:80,show:["2"]},{key:"name",title:"商品名称",formConfig:{"min-width":150},render:e=>L(x,{row:e,list:l.baseNameList}),show:["2"]},{key:"batchNumber",title:"批号",width:100,show:["2"]},{key:"productionDate",title:"生产日期",width:100,show:["2"]},{key:"expireDate",title:"有效期至",width:100,show:["2"]},{key:"supplierName",title:"供应商名称",formConfig:{"min-width":150},show:["1"]},{key:"categories",title:"商品种类",align:"right",width:80,show:["1"]},{key:"storageNum",title:"入库数量",width:110,align:"right"},{key:"totalAmountTax",title:"含税金额合计",width:110,align:"right",show:["1"]},{key:"totalAmount",title:"金额合计",width:110,align:"right",show:["1"]},{key:"applicant",title:"入库员",width:100,show:["1"]},{key:"createTime",title:"制单时间",width:170,show:["1"]},{title:"结算状态",key:"settleState",width:78,render:e=>L("span",{innerText:["未结算","结算中","已结算","已冲红"][e.settleState]}),show:["1"]},{title:"门店",key:"business",formConfig:{"min-width":150}},{key:"taxPaid",title:"含税进价",width:80,show:["2"]},{key:"taxAmount",title:"含税金额",width:80,show:["2"]},{key:"price",title:"进价",width:80,show:["2"]},{key:"amount",title:"金额",width:80,show:["2"]},{key:"retailPrice",title:"零售价",width:80,show:["2"]},{key:"retailAmount",title:"零售金额",width:80,show:["2"]},{key:"inputTaxRate",title:"税率",width:80,show:["2"]},{key:"tax",title:"税额",width:80,show:["2"]},{key:"checkNum",title:"验收数量",width:80,show:["2"]},{key:"returnNum",title:"拒收数量",width:80,show:["2"]},{key:"refuseReason",title:"拒收原因",width:80,show:["2"]},{key:"medicineBeverage",title:"中药饮片产地",width:150,show:["2"]},{key:"approvalNumber",title:"批准文号",width:150,show:["2"]},{key:"supplierName",title:"供应商名称",width:150,show:["2"]},{key:"storeName",title:"门店",width:150,show:["2"]},{key:"holderPermit",title:"上市许可持有人",width:180,show:["2"]},{key:"createTime",title:"制单时间",width:150,show:["2"]},{key:"options",title:"操作",width:100,render:e=>{let t=[{type:"text",innerHTML:"查看",onClick:()=>{V(e)}},{type:"text",innerHTML:"冲红",show:0!=e.settleState,onClick:()=>{p(e)}}];return L("div",t.map((e=>{if(!e.show)return L(u,e)})))}}],submitForm:{"page.currentPage":1,"page.pageSize":10,createTimeStart:i[0],createTimeEnd:b(new Date),businessUuid:[]}}),d=async()=>{let e=l.submitForm,{total:t,businessUuid:i}=e,n=((e,t)=>{var i={};for(var l in e)s.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&o.call(e,l)&&(i[l]=e[l]);return i})(e,["total","businessUuid"]);i=T(i);let d=r({businessUuid:i},n);l.columns=l.columnsList.filter((e=>e.show?e.show.indexOf(l.type)>=0?e:void 0:e)),l.tloading=!0,l.tableData=[],"1"==l.type?(m(d).then((e=>{l.tableData=e.list,l.submitForm.total=e.totalElements})).finally((()=>{l.tloading=!1})),S(d)):(c(d).then((e=>{l.tableData=e.list,l.submitForm.total=e.totalElements})).finally((()=>{l.tloading=!1})),O(d))},p=e=>{l.dialogVisible=!0,l.dialogValue=e},V=e=>{h.push({name:"AddPurchaseWarehousing",query:{uuid:e.uuid,isDetail:!0}})},F=()=>{f().then((e=>{let t=e.map((function(e,t){return{label:e.supplierName,value:e.supplierName}}));l.supplierList=t}))};U((async()=>{F()})),D((async()=>{A((()=>{l.submitForm.createTimeStart=i[0],l.submitForm.createTimeEnd=b(new Date)})),l.storeList=await t.dispatch("common/mechanism"),l.findOgList=l.storeList,j(l.storeList,l,l.formData),d()}));const S=async e=>{let{storeUuid:i}=t.state.common.info;const a=await y(n(r({},e),{storeUuid:i}));l.storageTotal=a},O=async e=>{let{storeUuid:i}=t.state.common.info;const a=await g(n(r({},e),{storeUuid:i}));l.storageTotal=a};return n(r({exportExcel:async()=>{let{storeUuid:e}=t.state.common.info,i=await t.dispatch("common/mechanism"),a="";a=l.submitForm.businessUuid.length?T(l.submitForm.businessUuid):i.map((e=>e.uuid)).join(",");let s=v("/gateway/chain-store/storage/detail/export",n(r({},l.submitForm),{storeUuid:e,businessUuid:a})),o=v("/gateway/chain-store/storage/export",n(r({},l.submitForm),{storeUuid:e,businessUuid:a}));window.open("2"===l.type?s:o,"_self")}},P(l)),{getPurchaseWarehousingList:d,toDetail:V,getsupplierList:F,handleRushRed:async()=>{let e=l.dialogValue.uuid;await w(e),l.dialogVisible=!1,d()},addUrl:()=>{h.push({path:"/purchase/add-purchase-warehousing"})},typeChange:e=>{let t=l.formData.list;2==e&&(O(),t[t.length-1].hidden=!1,delete l.columnsList[l.columnsList.length-1]),1==e&&(S(),t[t.length-1].hidden=!0,l.columnsList=[{title:"序号",type:"index",fixed:"left",width:50},{title:"门店",key:"business",formConfig:{"min-width":150}},{key:"storageNo",title:"入库单编号",width:135,render:e=>L(u,{type:"text",innerHTML:e.storageNo,onClick:t=>{h.push({path:"/purchase/add-purchase-warehousing",query:{uuid:e.uuid}})}})},{key:"checkNo",title:"验收单编号",width:135,render:e=>L(u,{type:"text",innerHTML:e.checkNo,onClick:t=>{h.push({path:"/purchase/add-purchase-acceptance",query:{uuid:e.checkUuid,returnPath:"/purchase/purchase-warehousing",isDetail:!0}})}})},{key:"code",title:"商品编号",width:80,show:["2"]},{key:"name",title:"商品名称",formConfig:{"min-width":150},render:e=>L(x,{row:e,list:l.baseNameList}),show:["2"]},{key:"batchNumber",title:"批号",width:100,show:["2"]},{key:"productionDate",title:"生产日期",width:100,show:["2"]},{key:"expireDate",title:"有效期至",width:100,show:["2"]},{key:"supplierName",title:"供应商名称",formConfig:{"min-width":150},show:["1"]},{key:"categories",title:"商品种类",align:"right",width:80,show:["1"]},{key:"storageNum",title:"入库数量",width:110,align:"right"},{key:"totalAmountTax",title:"含税金额合计",width:110,align:"right",show:["1"]},{key:"totalAmount",title:"金额合计",width:110,align:"right",show:["1"]},{key:"applicant",title:"入库员",width:100,show:["1"]},{key:"createTime",title:"制单时间",width:170,show:["1"]},{title:"结算状态",key:"settleState",width:78,render:e=>L("span",{innerText:["未结算","结算中","已结算","已冲红"][e.settleState]}),show:["1"]},{key:"taxPaid",title:"含税进价",width:80,show:["2"]},{key:"taxAmount",title:"含税金额",width:80,show:["2"]},{key:"price",title:"进价",width:80,show:["2"]},{key:"amount",title:"金额",width:80,show:["2"]},{key:"retailPrice",title:"零售价",width:80,show:["2"]},{key:"retailAmount",title:"零售金额",width:80,show:["2"]},{key:"inputTaxRate",title:"税率",width:80,show:["2"]},{key:"tax",title:"税额",width:80,show:["2"]},{key:"checkNum",title:"验收数量",width:80,show:["2"]},{key:"code15",title:"拒收数量",width:80,show:["2"]},{key:"returnNum",title:"拒收原因",width:80,show:["2"]},{key:"medicineBeverage",title:"中药饮片产地",width:150,show:["2"]},{key:"approvalNumber",title:"批准文号",width:150,show:["2"]},{key:"holderPermit",title:"上市许可持有人",width:150,show:["2"]},{key:"createTime",title:"制单时间",width:150,show:["2"]},{key:"options",title:"操作",width:100,render:e=>{let t=[{type:"text",innerHTML:"查看",onClick:()=>{V(e)}},{type:"text",innerHTML:"冲红",show:0!=e.settleState,onClick:()=>{p(e)}}];return L("div",t.map((e=>{if(!e.show)return L(u,e)})))}}]),d()},handleClick:({item:e,type:t})=>{if("dblclick"===t){let t=e.uuid;h.push({name:"AddPurchaseWarehousing",query:{uuid:t,isDetail:!0}})}}})}};const W=e=>(R("data-v-57029407"),e=e(),I(),e),G={class:"purchaseAcceptance"},K={style:{display:"flex","justify-content":"space-between"}},J={style:{display:"flex","align-items":"center"}},Q=M("汇总"),X=M("明细"),Y={key:0},Z={key:1},$=M(" 导出 "),ee=M(" 新增采购入库 "),te=W((()=>E("i",{class:"el-icon-warning"},null,-1))),ie=M("确认冲红吗？ "),ae={class:"dialogFather"},se=M(" 冲红商品种类："),oe={class:"dialogFather"},le=M(" 冲红商品数量合计："),re={class:"dialogFather"},ne=M(" 冲红金额合计："),de={class:"dialogFather"},ue=M(" 冲红含税金额合计："),he=W((()=>E("div",{class:"dialogRemark"},"注：完成后系统自动调整库存数量和库存金额",-1))),pe={class:"dialog-footer"},me=M("取 消"),ce=M("确 定");var we=p(q,[["render",function(e,t,i,a,s,o){const l=V("el-radio-button"),r=V("el-radio-group"),n=V("el-button"),u=d,h=V("el-dialog");return F(),S("div",G,[O(u,{"submit-form":e.submitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.submitForm=t),columns:e.columns,"form-data":e.formData,isClear:e.isClear,loading:e.tloading,optionShow:"1"===e.type,options:!0,pagination:e.submitForm,select:a.getPurchaseWarehousingList,"table-data":e.tableData,formConfig:e.formConfig,class:"base-stencil",onOnClick:a.handleClick},{buttons:_((()=>[E("div",K,[E("div",J,[O(r,{modelValue:e.type,"onUpdate:modelValue":t[0]||(t[0]=t=>e.type=t),size:"small",style:{"margin-right":"10px"},onChange:t[1]||(t[1]=t=>a.typeChange(e.type))},{default:_((()=>[O(l,{label:"1"},{default:_((()=>[Q])),_:1}),O(l,{label:"2"},{default:_((()=>[X])),_:1})])),_:1},8,["modelValue"]),"1"===e.type?(F(),S("div",Y,[E("span",null," 入库数量: "+z(e.storageTotal.storageNum||"-"),1),E("span",null," 含税金额合计: "+z(e.storageTotal.totalAmountTax||"-"),1),E("span",null," 金额合计: "+z(e.storageTotal.totalAmount||"-"),1)])):(F(),S("div",Z,[E("span",null," 入库数量: "+z(e.storageTotal.storageNum||"-"),1),E("span",null," 含税金额: "+z(e.storageTotal.taxAmount||"-"),1),E("span",null," 金额: "+z(e.storageTotal.amount||"-"),1),E("span",null," 零售金额: "+z(e.storageTotal.retailAmount||"-"),1),E("span",null," 税额: "+z(e.storageTotal.tax),1)]))]),E("div",null,[O(n,{plain:"",size:"small",type:"primary",onClick:a.exportExcel},{default:_((()=>[$])),_:1},8,["onClick"]),O(n,{size:"small",type:"primary",onClick:a.addUrl},{default:_((()=>[ee])),_:1},8,["onClick"])])])])),_:1},8,["submit-form","columns","form-data","isClear","loading","optionShow","pagination","select","table-data","formConfig","onOnClick"]),e.dialogVisible?(F(),B(h,{key:0,modelValue:e.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialogVisible=t),title:e.pageTitle,width:"420px"},{footer:_((()=>[E("span",pe,[O(n,{onClick:t[3]||(t[3]=t=>e.dialogVisible=!1)},{default:_((()=>[me])),_:1}),O(n,{loading:e.loading,type:"primary",onClick:a.handleRushRed},{default:_((()=>[ce])),_:1},8,["loading","onClick"])])])),default:_((()=>[te,ie,E("div",ae,[se,E("span",null,z(e.dialogValue.categories),1)]),E("div",oe,[le,E("span",null,z(e.dialogValue.storageNum),1)]),E("div",re,[ne,E("span",null,z(e.dialogValue.totalAmount)+"元",1)]),E("div",de,[ue,E("span",null,z(e.dialogValue.totalAmountTax)+"元",1)]),he])),_:1},8,["modelValue","title"])):H("",!0)])}],["__scopeId","data-v-57029407"]]);export{we as default};
