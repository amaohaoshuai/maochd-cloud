var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,r=(t,i,o)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[i]=o,s=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&r(e,i,t[i]);if(o)for(var i of o(t))l.call(t,i)&&r(e,i,t[i]);return e},n=(e,o)=>t(e,i(o));import{_ as d}from"./BaseStencil.46c3d678.js";import{g as m,a as p,b as u,c}from"./index.3778ab26.js";import{u as y,b as f}from"./vue-router.91336ba9.js";import{j as h}from"./index.6037074b.js";import{d as g}from"./element-plus.b44d97a8.js";import{g as b,f as k}from"./filter.c2c8f0b9.js";import{_ as T}from"./BaseName.1aa32b4b.js";import{u as w}from"./vuex.c868d4e0.js";import{d as C}from"./index.7c4fa9df.js";import{s as v,g as j}from"./businessRule.60794e55.js";import{j as x,G as N,e as S,x as P,B as A,D as E,t as L,o as U,c as O,w as F,v as D,a6 as _,a5 as I,z as M,S as z,a9 as B,aa as R}from"./@vue.23a4bd1a.js";import{_ as q}from"./index.ab904951.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";/* empty css                                                             */import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var G={name:"SaleOrder",setup(){let e=w(),t=y();const i=f();let r=x({supplier:[]});const{dict:d,pathObject:U}=e.state.common,O=new Date;let F=b(O,30,!0),D=x({isClear:!1,isLoading:!1,baseNameList:["productName","specification","unit","manufacturer"],pageType:"1",excelUrl:"",tloading:!1,shoudAmountlTotal:void 0,costTotal:void 0,discountAmountlTotal:void 0,grossProfitTotal:void 0,payAmountlTotal:void 0,grossProfitRate:void 0,roundMoney:void 0,tableData:[],findOgList:[],baseForm:{labelWidth:"120px",inline:!0,list:[{type:"INPUT",key:"productInfo",placeholder:"编码/品名/助记码/条形码",design:{width:"200px"},hidden:!0},{type:"INPUT",key:"member",placeholder:"请输入会员信息"},{label:"",type:"SELECT",placeholder:"请选择门店",config:{multiple:!0},key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>D.findOgList},{type:"LINKAGETIME",design:{width:"240px"},keys:["timeStart","timeEnd"],key:"time",config:{"start-placeholder":"结算开始时间","end-placeholder":"结算结束时间"}},{type:"SELECT",placeholder:"请选择是否优惠",key:"discountNY",list:[{label:"是",value:"1"},{label:"否",value:"0"}]},{type:"SELECT",placeholder:"请选择订单类型",key:"orderState",list:[{label:"退款",value:"7"},{label:"销售",value:"1"}]},{type:"SELECT",placeholder:"请选择订单来源",key:"orderSourceType",list:[{label:"零售",value:"LS"},{label:"医保",value:"YB"}]},{placeholder:"请输入收银员姓名",type:"INPUT",key:"cashier"},{type:"SELECT",placeholder:"请选择处方分类",key:"prescriptionClass",hidden:!0,list:()=>I()},{type:"SELECT",placeholder:"选择是否含单轨制处方",key:"hasEthical",list:()=>[{value:0,label:"否"},{value:1,label:"是"}]},{type:"SELECT",placeholder:"请选择是否含麻黄碱",key:"hasSpecial",list:()=>[{value:0,label:"否"},{value:1,label:"是"}]},{placeholder:"请输入销售员姓名",type:"INPUT",key:"salesName"},{placeholder:"请输入销售单号",type:"INPUT",key:"orderNo"}]},columns:[],columns1:[{title:"序号",type:"index",width:52},{title:"销售单编号",key:"orderNo",formConfig:{width:140},render:e=>N(g,{type:"text",innerHTML:e.orderNo,onClick:()=>{M(e)}})},{title:"应收金额",key:"orderAmount",align:"right",formConfig:{"min-width":110}},{title:"实收金额",key:"payAmount",align:"right",formConfig:{"min-width":110}},{title:"优惠金额",key:"discountAmount",align:"right",formConfig:{"min-width":110}},{title:"积分",key:"integralGain",align:"right",formConfig:{"min-width":110}},{title:"会员姓名",key:"customerName"},{title:"会员手机号",key:"customerPhone",formConfig:{"min-width":110}},{title:"收银员",key:"employName",formConfig:{"min-width":100}},{title:"销售员",key:"sellName",width:120},{title:"是否含单轨制处方",key:"hasEthicalMsg",formConfig:{"min-width":150}},{title:"含麻黄碱",key:"hasSpecialMsg",formConfig:{"min-width":80}},{title:"结算时间",key:"finishTime",width:180},{title:"订单类型",key:"orderType",formConfig:{"min-width":80}},{title:"订单来源",key:"orderSource",formConfig:{"min-width":80}},{title:"门店",key:"business",width:120},{title:"操作",key:"options",width:60,render:e=>[{text:"查看",props:{onClick:()=>{M(e)}}}].map((e=>S(A("el-button"),P({class:e.className},e.props,{type:"text"}),{default:()=>[e.text]})))}],columns2:[{title:"序号",type:"index",width:52,fixed:"left"},{title:"商品编号",key:"productCode",fixed:"left",formConfig:{"min-width":120}},{title:"商品名称/规格/单位/生产厂家",key:"productName",width:256,fixed:"left",render:e=>N(T,{row:e,list:D.baseNameList}),formConfig:{"show-overflow-tooltip":!1}},{title:"销售单编号",key:"orderNo",formConfig:{width:140},render:e=>N(g,{type:"text",innerHTML:e.orderNo,onClick:()=>{M(e)}})},{title:"批号",key:"batchNumber",formConfig:{"min-width":110}},{title:"有效期至",key:"expireDate",formConfig:{"min-width":110}},{title:"销售数量",key:"num",align:"right",render:e=>e.num+e.unit,formConfig:{"min-width":110}},{title:"实价",key:"payPrice",align:"right",formConfig:{"min-width":110}},{title:"应收金额",key:"totalShoudAmount",align:"right",formConfig:{"min-width":110}},{title:"实收金额",key:"totalPayAmount",align:"right",formConfig:{"min-width":110}},{title:"优惠金额",key:"totalDiscountAmount",align:"right",formConfig:{"min-width":110}},{title:"积分",key:"integral",align:"right",formConfig:{"min-width":110}},{title:"零售价",key:"retailPrice",align:"right",formConfig:{"min-width":110}},{title:"会员价",key:"memberPrice",align:"right",formConfig:{"min-width":110}},{title:"成本金额",key:"costTotal",align:"right",formConfig:{"min-width":110}},{title:"成本进价",key:"cost",align:"right",formConfig:{"min-width":110}},{title:"毛利",key:"grossProfit",align:"right",formConfig:{"min-width":110}},{title:"毛利率%",align:"right",key:"grossProfitRate"},{title:"收银员",key:"employName",width:120},{title:"销售员",key:"sellName",width:120},{title:"结算时间",key:"finishTime",width:120},{title:"会员姓名",key:"customerName"},{title:"会员手机号 ",key:"customerPhone"},{title:"处方分类",key:"prescriptionClass",width:120},{title:"含麻黄碱",key:"hasSpecialMsg",width:120},{title:"顾客姓名",key:"patientName"},{title:"身份证",key:"idCard"},{title:"医疗机构",key:"medicalEstablishment"},{title:"处方号",key:"prescriptionNo"},{title:"医师",key:"physician"},{title:"药师",key:"auditor"},{title:"订单类型",key:"orderState",width:120,render:e=>"1"==e.orderState?"销售":"退款"},{title:"订单来源",key:"orderSource",width:120},{title:"门店",key:"business",width:120}],submitForm:{"page.currentPage":1,"page.pageSize":10,businessUuid:U.businessUuid?[U.businessUuid]:[],orderNo:"",member:"",salesName:U.sellName?U.sellName:"",cashier:"",hasEthical:"",hasSpecial:"",timeStart:U.startTime||F[0],timeEnd:U.endTime||k(new Date),orderState:"",orderSourceType:"",productInfo:""}});const _=()=>{D.tloading=!0;let e=D.submitForm,{businessUuid:t}=e,i=((e,t)=>{var i={};for(var r in e)a.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&o)for(var r of o(e))t.indexOf(r)<0&&l.call(e,r)&&(i[r]=e[r]);return i})(e,["businessUuid"]);t=v(U.businessUuid)||v(t);let r=s({businessUuid:t},i);"1"==D.pageType?(D.columns=D.columns1,m(r).then((e=>{D.submitForm.total=e.total,D.tableData=e.records,D.tloading=!1})),p(r).then((e=>{D.shoudAmountlTotal=e.shoudAmountlTotal,D.costTotal=e.costTotal,D.roundMoney=e.roundMoney,D.discountAmountlTotal=e.discountAmountlTotal,D.grossProfitTotal=e.grossProfitTotal,D.payAmountlTotal=e.payAmountlTotal,D.grossProfitRate=e.grossProfitRate})),D.isLoading=!1):(D.columns=D.columns2,u(r).then((e=>{D.submitForm.total=e.total,D.tableData=e.records,D.tloading=!1})),c(r).then((e=>{D.shoudAmountlTotal=e.shoudAmountlTotal,D.costTotal=e.costTotal,D.discountAmountlTotal=e.discountAmountlTotal,D.grossProfitTotal=e.grossProfitTotal,D.payAmountlTotal=e.payAmountlTotal})),D.isLoading=!1)},I=()=>{if(d.length>0){return d.filter((e=>"prescription"===e.key))[0].data.map((e=>({value:e.key,label:e.key})))}};E((async()=>{i.query.type&&(D.pageType=i.query.type);const t=await e.dispatch("common/mechanism");D.findOgList=t,j(t,D,D.baseForm),_()}));const M=e=>{let i="1"==D.pageType?e.uuid:e.orderUuid;t.push({path:"/retail/sale-order-detail",query:{uuid:i,orderState:e.orderState,type:e.orderSourceType}})};return n(s(s({routerToDetail:M,handleClick:({item:e,type:t})=>{"dblclick"===t&&M(e)}},L(r)),L(D)),{getOrderListData:_,typeChange:e=>{D.pageType=e;let t=D.baseForm.list;2==D.pageType&&(t[0].hidden=!1,t[8].hidden=!1,t[9].hidden=!0),1==D.pageType&&(t[0].hidden=!0,t[8].hidden=!0,t[9].hidden=!1),_()},exportExcel:async()=>{let{storeUuid:t}=e.state.common.info;const i=await e.dispatch("common/mechanism");let o="";o=D.submitForm.businessUuid.length?v(D.submitForm.businessUuid):i.map((e=>e.uuid)).join(",");let a=C("/gateway/chain-store/order/exportOrderDetailWithBackstage",n(s({},D.submitForm),{storeUuid:t,businessUuid:o}));window.open(a,"_self")},getFindListData:async()=>{try{const e=await h();D.findOgList=e,D.submitForm.businessUuid=e[0].uuid}catch(e){return e}},dictPrescriptionList:I})}};const H=e=>(B("data-v-1101ebbd"),e=e(),R(),e),V=z("汇总"),W=z("明细"),Y=z(" 导出 "),K={style:{clear:"both","text-align":"left","margin-bottom":"10px"}},J={key:0,class:"money"},Q={key:1,class:"money"},X=H((()=>_("div",{style:{clear:"both"}},null,-1)));var Z=q(G,[["render",function(e,t,i,o,a,l){const r=A("el-radio-button"),s=A("el-radio-group"),n=A("el-button"),m=d;return U(),O(m,{"form-data":e.baseForm,onOnClick:o.handleClick,"submit-form":e.submitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.columns,pagination:e.submitForm,options:!0,loading:e.tloading,select:o.getOrderListData,"option-show":!1,isClear:e.isClear},{buttons:F((()=>[S(s,{modelValue:e.pageType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.pageType=t),size:"small",style:{float:"left","margin-right":"10px","margin-bottom":"10px"},onChange:t[1]||(t[1]=t=>o.typeChange(e.pageType))},{default:F((()=>[S(r,{label:"1"},{default:F((()=>[V])),_:1}),S(r,{label:"2"},{default:F((()=>[W])),_:1})])),_:1},8,["modelValue"]),2==e.pageType?(U(),O(n,{key:0,size:"small",plain:"",type:"primary",onClick:o.exportExcel},{default:F((()=>[Y])),_:1},8,["onClick"])):D("",!0),_("div",K,[1==e.pageType?(U(),I("div",J,[_("span",null,"应收金额："+M(e.shoudAmountlTotal),1),_("span",null,"实收金额："+M(e.payAmountlTotal),1),_("span",null,"优惠金额："+M(e.discountAmountlTotal),1),_("span",null,"抹零金额："+M(e.roundMoney),1),_("span",null,"成本金额："+M(e.costTotal),1),_("span",null,"毛利率："+M(e.grossProfitRate)+"%",1)])):D("",!0),2==e.pageType?(U(),I("div",Q,[_("span",null,"应收金额："+M(e.shoudAmountlTotal),1),_("span",null,"实收金额："+M(e.payAmountlTotal),1),_("span",null,"优惠金额："+M(e.discountAmountlTotal),1),_("span",null,"成本金额："+M(e.costTotal),1),_("span",null,"毛利："+M(e.grossProfitTotal),1)])):D("",!0)]),X])),_:1},8,["form-data","onOnClick","submit-form","table-data","columns","pagination","loading","select","isClear"])}],["__scopeId","data-v-1101ebbd"]]);export{Z as default};
