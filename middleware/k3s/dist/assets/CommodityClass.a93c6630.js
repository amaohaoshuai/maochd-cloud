var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,l=(e,t)=>{for(var a in t||(t={}))i.call(t,a)&&r(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&r(e,a,t[a]);return e};import{_ as n}from"./BaseStencil.46c3d678.js";import{_ as m}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./BaseTable.36f55649.js";import{t as c}from"./tabs.2754a120.js";import{_ as u}from"./index.ab904951.js";import{a as p}from"./axios.7b768d2b.js";import{d as b}from"./element-plus.b44d97a8.js";import{d as f}from"./public.9c1d8f39.js";import{g}from"./formRule.f80f9ec7.js";import{u as y}from"./vuex.c868d4e0.js";import{j as h,G as v,g as j,D as w,t as T,B as k,L as C,o as F,a5 as N,a6 as x,J as D,e as S,w as U,c as L,v as O,a9 as _,aa as z,S as V}from"./@vue.23a4bd1a.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./verification.ecddc814.js";function I(e){return p.post("/gateway/chain-store/category/addFirst",e)}function P(e){return p.post("/gateway/chain-store/category/addSecond",e)}function $(e){return p.post("/gateway/chain-store/category/updateFirst",e)}function B(e){return p.post("/gateway/chain-store/category/updateSecond",e)}function M(e){return p.get(`/gateway/chain-store/category/delete/${e}`)}const E={name:"CommodityClass",components:{tabs:c,BaseTable:d,BaseForm:m},setup(){const e=y(),o=h({value:"",title:"",loading:!1,type:1,tableData:[],formConfig:{"row-key":"uuid","tree-props":{children:"list",hasChildren:"hasChildren"}},optionShow:!0,draggable:!0,dialogVisible:!1,formData:{inline:!1,labelWidth:"110px",config:{size:"medium"},list:[]},listOne:[{type:"INPUT",placeholder:"请输入",label:"一级分类名称",key:"categoryName",rules:g("Input","一级分类名称")},{type:"INPUT",placeholder:"请输入",label:"一级分类编码",key:"encode",rules:[...g("Input","一级分类名称"),{pattern:/^[0-9A-Za-z]{1,2}$/,message:"数字或字母组成，不超过2个字符"}],msg:()=>v("div",{innerHTML:"编码格式为数字或字母，不超过2个字符",style:"font-size:12px;color:#909399"})}],listTwo:[{type:"INPUT",placeholder:"请输入",label:"二级分类名称",key:"name",rules:g("Input","二级分类名称")},{type:"INPUT",placeholder:"请输入",label:"二级分类编码",key:"code",rules:[...g("Input","二级分类编码"),{pattern:/^[0-9A-Za-z]{1,2}$/,message:"数字或字母组成，不超过2个字符"}],msg:()=>v("div",{innerHTML:"编码格式为数字或字母，不超过2个字符",style:"font-size:12px;color:#909399"})}],listThree:[{type:"SELECT",placeholder:"请输入",label:"一级分类名称",key:"parentUuid",rules:g("SELECT","一级分类名称"),design:{width:"260px"},config:{filterable:!1},props:{label:"categoryName",value:"uuid"},list:()=>o.tableData}],submitForm:{},columns:[{title:"(编码)一级分类名称",key:"categoryName",render:({categoryName:e,encode:t})=>{if(e)return v("span",{},`(${t})${e}`)}},{title:"(编码)二级分类名称",key:"name",render:({name:e,code:t})=>{if(e)return v("span",{},`(${t})${e}`)}},{title:"商品编码示例",key:"allCode"},{title:"操作",key:"options",render:({categoryName:e,encode:t,uuid:a,list:i,parentUuid:r,name:n,code:m})=>v("div",[{type:"text",innerHTML:"新增二级分类",show:!e,onClick:()=>{o.title="新增二级分类",o.type=1,o.submitForm.parentUuid=a,o.dialogVisible=!0,o.formData.list=[...o.listThree,...o.listTwo],o.submitForm.name=void 0,o.submitForm.code=void 0}},{type:"text",innerHTML:"编辑",onClick:()=>{e?(o.title="编辑一级分类",o.type=2,o.submitForm=l(l({},o.submitForm),{categoryName:e,encode:t,uuid:a}),o.formData.list=o.listOne):(o.title="编辑二级分类",o.type=3,o.submitForm.parentUuid=r,o.submitForm=l(l({},o.submitForm),{name:n,code:m,parentUuid:r,uuid:a}),o.formData.list=[...o.listThree,...o.listTwo]),o.dialogVisible=!0}},{type:"text",innerHTML:"删除",onClick:()=>{let t={};e?i&&i.length?(t={msg:"该一级分类下有二级分类，不可删除。如需删除，请先删除二级分类",btn:{confirmButtonText:"我知道了",showCancelButton:!1,type:"warning"}},f(t)):(t={msg:`确认删除【${e}】吗？`,fun:M,uuid:a,callback:s},f(t)):(t={msg:`确认删除【${n}】吗？`,fun:M,uuid:a,callback:s},f(t))},style:{color:"#f56c6c"}}].map((e=>{if(!e.show)return v(b,e)})))}]}),i=j(null);function s(){p.get("/gateway/chain-store/category/list").then((t=>{o.tableData=t,e.commit("common/ALLCATEGORYLIST",t)}))}return w((()=>{s()})),r=l({},T(o)),t(r,a({selectActiveName:function(e){o.tabs=e},handleClick:function(e,t){t.splice(e,1)},handleSubmit:async()=>{if(await i.value.verification()){let{categoryName:e,encode:t,name:a,code:r,uuid:l,parentUuid:n}=o.submitForm,m={},d=[I,P,$,B][o.type];switch(o.type){case 0:m={categoryName:e,encode:t,list:[{categoryName:a,encode:r}]};break;case 1:m={categoryName:a,encode:r,parentUuid:n};break;case 2:m={categoryName:e,encode:t,uuid:l};break;case 3:m={categoryName:a,encode:r,firstUuid:n,uuid:l}}o.loading=!0,d(m).then((e=>{o.dialogVisible=!1,i.value.handleRest(!1),s()})).finally((()=>{o.loading=!1}))}},baseForm:i,addMsg:function(){o.title="新增一级分类",o.type=0,o.dialogVisible=!0,o.formData.list=[...o.listOne,...o.listTwo],o.submitForm.categoryName=void 0,o.submitForm.encode=void 0,o.submitForm.name=void 0,o.submitForm.code=void 0},getList:s,handleClose:e=>{i.value.handleRest(!1),e()},tableDataList:()=>o.tableData,clear:()=>{i.value.handleRest(!1),o.dialogVisible=!1}}));var r}},H={class:"commodity_class"},A=(e=>(_("data-v-4065e983"),e=e(),z(),e))((()=>x("div",{class:"tips"},[x("div",{class:"title"},"商品分类编码规则说明"),x("div",null,"1.一级分类下必须有二级分类，所有商品需归属到二级分类下"),x("div",null," 2.如出现一级分类下无二级分类的情况，二级分类名称可与一级分类名称保持一致 "),x("div",null," 3.商品编码规则：一级分类编码+二级分类编码+4位流水号；根据商品添加顺序数字依次递增 "),x("div",null," 4.商品分类名称和编码规则如进行修改，历史已赋予对应值的商品仍保留原信息；修改后新增的商品将根据新的规则生成； ")],-1))),R={class:"commodityMsg"},G=V("新增一级分类"),Z={class:"dialog-footer"},J=V("取 消"),W=V(" 确 定 ");var Y=u(E,[["render",function(e,t,a,o,i,s){const r=k("el-button"),l=n,d=m,c=k("el-dialog"),u=C("loading");return F(),N("div",H,[A,x("div",R,[D(S(l,{class:"base-stencil","table-data":e.tableData,formConfig:e.formConfig,columns:e.columns,optionShow:e.optionShow,draggable:!1,reduceNum:1},{buttons:U((()=>[S(r,{type:"primary",size:"small",onClick:t[0]||(t[0]=e=>o.addMsg())},{default:U((()=>[G])),_:1})])),_:1},8,["table-data","formConfig","columns","optionShow"]),[[u,e.loading]]),e.dialogVisible?(F(),L(c,{key:0,"before-close":o.handleClose,title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=t=>e.dialogVisible=t),width:"430px"},{footer:U((()=>[x("span",Z,[S(r,{size:"small",onClick:t[2]||(t[2]=e=>o.clear())},{default:U((()=>[J])),_:1}),S(r,{size:"small",type:"primary",loading:e.loading,onClick:t[3]||(t[3]=e=>o.handleSubmit())},{default:U((()=>[W])),_:1},8,["loading"])])])),default:U((()=>[S(d,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[1]||(t[1]=t=>e.submitForm=t),style:{"margin-top":"30px"},ref:"baseForm"},null,8,["form-data","submit-form"])])),_:1},8,["before-close","title","modelValue"])):O("",!0)])])}],["__scopeId","data-v-4065e983"]]);export{Y as default};
