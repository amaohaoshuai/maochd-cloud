var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,r=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&o(e,a,t[a]);return e},n=(e,i)=>t(e,a(i)),d=(e,t)=>{var a={};for(var o in e)l.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&i)for(var o of i(e))t.indexOf(o)<0&&s.call(e,o)&&(a[o]=e[o]);return a};import{_ as u}from"./SubmitButton.99d990fd.js";import{_ as c}from"./EditForm.8c35f1a6.js";import{_ as p}from"./BaseTable.36f55649.js";import{_ as m}from"./KeyBoard.96ba8d0b.js";import{_ as g}from"./BaseForm.bc55ad6b.js";import{_ as f}from"./BaseCard.46de0c24.js";import{a as b,b as h,c as y,e as v}from"./index.4384aed0.js";import{b as w,d as S,_ as x}from"./element-plus.b44d97a8.js";import{_ as C}from"./BaseName.1aa32b4b.js";import{_ as D}from"./lodash.d7ab6f48.js";import{G as j,j as k,D as F,g as U,t as z,B as _,o as L,a5 as B,e as P,w as N,a6 as T,z as I,c as M,v as q,F as V,N as E,S as O,a9 as G,aa as A}from"./@vue.23a4bd1a.js";import{_ as K,s as H}from"./index.ab904951.js";import{b as W}from"./vue-router.91336ba9.js";import"./vuex.c868d4e0.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./public.9c1d8f39.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";/* empty css                                                             */import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";let Z="";function R(e,t,a,i,l,s,o){return{columns:[{type:"selection",fixed:"left",align:"center",formConfig:{reserveSelection:!0}},{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"商品编号",key:"code",fixed:"left"},{title:"商品名称",key:"productName",width:180,formConfig:{"show-overflow-tooltip":!1},fixed:"left",render:e=>(e.name=e.productName,j(C,{row:e}))},{title:"零售价",key:"retailPrice",align:"right"},{title:"最后进价",key:"purchasePrice",align:"right"},{title:"毛利率%",key:"grossMargin",align:"right"},{title:"批准文号",key:"approvalNumber"},{title:"操作",key:"options",render:(t,i,l,s)=>j("div",[{type:"text",innerHTML:"删除",onClick:()=>{let i=e(),l=D.findIndex(i,{productUuid:t.productUuid});i.splice(l,1),a()},style:{color:"#f56c6c"}}].map((e=>{if(!e.show)return j(S,e)})))}],columns2:[{type:"selection",title:"序号",fixed:"left",width:50,align:"center",formConfig:{selectable:t=>{let a=e();return D.findIndex(a,{productUuid:t.productUuid})<0}}},{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"商品编码",key:"code"},{title:"商品名称",key:"name",width:180},{title:"商品类别",key:"category1"},{title:"剂型",key:"dosageForm"},{title:"规格",key:"specification"},{title:"单位",key:"unit"},{title:"零售价",key:"retailPrice",align:"right"},{title:"最后进价",key:"purchasePrice",align:"right"},{title:"毛利率%",key:"grossMargin",align:"right"},{title:"供应商名称",key:"latestSupplier"},{title:"生产厂家",key:"manufacturer"}],formData:{inline:!0,labelWidth:"70px",config:{size:"small"},list:[{type:"INPUT",placeholder:"请输入,不超过20字",label:"柜组编号",key:"code",span:5,maxlength:20},{type:"INPUT",placeholder:"请输入,不超过100字",label:"柜组名称",key:"name",span:5,require:!0},{type:"SELECT",placeholder:"请选择",label:"门店",key:"mechanismUuid",span:5,require:!0,rules:[{required:!0,message:"请选择门店",trigger:"change"}],config:{onChange:a=>{let l=D.find(t(),{uuid:a}),r=i();r.mechanismUuid=l.uuid;let n=e();0==n.length&&(Z=r.mechanismUuid),n.length>0&&w.confirm("切换当前门店会清空数据!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{o.tableData=[],Z=r.mechanismUuid})).catch((()=>{let e=s();e&&(Z=e),""!=r.mechanismUuid&&(r.mechanismUuid=Z)}))}},design:{width:"224px"},props:{label:"name",value:"uuid"},list:()=>t()}]},formData2:{inline:!0,labelWidth:"82px",config:{size:"medium"},list:[{type:"SELECT",placeholder:"请选择",label:"商品类别",key:"category1",design:{width:"350px"},props:{label:"label",value:"value"},list:()=>l()},{type:"INPUT",placeholder:"名称/编号/助记码",label:"商品名称",key:"uniteField",design:{width:"350px"}}]},selectEnable:e=>!0}}const{status:J,allCategoryList:Q,dict:X}=H.state.common,Y={name:"CabinetGroupEdit",components:{BaseCard:f,SubmitButton:u,EditForm:c,BaseTable:p},setup(e,t){const a=k({pot:0,tableData:[],findList:[],getDictList:[]}),i=k({cacheData:[],oldBusiness:"",isFlag:!0,filterZeroStock:1,pagination:{page:1,size:10,total:100},query:"***",title:"组柜管理详情",tabClose:!1,tableData2:[],submitForm:{},multipleSelectionList:[],multipleSelectionList1:[],formConfig:{rowKey:e=>e.uuid},formConfig2:{rowKey:e=>e.uuid},optionShow:!1,loading:!1,options:[],value:"",baseTable:null,defaultConfig:R,dialogVisible:!1,submitForm1:{"page.currentPage":1,"page.pageSize":10},cacheAll:[]}),l=W();F((async()=>{i.query!==l.query.uuid&&(i.query=l.query.uuid,a.findList=await H.dispatch("common/mechanism")||[],void 0===l.query.uuid&&(i.submitForm={},a.tableData=[]),l.query.uuid?(i.submitForm.uuid=l.query.uuid,i.title="编辑柜组",await u()):a.findList&&a.findList.length&&(i.submitForm.mechanismUuid=a.findList[0].uuid))}));const s=U(null);const o=async()=>{let e=n(r({},i.submitForm1),{businessUuid:i.submitForm.mechanismUuid,cabinetGroupUuid:i.submitForm.uuid});b(e).then((e=>{let t=[];e.records.forEach((e=>{let a=e,{info:i}=a,l=d(a,["info"]);t.push(r(r({},i),l))})),i.tableData2=t,i.submitForm1.total=e.total}))},u=()=>{h(i.submitForm.uuid).then((e=>{let t=e,{productInfo:l}=t,s=d(t,["productInfo"]);i.submitForm=s,i.oldBusiness=s.mechanismUuid,a.tableData=l}))};const c=U(null);const p=k(R((()=>a.tableData),(()=>a.findList),(()=>a.pot),(()=>i.submitForm),(()=>a.getDictList),(()=>i.oldBusiness),a)),m=()=>{if(X.length>0){return X.filter(((e,t)=>"category1"===e.key))[0].data.map((e=>({value:e.key,label:e.key})))}},g=()=>{w.confirm("请选择门店后,再进行操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{i.isFlag=!0})).catch((()=>{i.isFlag=!0}))};return n(r(r(r({handlcurrentChange:e=>{i.pagination.page=e},handlSizeChange:e=>{i.pagination.size=e}},z(i)),z(a)),z(p)),{remoteMethod:function(e){i.isFlag&&(i.submitForm.mechanismUuid||(i.isFlag=!1),0==i.submitForm.mechanismUuid.length)?g():""!==e?(i.loading=!0,setTimeout((()=>{i.loading=!1,y({invincible:e,cabinetGroupUuid:i.submitForm.uuid,businessUuid:i.submitForm.mechanismUuid,cabinetGroupFlag:1,filterZeroStock:0}).then((e=>{let t=e.map((e=>{let t=e,{info:a}=t,i=d(t,["info"]);return a.name=a.productName,r(r({},a),i)}));i.options=t}))}),200)):i.options=[]},getStr:e=>e||!e&0===e?e:"-",drugChange:()=>{let e=D.findIndex(i.options,{uuid:i.value});a.tableData.unshift(r({},i.options[e])),i.value="",i.options=[],a.pot=a.tableData.length-1},isDisabled:e=>D.findIndex(a.tableData,{productUuid:e})>-1,multipleSelection:e=>{i.multipleSelectionList=e},submitMsg:async e=>{if(0==i.submitForm.mechanismUuid.length)return void g();if(!c.value.handleClick(e))return;if(!i.baseTable.verification())return;let t=[];a.tableData.forEach((e=>{let a=e,{approvalNumber:i,code:l,grossMargin:s,productName:o,productUuid:r,purchasePrice:n,retailPrice:u}=a;d(a,["approvalNumber","code","grossMargin","productName","productUuid","purchasePrice","retailPrice"]);t.push({approvalNumber:i,code:l,grossMargin:s,productName:o,productUuid:r,purchasePrice:n,retailPrice:u})}));const l=n(r({},i.submitForm),{productInfo:t});v(l).then((e=>{i.tabClose=!0}))},editForm:c,selectForm:s,addMsg:async function(){0!=i.submitForm.mechanismUuid.length?(await o(),i.dialogVisible=!0,a.getDictList=m(),i.cacheData=D.cloneDeep(a.tableData)):g()},getList:o,getDictList:m,del:function(){if(0!=i.submitForm.mechanismUuid.length)if(0!=i.multipleSelectionList.length){for(let e=a.tableData.length-1;e>=0;e--){D.findIndex(i.multipleSelectionList,{uuid:a.tableData[e].uuid})>-1&&a.tableData.splice(e,1)}i.pot=0}else x.warning({message:"还未选择商品！",type:"warning"});else g()},handleSubmit:function(){let e=D.cloneDeep(D.differenceBy(i.multipleSelectionList1,a.tableData,"productUuid")).map((e=>(e.drugUuid=e.productUuid,e.productName=e.name,"正常"===e.purchaseState?e.purchaseState=1:e.purchaseState=2,"正常"===e.saleState?e.saleState=1:e.saleState=2,e)));a.tableData=[...a.tableData,...e],i.multipleSelectionList1=[],i.dialogVisible=!1},multipleSelectionDrugs:e=>{i.cacheAll[i.submitForm1["page.currentPage"]-1]=e,i.cacheData=[].concat.apply([],i.cacheAll),i.cacheData=[...i.cacheData,...e],i.cacheData=D.uniqBy(i.cacheData,"productUuid"),i.multipleSelectionList1=i.cacheData},handleClose:()=>{s.value.handleRest(!1),i.tableData2=[]},submitTips:g,drugBlur:()=>{i.value="",i.options=[]}})}},$=e=>(G("data-v-a5ee0f1c"),e=e(),A(),e),ee={class:"supplierAdd",id:"tab"},te={style:{"font-size":"16px"}},ae=O(" 批量添加商品 "),ie=O(" 批量删除 "),le=O(" 完成 "),se={class:"main"},oe={class:"block"},re={class:"add-msg"},ne=$((()=>T("i",{class:"el-icon-plus"},null,-1))),de=$((()=>T("div",{class:"space-list"},[T("div",{class:"space",style:{width:"80px"}},"编号"),T("div",{class:"space",style:{width:"150px"}},"商品名称"),T("div",{class:"space",style:{width:"150px"}},"规格"),T("div",{class:"space",style:{width:"50px"}},"单位"),T("div",{class:"space",style:{width:"180px"}},"生产厂家"),T("div",{class:"space",style:{width:"110px"}},"零售价"),T("div",{class:"space",style:{width:"110px"}},"最后进价"),T("div",{class:"space",style:{width:"110px"}},"毛利率%")],-1))),ue={class:"space-list"},ce={style:{width:"80px"}},pe={class:"space",style:{width:"150px"}},me={class:"space",style:{width:"150px"}},ge={class:"space",style:{width:"50px"}},fe={class:"space",style:{width:"180px"}},be={class:"space",style:{width:"110px"}},he={class:"space",style:{width:"110px"}},ye={class:"space",style:{width:"110px"}},ve={class:"dialog-footer"},we=O(" 取 消 "),Se=O(" 确 定 ");var xe=K(Y,[["render",function(e,t,a,i,l,s){const o=_("el-button"),r=u,n=c,d=p,b=_("el-pagination"),h=_("el-option"),y=_("el-select"),v=m,w=_("el-scrollbar"),S=g,x=_("el-dialog"),C=f;return L(),B("div",ee,[P(C,{close:e.tabClose,route:{path:"/system/cabinet-group"}},{header:N((()=>[T("span",te,I(e.title),1),T("div",null,[P(o,{type:"primary",size:"small",onClick:t[0]||(t[0]=e=>i.addMsg())},{default:N((()=>[ae])),_:1}),P(o,{type:"danger",size:"small",onClick:t[1]||(t[1]=e=>i.del())},{default:N((()=>[ie])),_:1}),P(r,{size:"small",class:"btn",config:{size:"medium"},onClick:t[2]||(t[2]=e=>i.submitMsg(!0))},{default:N((()=>[le])),_:1})])])),default:N((()=>[T("div",null,[P(w,null,{default:N((()=>[P(v,{ref:"keyBoard",data:e.tableData.slice((e.pagination.page-1)*e.pagination.size,(e.pagination.page-1)*e.pagination.size+e.pagination.size),down:[".el-table__body-wrapper  .el-table__row"],range:[0,1,2,3],first:".main .select-input",pot:e.pot},{default:N((()=>[T("div",se,[P(n,{"form-data":e.formData,"onUpdate:form-data":t[3]||(t[3]=t=>e.formData=t),"submit-form":e.submitForm,"onUpdate:submit-form":t[4]||(t[4]=t=>e.submitForm=t),ref:"editForm"},null,8,["form-data","submit-form"]),P(d,{class:"select-table","table-data":e.tableData.slice((e.pagination.page-1)*e.pagination.size,(e.pagination.page-1)*e.pagination.size+e.pagination.size),formConfig:e.formConfig,columns:e.columns,optionShow:e.optionShow,multipleSelection:i.multipleSelection,ref:"baseTable","class-id":"tab","reduce-num":160},null,8,["table-data","formConfig","columns","optionShow","multipleSelection"]),T("div",oe,[P(b,{"current-page":e.pagination.page,"page-sizes":[10,20,50,100],"page-size":e.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length,onCurrentChange:i.handlcurrentChange,onSizeChange:i.handlSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),T("div",re,[ne,P(y,{class:"select-input",modelValue:e.value,"onUpdate:modelValue":t[5]||(t[5]=t=>e.value=t),filterable:"",remote:"",size:"small",style:{width:"350px"},"reserve-keyword":"",onChange:i.drugChange,placeholder:"请输入商品编码/助记码/商品名称/条码","remote-method":i.remoteMethod,loading:e.loading,onClick:i.drugBlur},{default:N((()=>[e.options.length?(L(),M(h,{key:0,disabled:"",value:"-999",label:"-999"},{default:N((()=>[de])),_:1})):q("",!0),(L(!0),B(V,null,E(e.options,(e=>(L(),M(h,{key:e.uuid,label:i.getStr(e.productName),disabled:i.isDisabled(e.productUuid),value:e.uuid},{default:N((()=>[T("div",ue,[T("div",ce,I(i.getStr(e.code)),1),T("div",pe,I(i.getStr(e.productName)),1),T("div",me,I(i.getStr(e.dosageForm)),1),T("div",ge,I(i.getStr(e.specification)),1),T("div",fe,I(i.getStr(e.manufacturer)),1),T("div",be,I(i.getStr(e.retailPrice)),1),T("div",he,I(i.getStr(e.purchasePrice)),1),T("div",ye,I(i.getStr(e.grossMargin)),1)])])),_:2},1032,["label","disabled","value"])))),128))])),_:1},8,["modelValue","onChange","remote-method","loading","onClick"])])])])),_:1},8,["data","down","pot"])])),_:1})]),P(x,{title:"请选择商品",modelValue:e.dialogVisible,"onUpdate:modelValue":t[8]||(t[8]=t=>e.dialogVisible=t),width:"1200px",onClosed:i.handleClose},{footer:N((()=>[T("span",ve,[P(o,{size:"small",onClick:t[7]||(t[7]=t=>e.dialogVisible=!1)},{default:N((()=>[we])),_:1}),P(o,{size:"small",type:"primary",loading:e.loading,onClick:i.handleSubmit},{default:N((()=>[Se])),_:1},8,["loading","onClick"])])])),default:N((()=>[P(S,{"form-data":e.formData2,options:!0,"submit-form":e.submitForm1,"onUpdate:submit-form":t[6]||(t[6]=t=>e.submitForm1=t),select:i.getList,ref:"selectForm"},null,8,["form-data","submit-form","select"]),P(d,{maxHeight:385,"table-data":e.tableData2,pagination:e.submitForm1,columns:e.columns2,optionShow:e.optionShow,formConfig:e.formConfig2,select:i.getList,"single-select":i.multipleSelectionDrugs,"all-select":i.multipleSelectionDrugs,cache:e.cacheData,cacheKey:"productUuid"},null,8,["table-data","pagination","columns","optionShow","formConfig","select","single-select","all-select","cache"])])),_:1},8,["modelValue","onClosed"])])),_:1},8,["close"])])}],["__scopeId","data-v-a5ee0f1c"]]);export{xe as default};
