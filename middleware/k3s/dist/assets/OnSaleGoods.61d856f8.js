var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,l=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,r=(e,t)=>{for(var o in t||(t={}))s.call(t,o)&&l(e,o,t[o]);if(i)for(var o of i(t))a.call(t,o)&&l(e,o,t[o]);return e},n=(e,i)=>t(e,o(i));import{_ as c}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./SelectTable.80e1f2f6.js";import{_ as u}from"./BaseTable.36f55649.js";import{_ as m}from"./BaseName.1aa32b4b.js";import{e as p}from"./element-resize-detector.5b0b5621.js";import{u as f}from"./vuex.c868d4e0.js";import{_ as h,b}from"./element-plus.b44d97a8.js";import{b as g}from"./BatchNumber.b846d4bb.js";import{_ as y}from"./index.ab904951.js";import{a as v}from"./axios.7b768d2b.js";import{e as w}from"./index.97161d3f.js";import{j as L,i as k,t as j,B as C,o as I,c as D,w as S,e as T,a6 as P,S as U,n as x,D as N,q as O,a5 as B}from"./@vue.23a4bd1a.js";import"./lodash.d7ab6f48.js";import{g as E,f as _}from"./filter.c2c8f0b9.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";/* empty css                                                             */import"./batch-processor.94093b2a.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";function F(e){return v.post("/gateway/chain-store/specialoffer/delete",e)}const G={name:"AddGoodsDialog",props:{visibility:{type:Boolean,default:()=>!1},submitForm:{type:Object,default:()=>Object},storeList:{type:Object,default:()=>Object}},emits:["getSaleGoodData","update:visibility"],setup(e,{emit:t}){const o=L({dialogShow:!1,dialogBaseTable:null,columns:[{type:"selection",width:55},{title:"序号",type:"index",formConfig:{width:50}},{title:"商品编码",key:"code"},{title:"商品名称",key:"name",width:180},{title:"门店",key:"business",formConfig:{"min-width":150}},{title:"剂型",key:"dosageForm"},{title:"规格",key:"specification",width:120},{title:"毛利率(%)",key:"grossMargin"},{title:"库存数量",width:100,key:"overallPackNum"},{title:"生产厂家",key:"manufacturer",width:180}],items:[],tableData:[],info:{"page.pageSize":10,"page.currentPage":1},formData:{inline:!0,labelWidth:"90px",list:[{label:"商品编号",key:"productCode",type:"INPUT"},{label:"商品名称",key:"productName",type:"INPUT"}]},chooseListId:[],chooseList:[]}),i=()=>{w(o.info).then((e=>{let{total:t,records:i}=e;i.forEach((e=>{o.chooseListId.includes(e.uuid)&&o.dialogBaseTable.elTable.toggleRowSelection(e,!0)})),o.info.total=t,o.tableData=i}))};return k((()=>e.visibility),(t=>{o.dialogShow=t,o.info.businessUuid=e.submitForm.businessUuid,i()})),n(r({},j(o)),{singleSelection:(e,t)=>{o.chooseListId.includes(t.uuid)?o.chooseListId.forEach(((e,i)=>{e===t.uuid&&(o.chooseListId.splice(i,1),o.chooseList.splice(i,1))})):(o.chooseListId.push(t.uuid),o.chooseList.push(t))},allSelection:e=>{e.length>0?e.forEach((e=>{o.chooseListId.includes(e.uuid)||(o.chooseListId.push(e.uuid),o.chooseList.push(e))})):o.tableData.forEach((e=>{o.chooseListId.forEach(((t,i)=>{t===e.uuid&&(o.chooseListId.splice(i,1),o.chooseList.splice(i,1))}))}))},getOrder:i,handleDetermine:()=>{var e;o.chooseList.length?(e=o.chooseList,v.post("/gateway/chain-store/specialoffer/savebatch",e)).then((e=>{o.chooseListId=[],o.chooseList=[],o.dialogBaseTable.elTable.clearSelection(),o.info.productCode="",o.info.productName="",t("update:visibility",!1),t("getSaleGoodData")})):h.error("请先选择商品！")},cancelChoose:()=>{t("update:visibility",!1),o.chooseListId=[],o.chooseList=[],o.dialogBaseTable.elTable.clearSelection(),o.info.productCode="",o.info.productName=""},beforeClose:()=>{t("update:visibility",!1),o.chooseListId=[],o.chooseList=[],o.dialogBaseTable.elTable.clearSelection(),o.info.productCode="",o.info.productName=""}})}},A={class:"dialog-footer"},z=U("取 消"),V=U("确 定");var M={name:"OnSaleGoods",components:{AddGoodsDialog:y(G,[["render",function(e,t,o,i,s,a){const l=c,r=u,n=C("el-button"),d=C("el-dialog");return I(),D(d,{title:"添加商品",modelValue:e.dialogShow,"onUpdate:modelValue":t[2]||(t[2]=t=>e.dialogShow=t),width:"70%","before-close":i.beforeClose},{default:S((()=>[T(l,{"form-data":e.formData,"onUpdate:form-data":t[0]||(t[0]=t=>e.formData=t),"submit-form":e.info,"onUpdate:submit-form":t[1]||(t[1]=t=>e.info=t),options:!0,select:i.getOrder},null,8,["form-data","submit-form","select"]),T(r,{ref:"dialogBaseTable",columns:e.columns,"table-data":e.tableData,"fixed-head":!1,"option-show":!1,pagination:e.info,"single-select":i.singleSelection,"all-select":i.allSelection,select:i.getOrder},null,8,["columns","table-data","pagination","single-select","all-select","select"]),P("div",A,[T(n,{onClick:i.cancelChoose},{default:S((()=>[z])),_:1},8,["onClick"]),T(n,{type:"primary",onClick:i.handleDetermine},{default:S((()=>[V])),_:1},8,["onClick"])])])),_:1},8,["modelValue","before-close"])}],["__scopeId","data-v-119c1156"]])},setup(){const e=new Date;let t=E(e,30,!0),o=f(),i=L({storeList:[],selectArr:[]}),s=L({storeList:[],baseTable:null,height:750,visibility:!1,dialogShow:!1,selectParams:{invincible:""},keys:["code","name","dosageForm","specification","manufacturer"],columns:[{type:"selection",fixed:"left"},{title:"序号",type:"index",fixed:"left",formConfig:{width:50}},{title:"商品编码",key:"code",formConfig:{"show-overflow-tooltip":!1,"min-width":150},fixed:"left"},{title:"商品名称",width:300,fixed:"left",formConfig:{"show-overflow-tooltip":!1},render:e=>T(m,{row:e},null)},{title:"整装库存",key:"overallPackNum",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"门店",key:"business",formConfig:{"min-width":150}},{title:"拆零库存",key:"deleavePackNum",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"零售价",key:"retailPrice",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"拆零零售价",key:"retailPriceSplit",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"成本进价",key:"overallPackPrice",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"拆零成本进价",key:"deleavePackPrice",formConfig:{"show-overflow-tooltip":!1,"min-width":110},align:"right"},{title:"积分获取",key:"earnPoints",formConfig:{"show-overflow-tooltip":!1,"min-width":110},render:(e,t,o,i)=>T(C("el-switch"),{modelValue:e.earnPoints,activeValue:1,inactiveValue:0,onChange:t=>{l(e,t)}},null)},{title:"添加人",key:"creator",formConfig:{"show-overflow-tooltip":!1,"min-width":100}},{title:"添加时间",key:"createTime",width:180},{title:"操作",key:"options",width:70,render:(e,t,o,i)=>T(C("el-button"),{type:"text",class:"delete",onClick:()=>{b.confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{F([e.uuid]).then((t=>{s.chooseListId.forEach(((t,o)=>{t===e.uuid&&s.chooseListId.splice(o,1)})),s.chooseList.forEach(((t,o)=>{t.uuid===e.uuid&&s.chooseList.splice(o,1)})),a()}))}))}},{default:()=>[U("删除")]})}],formData:{labelWidth:"70px",span:8,inline:!0,list:[{type:"INPUT",placeholder:"编码/条形码/商品名/助记码",key:"invincible"},{placeholder:"请输入添加人",type:"INPUT",key:"creator"},{label:"",type:"SELECT",placeholder:"请选择门店",key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>i.storeList},{type:"LINKAGETIME",keys:["startCreateDate","endCreateDate"],design:{width:"250px"},key:"planDate",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}}]},submitForm:{"page.currentPage":1,"page.pageSize":10,userName:o.state.userInfo.info.userName,orderField:"createTime",orderDirection:"desc",startCreateDate:t[0],endCreateDate:_(new Date),businessUuid:[]},chooseListId:[],chooseList:[],tableData:[]});const a=async()=>{var e;s.storeList=i.storeList,(e=s.submitForm,v.get("/gateway/chain-store/specialoffer/pagelist",{params:e})).then((e=>{let{list:t,totalCount:o}=e;t.forEach((e=>{s.chooseListId.includes(e.uuid)&&s.baseTable.elTable.toggleRowSelection(e,!0)})),s.tableData=t,s.submitForm.total=o}))},l=(e,t)=>{var o,i;e.earnPoints=t,o=e.uuid,i=t,v.post(`/gateway/chain-store/specialoffer/enable/${o}?earnPoints=${i}`)};x((()=>{(()=>{const e=p();setTimeout((()=>{e.listenTo(document.getElementById("tab"),(e=>{O((()=>{s.height=e.offsetHeight-200}))}))}),200)})()})),N((async()=>{i.storeList=await o.dispatch("common/mechanism"),s.submitForm.businessUuid=i.storeList[0].uuid,a()}));return n(r(r({},j(i)),j(s)),{singleSelection:(e,t)=>{s.chooseListId.includes(t.uuid)?s.chooseListId.forEach(((e,o)=>{e===t.uuid&&(s.chooseListId.splice(o,1),s.chooseList.splice(o,1))})):(s.chooseListId.push(t.uuid),s.chooseList.push(t))},allSelection:e=>{e.length>0?e.forEach((e=>{s.chooseListId.includes(e.uuid)||(s.chooseListId.push(e.uuid),s.chooseList.push(e))})):s.tableData.forEach((e=>{s.chooseListId.forEach(((t,o)=>{t===e.uuid&&(s.chooseListId.splice(o,1),s.chooseList.splice(o,1))}))}))},handleInput:async e=>{let{selectParams:t}=s,{businessUuid:o}=s.submitForm;t.invincible=e;let a=n(r({},t),{businessUuid:o});const l=(await g(a)).map((e=>{let t=e.info;return t.name=e.info.productName,t.productUuid=e.productUuid,t.drugUuid=e.productUuid,t.businessUuid=e.businessUuid,t.onlyUuid=e.businessUuid+e.productUuid,t.overallPackNum=e.overallPackNum,t}));i.selectArr=l},handleChange:e=>{var t;i.selectArr=[],(t=e,v.post("/gateway/chain-store/specialoffer/save",t)).then((e=>{a()}))},addGoodsDialog:()=>{s.visibility=!0},getSaleGoodData:a,batchDelete:()=>{b.confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{F(s.chooseListId).then((()=>{a()}))}))},clearMsg:()=>{i.selectArr=[]}})}};const H={class:"stencil",id:"tab"},R={class:"top"},W={class:"box"},$={class:"main"},q={class:"content"},K={class:"getInfo"},J=U(" 批量新增 "),Q=U(" 删除 ");var X=y(M,[["render",function(e,t,o,i,s,a){const l=c,r=C("el-button"),n=d,m=u,p=C("add-goods-dialog");return I(),B("div",H,[P("div",R,[P("div",W,[T(l,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),options:!0,select:i.getSaleGoodData},null,8,["form-data","submit-form","select"])])]),P("div",$,[P("div",q,[T(m,{class:"select-table",columns:e.columns,"table-data":e.tableData,"fixed-head":!1,pagination:e.submitForm,"single-select":i.singleSelection,"all-select":i.allSelection,select:i.getSaleGoodData,reduceNum:110,classId:"tab",ref:"baseTable"},{buttons:S((()=>[P("div",K,[T(r,{type:"primary",size:"small",onClick:i.addGoodsDialog},{default:S((()=>[J])),_:1},8,["onClick"]),T(r,{type:"danger",size:"small",onClick:i.batchDelete},{default:S((()=>[Q])),_:1},8,["onClick"])])])),selectTable:S((()=>[T(n,{class:"select-input",keys:e.keys,options:e.selectArr,"onUpdate:options":t[1]||(t[1]=t=>e.selectArr=t),placeholder:"请输入商品编码/助记码/商品名称/条码",onOnInput:i.handleInput,onOnChange:i.handleChange,onClear:i.clearMsg,props:{label:"userName",value:"drugUuid"}},null,8,["keys","options","onOnInput","onOnChange","onClear"])])),_:1},8,["columns","table-data","pagination","single-select","all-select","select"])])]),T(p,{visibility:e.visibility,"onUpdate:visibility":t[2]||(t[2]=t=>e.visibility=t),submitForm:e.submitForm,storeList:e.storeList,onGetSaleGoodData:i.getSaleGoodData},null,8,["visibility","submitForm","storeList","onGetSaleGoodData"])])}],["__scopeId","data-v-749db172"]]);export{X as default};
