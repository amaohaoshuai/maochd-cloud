var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,l=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,n=(e,t)=>{for(var i in t||(t={}))s.call(t,i)&&l(e,i,t[i]);if(a)for(var i of a(t))r.call(t,i)&&l(e,i,t[i]);return e},o=(e,a)=>t(e,i(a)),u=(e,t)=>{var i={};for(var l in e)s.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&r.call(e,l)&&(i[l]=e[l]);return i};import{_ as d}from"./BaseStencil.46c3d678.js";import{_ as m}from"./BaseName.1aa32b4b.js";import{G as p,e as c,o as f,a5 as b,a6 as h,z as y,F as g,N as v,a9 as j,aa as w,g as k,j as x,D as F,t as U,B as z,L as P,w as T,J as N,S as D}from"./@vue.23a4bd1a.js";import{_ as C}from"./index.ab904951.js";import{a as S}from"./axios.7b768d2b.js";import{d as B}from"./index.7c4fa9df.js";import{_}from"./element-plus.b44d97a8.js";import{u as O}from"./vue-router.91336ba9.js";import{u as E}from"./vuex.c868d4e0.js";import{s as I,g as L}from"./businessRule.60794e55.js";import{d as V}from"./index.d0e41a43.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";/* empty css                                                             */import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";const q=["name","specification","unit","manufacturer"];function A(e,t,i){return{form:{inline:!0,labelWidth:"0px",list:[{type:"INPUT",key:"fuzzyValue",placeholder:"请输入商品名/编码/助记码"},{type:"INPUT",key:"days",placeholder:"请输入有效期天数"},{type:"SELECT",placeholder:"门店",props:{label:"name",value:"uuid"},list:()=>t.value,key:"businessUuid",config:{multiple:!0}}]},tableConfig:{columns:[{title:"序号",key:"",type:"index",fixed:"left",formConfig:{width:50}},{title:"商品编号",key:"code",width:90,fixed:"left"},{title:"商品名称/规格/单位/生产厂家",key:"name",fixed:"left",formConfig:{"show-overflow-tooltip":!1,"min-width":220},render:e=>p(m,{row:e,list:q})},{title:"剂型",key:"dosageForm",width:90},{title:"批号",key:"batchNum",width:180},{title:"生产日期",key:"producedTime",width:210},{title:"有效期至",key:"indate",width:210},{title:"效期天数",key:"differvalue",width:130,sortable:!0,render:e=>e.differvalue<0?c("div",{style:"color:red;"},[e.differvalue?e.differvalue+"天":"0天"]):t.days>=e.differvalue>0?c("div",{style:"color:#FA6400;"},[e.differvalue?e.differvalue+"天":"0天"]):e.differvalue>t.days?c("div",null,[e.differvalue?e.differvalue+"天":"0天"]):void 0},{title:"库存数量",align:"right",width:130,render:e=>{let t=(0==e.overallPackNum?"0"+e.unit:e.overallPackNum?e.overallPackNum+e.unit:"")+(e.deleavePackNum?e.deleavePackNum+e.splitUnit:"");return t||"-"}},{title:"成本进价",key:"overallPackPrice",align:"right",width:110},{title:"成本金额",key:"totalPrice",align:"right",width:110},{title:"入库时间",key:"inStorageDate",align:"right",width:130},{title:"供应商",key:"supplierName",align:"right",width:130},{title:"零售价",key:"retailPrice",align:"right",width:110},{title:"零售金额",key:"sumRetailPrice",align:"right",width:110},{title:"门店",key:"business",width:110}]}}}function H(e){return S.get("/gateway/chain-store/expire/sale/query/print",{params:e})}const R={name:"PrintTemp",props:{printData:{type:Array,default:()=>[]},printBusiness:{type:String,default:()=>""},thisdate:{type:String,default:()=>""}},setup(){}},G=e=>(j("data-v-21227f3f"),e=e(),w(),e),J={class:"printTemp",ref:"printTemp",id:"printTemp"},M={style:{padding:"0 6mm"}},W=G((()=>h("tr",{style:{height:"6mm"}},null,-1))),Y=G((()=>h("tr",{style:{height:"6mm"}},[h("th",{style:{"text-align":"center","font-size":"4mm","font-weight":"bold",height:"6mm"},colspan:"12"},"近效期催销表")],-1))),K={style:{"text-align":"left","font-size":"4mm","font-weight":"bold"}},Q={colspan:"4"},X=G((()=>h("span",null,"打印日期:",-1))),Z={colspan:"4"},$=G((()=>h("span",null,"机构:",-1))),ee=G((()=>h("tr",{style:{background:"rgb(228, 231, 237)"},class:"tableThead"},[h("th",null,"商品编号"),h("th",null,"商品名称"),h("th",null,"规格"),h("th",null,"单位"),h("th",null,"生产厂家"),h("th",null,"批号"),h("th",null,"有效期至"),h("th",null,"库存数量"),h("th",null,"效期天数"),h("th",null,"入库时间"),h("th",null,"供应商")],-1))),te={class:"tableBody"};var ie={name:"ExpeditingList",components:{PrintTemp:C(R,[["render",function(e,t,i,a,s,r){return f(),b("div",J,[h("div",M,[h("table",null,[h("thead",null,[W,Y,h("tr",K,[h("th",Q,[X,h("span",null,y(i.thisdate),1)]),h("th",Z,[$,h("span",null,y(i.printBusiness),1)])]),ee]),(f(!0),b(g,null,v(i.printData,((e,t)=>(f(),b("tbody",{key:t,style:{color:"#000"}},[h("tr",te,[h("td",null,y(e.code),1),h("td",null,y(e.name),1),h("td",null,y(e.specification),1),h("td",null,y(e.unit),1),h("td",null,y(e.manufacturer),1),h("td",null,y(e.batchNum),1),h("td",null,y(e.indate),1),h("td",null,y(e.overallPackNum+e.unit)+y(e.deleavePackNum?e.deleavePackNum+e.splitUnit:""),1),h("td",null,y(e.differvalue),1),h("td",null,y(e.inStorageDate),1),h("td",null,y(e.supplierName),1)])])))),128))])])],512)}],["__scopeId","data-v-21227f3f"]])},setup(e,t){O(),k(null);const i=k([]);let a=E();const s=x({isClear:!1,excelUrl:"",loading:!1,tableData:[],expeditingTable:[],deepSearchTable:A(0,i),printBusiness:"",printObj:{id:"#printTemp",extraHead:'<meta http-equiv="Content-Language" content="zh-cn" />',openCallback(e){s.dialogShow=!1}},printData:[],thisdate:"",submitForm:{"page.currentPage":1,"page.pageSize":10,fuzzyValue:"",days:"",businessUuid:[],total:0,mechanism:[]}});F((async()=>{i.value=await a.dispatch("common/mechanism"),r(),await l(),d()}));const r=async()=>{let{storeUuid:e}=a.state.common.info;s.submitForm.storeUuid=e;let t=await V({name:"productIndate"});i.days=t.value,s.submitForm.orderField="differvalue",s.submitForm.orderDirection="asc"},l=async()=>{if(!Number.isInteger(parseFloat(s.submitForm.days))&&""!==s.submitForm.days)return void _.error("有效期天数只能为整数!");L(i.value,s,s.deepSearchTable.form);let e=s.submitForm,{businessUuid:t}=e,r=u(e,["businessUuid"]);t=I(t),function(e){return S.get("/gateway/chain-store/expire/sale/query/page",{params:e})}(n({businessUuid:t},r)).then((e=>{e.records.forEach((e=>{e.differValue=e.differValue+"天"})),s.loading=!0,s.expeditingTable=e.records,s.submitForm.total=e.total})).catch((e=>{})),H({days:s.submitForm.days,fuzzyValue:s.submitForm.fuzzyValue,businessUuid:t,storeUuid:a.state.common.info.storeUuid}).then((e=>{s.printData=e})),s.printBusiness=i.value[0].name},d=()=>{let e=new Date,t=e.getFullYear(),i=e.getMonth()+1,a=e.getDate();s.thisdate=t+"-"+i+"-"+a};return o(n({},U(s)),{getList:l,ExpeditingListExport:async()=>{if(!Number.isInteger(parseFloat(s.submitForm.days))&&""!==s.submitForm.days)return void _.error("有效期天数只能为整数!");let{storeUuid:e}=a.state.common.info,t=await a.dispatch("common/mechanism"),i="";i=s.submitForm.businessUuid.length?I(s.submitForm.businessUuid):t.map((e=>e.uuid)).join(",");let r=B("/gateway/chain-store/expire/sale/query/page/excel",o(n({},s.submitForm),{businessUuid:i,storeUuid:e}));window.open(r,"_self")},printTable:()=>{let e=s.submitForm,{businessUuid:t}=e;u(e,["businessUuid"]);t=I(t),H({days:s.submitForm.days,fuzzyValue:s.submitForm.fuzzyValue,businessUuid:t,storeUuid:a.state.common.info.storeUuid}).then((e=>{s.printData=e}))}})}};const ae={class:"supplier"},se=D(" 打印 "),re=D(" 导出 ");var le=C(ie,[["render",function(e,t,i,a,s,r){const l=z("el-button"),n=d,o=z("print-temp"),u=P("print");return f(),b("div",ae,[c(n,{"form-data":e.deepSearchTable.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.expeditingTable,columns:e.deepSearchTable.tableConfig.columns,pagination:e.submitForm,options:!0,optionShow:!1,select:a.getList,ref:"form",isClear:e.isClear},{buttons:T((()=>[N(c(l,{plain:"",size:"small",type:"primary",onClick:a.printTable},{default:T((()=>[se])),_:1},8,["onClick"]),[[u,e.printObj]]),c(l,{plain:"",size:"small",type:"primary",onClick:a.ExpeditingListExport},{default:T((()=>[re])),_:1},8,["onClick"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select","isClear"]),c(o,{printData:e.printData,printBusiness:e.printBusiness,thisdate:e.thisdate},null,8,["printData","printBusiness","thisdate"])])}],["__scopeId","data-v-d5893768"]]);export{le as default};
