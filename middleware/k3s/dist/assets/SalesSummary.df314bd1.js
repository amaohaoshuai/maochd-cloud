var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,s=(e,t)=>{for(var i in t||(t={}))l.call(t,i)&&r(e,i,t[i]);if(a)for(var i of a(t))o.call(t,i)&&r(e,i,t[i]);return e},n=(e,a)=>t(e,i(a)),m=(e,t)=>{var i={};for(var r in e)l.call(e,r)&&t.indexOf(r)<0&&(i[r]=e[r]);if(null!=e&&a)for(var r of a(e))t.indexOf(r)<0&&o.call(e,r)&&(i[r]=e[r]);return i};import{_ as d}from"./BaseStencil.46c3d678.js";/* empty css                                                             */import{_ as u}from"./index.ab904951.js";import{u as g}from"./vue-router.91336ba9.js";import{c,d as p,e as h,f as y,h as f,i as b,j as T,q as k}from"./RetailReport.1533bc91.js";import{g as w,f as x}from"./filter.c2c8f0b9.js";import{s as j,g as v}from"./businessRule.60794e55.js";import{_ as S}from"./lodash.d7ab6f48.js";import{X as A}from"./xlsx.8aa47afc.js";import{d as C}from"./index.7c4fa9df.js";import{u as P}from"./vuex.c868d4e0.js";import{g as F,j as U,n as N,D,t as _,e as E,S as L,G as M,q as O,B as z,L as B,o as I,a5 as V,J as q,w as R,a6 as G}from"./@vue.23a4bd1a.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";function H(e,t,i){return{form:{inline:!0,labelWidth:"100px",list:[{type:"SELECT",list:()=>i.value,config:{multiple:!0},props:{label:"name",value:"uuid"},key:"businessUuid",placeholder:"请选择门店"},{type:"LINKAGETIME",keys:["beginTime","endTime"],design:{width:"220px"},key:"createTime",config:{"start-placeholder":"请选择日期","end-placeholder":"请选择日期"}},{type:"INPUT",key:"employ",placeholder:"收银员",hidden:!0},{type:"INPUT",key:"sell",placeholder:"销售员",hidden:!0}]},tableConfig:{columnsFirst:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"日期",key:"createTime",width:124,fixed:"left"},{title:"汇总",key:"huizong",children:[{title:"应收金额",key:"orderAmount",width:124,align:"right"},{title:"实收金额",key:"payAmount",width:124,align:"right"},{title:"优惠金额",key:"discountAmount",width:135,align:"right"},{title:"抹零金额",key:"roundMoney",width:135,align:"right"},{title:"成本金额",key:"packPrice",width:124,align:"right"},{title:"毛利",key:"grossProfit",width:124,align:"right"},{title:"毛利率%",key:"grossMargin",width:124,align:"right"}]},{title:"零售",key:"lingshou",children:[{title:"实收金额",key:"lsAmount",width:124,align:"right"}]},{title:"医保",key:"huizong",children:[{title:"实收金额",key:"accountPayAmount",width:124,align:"right"},{title:"医保支付",key:"ybAmount",width:124,align:"right"},{title:"个人自付",key:"individualPayment",width:124,align:"right"},{title:"医保占比%",key:"insuranceProportion",width:124,align:"right"}]},{title:"客流量",key:"customerFlow",width:124,align:"right"},{title:"客单价",key:"customerPrice",width:124,align:"right"},{title:"门店",key:"business"}],columnsSecond:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"销售员",key:"sellName",fixed:"left"},{title:"日期",key:"createTime",width:110,fixed:"left"},{title:"应收金额",key:"orderAmount",align:"right",width:110},{title:"实收金额",key:"payAmount",align:"right",width:110},{title:"优惠金额",key:"discountAmount",align:"right",width:110},{title:"抹零金额",key:"roundMoney",align:"right",width:110},{title:"成本金额",key:"packPrice",align:"right",width:110},{title:"毛利",key:"grossProfit",align:"right"},{title:"毛利率%",key:"grossMargin",align:"right"},{title:"门店",key:"business"}],columnsThird:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"收银员",key:"employ",fixed:"left"},{title:"日期",key:"createTime",width:110,fixed:"left"},{title:"应收金额",key:"orderAmount",align:"right",width:110},{title:"实收金额",key:"payAmount",align:"right",width:110},{title:"优惠金额",key:"discountAmount",align:"right",width:110},{title:"抹零金额",key:"roundMoney",align:"right",width:110},{title:"充值金额",key:"rechargeAmount",width:124,align:"right"},{title:"赠送金额",key:"promotionalAmount",width:124,align:"right"},{title:"门店",key:"business"}],totalFirst:[{title:"合计"},{title:"xx"},{title:"应收金额合计",key:"orderAmountTotal"},{title:"实收金额合计",key:"payAmountTotal",align:"right"},{title:"优惠金额合计",key:"discountAmountTotal",align:"right"},{title:"抹零金额合计",key:"roundAmountTotal",align:"right"},{title:"成本金额合计",key:"packPriceAmountTotal",align:"right"},{title:"毛利合计",key:"grossProfitTotal",align:"right"},{title:"毛利率%",key:"grossMargin"},{title:"实收金额合计",key:"lsAmountTotal",align:"right"},{title:"实收金额合计",key:"ybAmountTotal",align:"right"},{title:"医保支付合计",key:"ybAmount",align:"right"},{title:"个人自付合计",key:"individualPaymentAmountTotal",align:"right"},{title:"医保占比%",key:"insuranceProportion"},{title:"客流量合计",key:"customerFlow"},{title:"客单价",key:"customerPrice",align:"right"}],totalSecond:[{title:"合计",align:"a"},{title:"xx",align:"a2"},{title:"",align:""},{title:"应收金额合计",key:"orderAmountTotal",align:"right"},{title:"实收金额合计",key:"payAmountTotal",align:"right"},{title:"优惠金额合计",key:"discountAmountTotal",align:"right"},{title:"抹零金额合计",key:"roundMoney",align:"right"},{title:"成本金额合计",key:"packPriceTotal",align:"right"},{title:"毛利合计",key:"grossProfitTotal",align:"right"},{title:"毛利率%",key:"grossMargin"}],totalThird:[{title:"合计",align:"a"},{title:"xx",align:"a2"},{title:""},{title:"应收金额合计",key:"orderAmountTotal",align:"right"},{title:"实收金额合计",key:"payAmountTotal",align:"right"},{title:"优惠金额合计",key:"discountAmountTotal",align:"right"},{title:"抹零金额合计",key:"roundMoney",align:"right"},{title:"充值金额合计",key:"rechargeAmount",align:"right"},{title:"赠送金额合计",key:"promotionalAmount",align:"right"}]}}}var J={name:"SalesDaySummary",setup(e,t){const i=P(),a=F(null),{dict:l}=i.state.common;i.state.common.info;const o=F([]),r=g(),d=new Date;let u=w(d,30,!0);const z=U({storeList:[],isClear:!1,total:0,excelUrl:"",design:{width:"470px"},activeName:"first",dict:l,otherData:{},tableData:[],exctlLoading:!1,loading:!1,formConfig:{"show-summary":!0,border:!0},deepSearchTable:H(0,0,o),submitForm:{"page.currentPage":1,"page.pageSize":10,sell:"",employ:"",orderField:"createTime",orderDirection:"desc",beginTime:"",endTime:"",businessUuid:[]},saleTotal:{},salesColumns:[],salesColumnsbtn:[],getPayType:[],name:"totalFirst"}),B=async()=>{z.loading=!0;try{let e=z.submitForm,{storeUuid:t,businessUuid:a}=e,l=m(e,["storeUuid","businessUuid"]),o=n(s({storeUuid:i.state.common.info.storeUuid},l),{businessUuid:j(a)});if("first"==z.activeName)z.name="totalFirst",z.salesColumns=z.deepSearchTable.tableConfig.columnsFirst,z.deepSearchTable.form.list[2].hidden=!0,z.deepSearchTable.form.list[3].hidden=!0,c(o).then((e=>{z.loading=!1,z.tableData=e.list,z.submitForm.total=e.totalElements})),p(o).then((e=>{z.loading=!1,z.saleTotal=e}));else if("second"==z.activeName)z.name="totalSecond",z.salesColumns=z.deepSearchTable.tableConfig.columnsSecond,z.deepSearchTable.form.list[2].hidden=!0,z.deepSearchTable.form.list[3].hidden=!1,h(o).then((e=>{z.loading=!1,z.tableData=e.list,z.submitForm.total=e.totalElements})),y(o).then((e=>{z.loading=!1,z.saleTotal=e}));else if("third"==z.activeName){z.name="totalThird";let e=await f({});z.getPayType=e;let t=[];e.forEach((e=>{let i={title:e.payTypeName,key:e.payType+"ss",render:t=>{let i=t.payTypeUseTotalVos.find((t=>t.payType==e.payType));return M("span",{innerText:i?i.payMoney:"0"})}};t.push(i)}));let i=S.cloneDeep(z.deepSearchTable.tableConfig.columnsThird),a=i.splice(i.length-3,3);z.salesColumns=[...i,...t,...a],z.deepSearchTable.form.list[2].hidden=!1,z.deepSearchTable.form.list[3].hidden=!0;let l=await b(o);l&&(z.tableData=l.list,z.submitForm.total=l.totalElements),T(o).then((e=>{z.loading=!1,z.saleTotal=e;let t=e.payTypeUseTotalVos.map(((e,t)=>(z.saleTotal["a"+t]=e.payMoney,Object.assign({},{title:e.payTypeName,key:"a"+t})))),i=S.cloneDeep(z.deepSearchTable.tableConfig.totalThird),a=i.splice(0,8),l=i.splice(i.length-2,i.length);z.deepSearchTable.tableConfig.totalThird=[...a,...t,...l]}))}}catch(e){return z.loading=!1,e}};N((()=>{z.submitForm.beginTime=u[0],z.submitForm.endTime=x(new Date)})),D((()=>{B(),I(),O((()=>{a.value.setTime([z.submitForm.startTime,z.submitForm.endTime])}))}));const I=async()=>{z.storeList=await i.dispatch("common/mechanism"),o.value=z.storeList,v(z.storeList,z,z.deepSearchTable.form)};return n(s({},_(z)),{getSellSummaryListData:B,addBatchNumber:()=>{r.push({name:"BatchNumberAdd"})},exportExcel:async()=>{let e=z.submitForm,{businessUuid:t}=e,a=m(e,["businessUuid"]),l={};if(l=0==z.submitForm.businessUuid.length?s({businessUuid:z.storeList.map((e=>e.uuid)).join(",")},a):z.submitForm,"first"==z.activeName){let{storeUuid:e}=i.state.common.info,t=C("/gateway/chain-store/order/report/query/sell/summary/exportNew",n(s({},l),{storeUuid:e}));window.open(t,"_self")}else if("second"==z.activeName){let{storeUuid:e}=i.state.common.info,t=C("/gateway/chain-store/order/report/query/sell/export",n(s({},l),{storeUuid:e}));window.open(t,"_self")}else{let e=z.deepSearchTable.tableConfig.columnsThird.map((e=>e.title)),t=z.deepSearchTable.tableConfig.columnsThird.map((e=>e.key)),i=z.getPayType.map((e=>e.payType)),a=z.getPayType.map((e=>e.payTypeName)),o=e.splice(e.length-3,3);e=[...e,...a,...o];let r=[];z.exctlLoading=!0,(await k(l)).vos.forEach(((e,a)=>{let l=[];t.forEach(((o,r)=>{o?l.push(e[o]):l.push(a+1),t.length-4==r&&i.forEach((t=>{let i=0;e.payTypeUseTotalVos.forEach((e=>{t==e.payType&&(i=e.payMoney)})),l.push(i)}))})),r.push(l)}));let s=[e,...r],n=A.utils.aoa_to_sheet(s),m=A.utils.book_new();A.utils.book_append_sheet(m,n,"收银员日汇总"),A.writeFile(m,"收银员日汇总.xlsx"),z.exctlLoading=!1}},businessMechanismList:o,getSummaries:e=>{const{columns:t,data:i}=e,a=[];let l=z.deepSearchTable.tableConfig;return t.forEach(((e,t)=>{l[z.name][t]&&(a[t]=E("div",{className:"title_style"},[E("div",{style:"text-align: center"},[z.saleTotal[l[z.name][t].key]])]))})),a[0]=E("div",null,[E("div",{style:"text-align: center;"},[L("合计")])]),a[1]=E("div",null,[E("div",{style:"text-align: center;"},[L("(共"),z.submitForm.total,L("条)")])]),a},form:a})}};const K={class:"business-manage"},W=["href"],X=L("导出 ");var Q=u(J,[["render",function(e,t,i,a,l,o){const r=z("el-tab-pane"),s=z("el-tabs"),n=z("el-button"),m=d,u=B("loading");return I(),V("div",K,[q(E(m,{"form-data":e.deepSearchTable.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[1]||(t[1]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.salesColumns,draggable:!1,options:!0,"option-show":!1,pagination:e.submitForm,select:a.getSellSummaryListData,ref:"form",reduceNum:75,otherData:e.deepSearchTable.tableConfig.listData,formConfig:e.formConfig,getSummaries:a.getSummaries,isClear:e.isClear},{buttons:R((()=>[E(s,{modelValue:e.activeName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeName=t),onTabClick:a.getSellSummaryListData},{default:R((()=>[E(r,{label:"销售日汇总",name:"first"}),E(r,{label:"销售员日汇总",name:"second"},{default:R((()=>[G("a",{href:e.excelUrl,download:"销售员日汇总.xlsx"},null,8,W)])),_:1}),E(r,{label:"收银员日汇总",name:"third"})])),_:1},8,["modelValue","onTabClick"]),E(n,{class:"sales-summary",size:"small",type:"primary",plain:"",onClick:a.exportExcel,loading:e.exctlLoading},{default:R((()=>[X])),_:1},8,["onClick","loading"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select","otherData","formConfig","getSummaries","isClear"]),[[u,e.loading]])])}],["__scopeId","data-v-cea48948"]]);export{Q as default};
