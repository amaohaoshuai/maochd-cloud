var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,i=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&l(e,a,t[a]);if(o)for(var a of o(t))s.call(t,a)&&l(e,a,t[a]);return e},n=(e,o)=>t(e,a(o)),u=(e,t)=>{var a={};for(var l in e)r.call(e,l)&&t.indexOf(l)<0&&(a[l]=e[l]);if(null!=e&&o)for(var l of o(e))t.indexOf(l)<0&&s.call(e,l)&&(a[l]=e[l]);return a};import{_ as m}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./BaseTable.36f55649.js";import{_ as c}from"./BaseName.1aa32b4b.js";import{l as p}from"./lodash.d7ab6f48.js";import{_ as g}from"./index.ab904951.js";import{a as b}from"./axios.7b768d2b.js";import{d as f}from"./index.7c4fa9df.js";import{u as y,m as v}from"./vuex.c868d4e0.js";import{b as T}from"./element-plus.b44d97a8.js";import{g as S}from"./filter.c2c8f0b9.js";import{g as k}from"./businessRule.60794e55.js";import{g as h,h as j,j as w,e as O,i as P,D as A,t as x,q as D,B as N,o as U,a5 as C,w as $,S as _}from"./@vue.23a4bd1a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";/* empty css                                                             */import"./dayjs.bad04745.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";var R={props:{row:{type:Object,default:()=>({})},keys:{type:Array,default:()=>[]}},render({keys:e,row:t}){let[a,o]=e,r=t[a],s=t[o],l="-";return r&&s?l=`${r}${t.unit}${s}${t.splitUnit}`:r&&!s?l=`${r}${t.unit}`:!r&&s&&(l=`${s}${t.splitUnit}`),l}};var z={name:"InvoicingReport",setup(){const e=h(null),t=y();let a=S(new Date,30,!0);const o=v("common",["info"]),r=j(o.info.bind({$store:t})),s=w({business:[],baseNameList:["productName","specification","unit","manufacturer"],sumkeys:[()=>`合计(共${l.pagination.total})条`,null,["startOverallPackNumTotal","startDeleavePackNumTotal"],"startTotalPriceTotal",["overProcurementStorageTotal","deleaveProcurementStorageTotal"],["overCheckStorageTotal","deleaveCheckStorageTotal"],["overSunyiStorageTotal","deleaveSunyiStorageTotal"],["overReturnStorageTotal","deleaveReturnStorageTotal"],"procurementTotalAmountTotal","checkTotalAmountTotal","sunyiTotalAmountTotal","returnTotalAmountTotal",["overSellOutStorageTotal","deleaveSellOutStorageTotal"],["overPurchaseOutStorageTotal","deleavePurchaseOutStorageTotal"],["overRushOutStorageTotal","deleaveRushOutStorageTotal"],"sellTotalAmountTotal","purchaseOutStorageTotalAmountTotal","rushOutStorageTotalAmountTotal","costAdjustmentTotal",["endOverallPackNumTotal","endDeleavePackNumTotal"],"endTotalPriceTotal",null]}),l=w({formConfig:{"show-summary":!0,"default-sort":{prop:"code",order:"descending"}},loading:!1,formData:{inline:!0,list:[{type:"LINKAGETIME",keys:["startTime","endTime"],design:{width:"220px"},key:"registerDate",config:{"start-placeholder":"开始时间","end-placeholder":"结束时间"}},{type:"INPUT",key:"queryCondition",config:{placeholder:"商品编码/助记码/商品名称/条码"}},{type:"INPUT",key:"manufacturer",config:{placeholder:"生产厂家"}},{placeholder:"门店",type:"SELECT",config:{multiple:!0},list:()=>s.business,props:{label:"name",value:"uuid"},key:"businessUuid"}]},pagination:{"page.currentPage":1,"page.pageSize":10,businessUuid:[],orderField:"code",orderDirection:"desc",total:0,startTime:a[0],endTime:a[1]},sum:null,tableData:[],columns:[{title:"商品编码",key:"code",fixed:"left",sortable:!0},{title:"商品名称/规格/单位/生产厂家",key:"productCode",fixed:"left",width:"200px",render:e=>O(c,{row:e,list:s.baseNameList},null)},{title:"期初数量",key:"productCode",render:e=>O(R,{row:e,keys:["startOverallPackNum","startDeleavePackNum"]},null)},{title:"期初金额",key:"startTotalPrice"},{title:"入库数量",children:[{title:"采购入库",key:"overProcurementStorage",render:e=>O(R,{row:e,keys:["overProcurementStorage","deleaveProcurementStorage"]},null)},{title:"盘点",key:"overCheckStorage",render:e=>O(R,{row:e,keys:["overCheckStorage","deleaveCheckStorage"]},null)},{title:"损溢",render:e=>O(R,{row:e,keys:["overSunyiStorage","deleaveSunyiStorage"]},null)},{title:"退货冲红",render:e=>O(R,{row:e,keys:["overReturnStorage","deleaveReturnStorage"]},null)}]},{title:"入库金额",children:[{title:"采购入库",key:"procurementTotalAmount"},{title:"盘点",key:"checkTotalAmount"},{title:"损溢",key:"sunyiTotalAmount"},{title:"退货冲红",key:"returnTotalAmount"}]},{title:"出库数量",children:[{title:"销售",render:e=>O(R,{row:e,keys:["overSellOutStorage","deleaveSellOutStorage"]},null)},{title:"采购退货",render:e=>O(R,{row:e,keys:["overPurchaseOutStorage","deleavePurchaseOutStorage"]},null)},{title:"入库冲红",render:e=>O(R,{row:e,keys:["overRushOutStorage","deleaveRushOutStorage"]},null)}]},{title:"出库金额",children:[{title:"销售",key:"sellTotalAmount"},{title:"采购退货",key:"purchaseOutStorageTotalAmount"},{title:"入库冲红",key:"rushOutStorageTotalAmount"}]},{title:"成本调整金额",key:"costAdjustment"},{title:"期末数量",render:e=>O(R,{row:e,keys:["endOverallPackNum","endDeleavePackNum"]},null)},{title:"期末金额",key:"endTotalPrice"},{title:"业务机构",key:"businessName"}]});return P((()=>l.tableData),(e=>{D((()=>{document.querySelector(".el-table__fixed-footer-wrapper").querySelector("td").setAttribute("colspan",2)}))})),A((async()=>{await(async()=>{s.business=await t.dispatch("common/mechanism"),k(s.business,l,l.formData)})()})),n(i({},x(l)),{getData:async()=>{l.loading=!0;let e=l.pagination,{businessUuid:t}=e,a=u(e,["businessUuid"]),o=[];o=1===s.business.length?t:t.join(",");let r=i({businessUuid:o},a),{records:n,current:m,size:d,total:c}=await(e=>b.get("/gateway/chain-store/stockSellStorage/page",{params:e}))(r);l.sum=await(e=>b.get("/gateway/chain-store/stockSellStorage/total",{params:e}))(r),l.tableData=n,l.pagination["page.currentPage"]=m,l.pagination["page.pageSize"]=d,l.pagination.total=c,l.loading=!1},baseForm:e,getSummaries:e=>{const{columns:t,data:a}=e;let o=s.sumkeys,r=[];return l.sum&&t.forEach(((e,t)=>{switch(typeof o[t]){case"string":r[t]=l.sum[o[t]];break;case"object":if(p.exports.isArray(o[t])){let[e,a]=o[t],s=`(${l.sum[a]})`;r[t]=`${l.sum[e]}${l.sum[a]?s:""}`}else r[t]="";break;case"function":r[t]=o[t]()}})),r},handleExcel:()=>{if(l.pagination.startTime){let e=l.pagination,{businessUuid:t}=e,a=u(e,["businessUuid"]);0==l.pagination.businessUuid.length&&i({businessUuid:s.business.map((e=>e.uuid)).join(",")},a);let o=f("/gateway/chain-store/stockSellStorage/excel",n(i({},l.pagination),{storeUuid:r.value.storeUuid}));window.open(o,"_self")}else T.alert("请先选择时间","提示",{confirmButtonText:"OK"})},handleAgain:(t,o)=>{l.pagination=n(i(i({},l.pagination),t),{startTime:a[0],endTime:a[1]}),e.value.setTime(a),o()}})}};const E={class:"invoicing-report",id:"tab"},I=_(" 导出 ");var F=g(z,[["render",function(e,t,a,o,r,s){const l=m,i=N("el-button"),n=d;return U(),C("div",E,[O(l,{"form-data":e.formData,submitForm:e.pagination,"onUpdate:submitForm":t[0]||(t[0]=t=>e.pagination=t),ref:"baseForm",options:!0,select:o.getData,exclude:["linkageTime","businessUuid"],onAgain:o.handleAgain},null,8,["form-data","submitForm","select","onAgain"]),O(n,{"table-data":e.tableData,columns:e.columns,optionShow:!1,formConfig:e.formConfig,getSummaries:o.getSummaries,pagination:e.pagination,reduceNum:110,classId:"tab",select:o.getData,loading:e.loading},{buttons:$((()=>[O(i,{size:"small",onClick:o.handleExcel,type:"primary"},{default:$((()=>[I])),_:1},8,["onClick"])])),_:1},8,["table-data","columns","formConfig","getSummaries","pagination","select","loading"])])}],["__scopeId","data-v-74799816"]]);export{F as default};
