var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l,n=(e,a)=>{for(var t in a||(a={}))i.call(a,t)&&s(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&s(e,t,a[t]);return e},r=(e,l)=>a(e,t(l));import{_ as p}from"./BaseTable.36f55649.js";import{j as u,e as d,S as m,J as c,Q as g,B as b,D as f,t as y,L as h,o as v,a5 as x,a6 as w,w as C,F as j,N as k,c as F,v as U,z as D,a9 as _,aa as T,g as V,n as z,q as S}from"./@vue.23a4bd1a.js";import{_ as I}from"./index.ab904951.js";import{a as N}from"./axios.7b768d2b.js";import{_ as E}from"./element-plus.b44d97a8.js";import{g as L}from"./index.1eb722f1.js";import{u as O}from"./vuex.c868d4e0.js";import{e as P}from"./element-resize-detector.5b0b5621.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./batch-processor.94093b2a.js";var M={name:"ImportManageComponent",props:{tableData:{type:Array,default:[]},submitForm:{type:Object,default:{"page.currentPage":1,"page.pageSize":10}},height:{type:Number,default:1e3},getTableData:Function},emits:["getTableData"],setup(e,{emit:a}){const t=O(),l=u({businessUuid:"",mechanismList:[],excelFailUrl:"",dialogSuccessCount:"",dialogFailCount:"",loading:!1,loading1:!1,time:null,listData:"",tList:[],count:0,successNum:0,value:"",hasCreateSupplier:!1,name:"",file:[],type:"",frontUuid:"",pageTitle:"",fileList:[],dialogVisible:!1,options:[{value:"1",label:"商品分类"},{value:"2",label:"商品资料导入"},{value:"3",label:"期初商品资料导入"},{value:"4",label:"新增医保商品备案资料导入"},{value:"6",label:"供应商资料导入"},{value:"7",label:"会员资料导入"},{value:"8",label:"期初商品价格导入"}],columns:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"导入文件名称",key:"fileName"},{title:"导入类型",key:"type",render:e=>d("span",null,[(()=>{switch(e.type){case 1:return"商品分类导入";case 2:return"商品资料导入";case 3:return"期初商品资料导入";case 4:return"商品备案导入";case 6:return"供应商资料导入";case 7:return"会员资料导入";case 8:return"期初商品价格导入";default:return"-"}})()])},{title:"导入数量",key:"",render:e=>d("span",null,[d("span",null,[m("成功"),e.successCount?e.successCount:0,m("条")]),c(d("span",null,[m(",失败"),e.failCount,m("条")]),[[g,e.failCount]])])},{title:"导入人",key:"creator"},{title:"导入时间",key:"createTime"},{title:"操作",key:"options",width:300,render:e=>[c(d(b("el-button"),{type:"text",onClick:a=>{s(e.url)}},{default:()=>[m("下载失败数据")]}),[[g,e.url]]),c(d(b("el-button"),{type:"text",onClick:a=>{s(e.otherUrl)}},{default:()=>[m("下载对码失败数据")]}),[[g,e.otherUrl]])]}]}),i=()=>{l.dialogVisible=!1,a("getTableData")},o=async e=>{let t="";try{const e=await(i={frontUuid:l.frontUuid},N.get("/gateway/chain-store/leadExcel/find/detailByFrontUuid",{params:i}));l.listData=e,e?(clearInterval(t),t=null,l.loading=!1,l.dialogVisible=!0,l.dialogFailCount=e.failCount,l.dialogSuccessCount=e.successCount,l.excelFailUrl=e.url,l.pageTitle=e.fileName,a("getTableData")):t=setTimeout((()=>{o()}),5e3)}catch(s){return clearInterval(t),t=null,l.loading=!1,E.error("查询导入进度失败，请稍后刷新本页面查看导入列表"),s}var i},s=e=>{window.open(e,"_self")};return f((()=>{(async()=>{try{const e=await L();l.mechanismList=e}catch(e){return e}})(),0==t.state.common.info.openMultipleStores&&l.options.pop()})),r(n({},y(l)),{selectData:e=>{a("getTableData")},handlePreview:e=>{const a=e.name.split("."),t=a[a.length-1];if(!["xlsx","xls","XLSX","XLS"].some((e=>e==t)))return;l.name=e.name,l.file=e.raw,l.tList=[],(new FormData).append("file",e.raw)},creatSupplier:async()=>{var e;await N.get("/gateway/chain-store/leadExcel/create/first/supplier",{params:e})},isCreateFirst:async()=>{var e;3==l.value&&N.get("/gateway/chain-store/leadExcel/havesupplier",{params:e}).then((e=>{l.hasCreateSupplier}))},submitUpload:async()=>{let e=new FormData;for(var a,t,i="",s=0;s<5;s++)i+=Math.floor(10*Math.random());if(l.frontUuid=(new Date).getTime()+i,e.append("file",l.file),e.append("fileName",l.name),e.append("type",l.value),e.append("frontUuid",l.frontUuid),e.append("businessUuid",l.businessUuid),l.file.name){if("4"!==l.value)await(t=e,N.post("/gateway/chain-store/leadExcel/importExcel",t));else{if(!l.businessUuid)return void E.warning("请选择门店！");await(a=e,N.post("/gateway/chain-store/insurance/record/manage/upload",a))}l.loading=!0,o(),l.file=[],l.name="",l.value=""}else E.error("请选择导入文件")},detailClick:s,closeDialog:i,downloadFailImport:()=>{window.open(l.excelFailUrl,"_self"),i()}})}};const B=e=>(_("data-v-5a49dbf8"),e=e(),T(),e),H={"element-loading-text":"导入数据中","element-loading-spinner":"el-icon-loading",style:{height:"100%"}},X={style:{display:"flex"}},A={class:"importType",style:{"margin-bottom":"10px"}},G=m(" 创建初期供应商 "),q=m(" 创建初期供应商 "),J={key:0,class:"importType",style:{"margin-bottom":"10px",height:"40px"}},Q=B((()=>w("div",{style:{"margin-left":"10px","margin-right":"10px"}},"门店",-1))),K={class:"importType",style:{"margin-bottom":"10px",height:"40px","margin-left":"10px"}},R={style:{"margin-right":"10px",width:"160px"}},W=m(" 选择导入文件 "),Y=m(" 选择导入文件 "),Z=m(" 未选择导入资料类型 "),$=m(" 导入 "),ee={style:{height:"20px","font-size":"14px",display:"flex"}},ae=B((()=>w("i",{class:"el-icon-warning"},null,-1))),te={style:{"line-height":"20px","margin-left":"8px"}},le={style:{"line-height":"20px"}},ie={class:"dialog-footer"},oe=m("取 消"),se=m(" 确 定 "),ne=m(" 下载失败数据 ");const re={class:"Templates"},pe=["href","download"];const ue={class:"supplier",id:"tab"};var de=I({name:"ImportManage",components:{ImportManageComponent:I(M,[["render",function(e,a,t,l,i,o){const s=b("el-option"),n=b("el-select"),r=b("el-button"),u=b("el-input"),m=b("el-upload"),g=p,f=b("el-dialog"),y=h("loading");return c((v(),x("div",H,[w("div",X,[w("div",A,[w("div",null,[d(n,{onChange:l.isCreateFirst,modelValue:e.value,"onUpdate:modelValue":a[0]||(a[0]=a=>e.value=a),placeholder:"导入资料类型",size:"small",style:{width:"200px","margin-right":"10px"}},{default:C((()=>[(v(!0),x(j,null,k(e.options,(e=>(v(),F(s,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])]),w("div",null,["3"==e.value?(v(),F(r,{key:0,type:"primary",onClick:l.creatSupplier,size:"small"},{default:C((()=>[G])),_:1},8,["onClick"])):U("",!0),"3"!=e.value?(v(),F(r,{key:1,type:"info",plain:"",disabled:"",size:"small"},{default:C((()=>[q])),_:1})):U("",!0)])]),"4"==e.value?(v(),x("div",J,[Q,w("div",null,[d(n,{modelValue:e.businessUuid,"onUpdate:modelValue":a[1]||(a[1]=a=>e.businessUuid=a),style:{width:"160px"},placeholder:"请选择",size:"small"},{default:C((()=>[(v(!0),x(j,null,k(e.mechanismList,(e=>(v(),F(s,{label:e.name,key:e.uuid,value:e.uuid},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])])):U("",!0),w("div",K,[w("div",R,[d(u,{style:{width:"160px"},modelValue:e.name,"onUpdate:modelValue":a[2]||(a[2]=a=>e.name=a),placeholder:"导入文件名",size:"small"},null,8,["modelValue"])]),w("div",null,[d(m,{class:"upload-demo",ref:"upload",accept:"'.xls','.xlsx'",action:"/gateway/chain-store/file/upload","on-change":l.handlePreview,"file-list":e.fileList,"auto-upload":!1,"show-file-list":!1},{trigger:C((()=>["3"==e.value||e.hasCreateSupplier&&"3"==e.value?(v(),F(r,{key:0,type:"primary",size:"small"},{default:C((()=>[W])),_:1})):U("",!0),"3"!=e.value?(v(),F(r,{key:1,type:"primary",size:"small"},{default:C((()=>[Y])),_:1})):U("",!0)])),default:C((()=>[e.value?U("",!0):(v(),F(r,{key:0,class:"bugButton",type:"primary",style:{"margin-left":"10px"},plain:"",onClick:l.submitUpload,size:"small",disabled:""},{default:C((()=>[Z])),_:1},8,["onClick"])),e.value?(v(),F(r,{key:1,type:"primary",plain:"",onClick:l.submitUpload,style:{"margin-left":"10px"},size:"small"},{default:C((()=>[$])),_:1},8,["onClick"])):U("",!0)])),_:1},8,["on-change","file-list"])])])]),d(g,{"table-data":t.tableData,columns:e.columns,pagination:t.submitForm,optionShow:!1,select:l.selectData,classId:"tab",reduceNum:"95"},null,8,["table-data","columns","pagination","select"]),e.dialogVisible?(v(),F(f,{key:0,title:e.pageTitle+"数据导入",width:"420px",modelValue:e.dialogVisible,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dialogVisible=a),"before-close":l.closeDialog},{footer:C((()=>[w("span",ie,[d(r,{onClick:a[3]||(a[3]=a=>e.dialogVisible=!1)},{default:C((()=>[oe])),_:1}),e.dialogFailCount?U("",!0):(v(),F(r,{key:0,type:"primary",loading:e.loading1,onClick:l.closeDialog},{default:C((()=>[se])),_:1},8,["loading","onClick"])),e.dialogFailCount?(v(),F(r,{key:1,type:"primary",onClick:l.downloadFailImport,loading:e.loading1},{default:C((()=>[ne])),_:1},8,["onClick","loading"])):U("",!0)])])),default:C((()=>[w("div",ee,[ae,w("span",te," 导入成功"+D(e.dialogSuccessCount)+"条 ",1),w("span",le,",失败"+D(e.dialogFailCount)+"条",1)])])),_:1},8,["title","modelValue","before-close"])):U("",!0)],512)),[[y,e.loading]])}],["__scopeId","data-v-5a49dbf8"]]),TemplateManagement:I({name:"TemplateManagement",components:{BaseTable:p},props:{tableData:{type:Array,default:[{template:"商品分类模板",type:"1"},{template:"商品资料模板",type:"2"},{template:"期初商品资料模板",type:"3"},{template:"收货单模板",type:"4"},{template:"商品备案信息模板",type:"5"},{template:"供应商资料导入",type:"6"},{template:"会员资料导入",type:"7"},{template:"期初商品价格导入",type:"8"}]},submitForm:{type:Object,default:{"page.currentPage":1,"page.pageSize":10}},height:{type:Number,default:1e3}},setup(){const e=V(null),a=u({excelUrl:"",downloadName:"",columns:[{title:"模板名称",key:"template"},{title:"操作",width:200,render:e=>[d(b("el-button"),{type:"text",onClick:()=>{t(e)}},{default:()=>[m("下载")]})]}]}),t=async t=>{setTimeout((()=>{e.value.click()}),100),a.excelUrl="/gateway/chain-store/leadExcel/exportExcel/"+t.type,a.downloadName=t.template+".xlsx"};return r(n({},y(a)),{setTemplateOut:t,downloadHref:e})}},[["render",function(e,a,t,l,i,o){const s=p;return v(),x(j,null,[w("div",re,[d(s,{"table-data":t.tableData,columns:e.columns,pagination:t.submitForm,draggable:!1,optionShow:!1,classId:"tab",reduceNum:"91"},null,8,["table-data","columns","pagination"])]),c(w("a",{ref:"downloadHref",href:e.excelUrl,download:e.downloadName},null,8,pe),[[g,!1]])],64)}],["__scopeId","data-v-d6dee906"]])},setup(e,a){let t=u({height:1e3,activeName:"first",tableData:[],submitForm2:{"page.currentPage":1,"page.pageSize":10,pageSize:10}});const l=()=>{var e;(e=t.submitForm2,N.get("/gateway/chain-store/leadExcel/find/page",{params:e})).then((e=>{t.submitForm2.currentPage=e.currentPage,t.submitForm2.pageSize=e.pageSize,t.tableData=e.list,t.submitForm2.total=e.totalElements}))};f((()=>{l()}));return z((()=>{(()=>{if(document.getElementById("tab")){const e=P();setTimeout((()=>{e.listenTo(document.getElementById("tab"),(e=>{S((()=>{t.height=e.offsetHeight-237}))}))}),200)}})()})),r(n({},y(t)),{getList:l})}},[["render",function(e,a,t,l,i,o){const s=b("ImportManageComponent"),n=b("el-tab-pane"),r=b("TemplateManagement"),p=b("el-tabs");return v(),x("div",ue,[d(p,{modelValue:e.activeName,"onUpdate:modelValue":a[0]||(a[0]=a=>e.activeName=a)},{default:C((()=>[d(n,{label:"导入管理",name:"first"},{default:C((()=>[d(s,{tableData:e.tableData,submitForm:e.submitForm2,height:e.height,onGetTableData:l.getList},null,8,["tableData","submitForm","height","onGetTableData"])])),_:1}),d(n,{label:"模板管理",name:"second"},{default:C((()=>[d(r,{height:e.height},null,8,["height"])])),_:1})])),_:1},8,["modelValue"])])}],["__scopeId","data-v-289f6d24"]]);export{de as default};
