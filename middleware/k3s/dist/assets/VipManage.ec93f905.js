var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,r=(e,t)=>{for(var i in t||(t={}))o.call(t,i)&&l(e,i,t[i]);if(a)for(var i of a(t))s.call(t,i)&&l(e,i,t[i]);return e};import{_ as d}from"./BaseStencil.46c3d678.js";import{_ as m}from"./EditForm.8c35f1a6.js";import{_ as n}from"./BaseTable.36f55649.js";import{e as p,g as u,a as b,u as c,b as g}from"./index.05639c88.js";import{u as y}from"./vuex.c868d4e0.js";import{c as h}from"./common.6e2a0964.js";import{j as f,e as j,x as k,B as F,D as w,n as x,t as v,o as S,a5 as C,w as T,a6 as D,F as V,S as E}from"./@vue.23a4bd1a.js";import{_ as P}from"./index.ab904951.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";const{_:I}=h();var U={name:"VipManage",components:{BaseTable:n},setup(){let e=y(),a=f({storeList:[]}),o=f({editForm:null,isEdit:!1,loading:!1,dialogVisible:!1,pointsVisible:!1,tableData:[],pointsTableData:[],baseForm:{labelWidth:"68px",inline:!0,list:[{placeholder:"会员ID",type:"INPUT",key:"memberId"},{type:"INPUT",placeholder:"会员姓名",key:"name"},{placeholder:"手机号",type:"INPUT",key:"phone"},{placeholder:"来源机构",type:"SELECT",list:()=>a.storeList,key:"businessUuid",props:{label:"name",value:"uuid"}},{placeholder:"状态",type:"SELECT",key:"status",list:()=>[{value:1,label:"启用"},{value:2,label:"禁用"}]},{type:"LINKAGETIME",keys:["startCreateDate","endCreateDate"],design:{width:"240px"},config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"},key:"createTime"}]},pointsColumns:[{title:"条件",key:"integralTypeMsg",width:80},{title:"积分",key:"dealPoints",align:"right"},{title:"时间",key:"createTime",width:135},{title:"结存",key:"points",align:"right"},{title:"备注",key:"remark"}],columns:[{title:"序号",type:"index",width:50},{title:"会员ID",key:"memberId",width:100},{title:"会员姓名",key:"name",width:100},{title:"手机号",key:"phone",width:120},{title:"来源机构",key:"business",formConfig:{"min-width":200}},{title:"会员等级",key:"level",width:80},{title:"储值余额",key:"balance",width:100,align:"right"},{title:"累计储值",key:"accumulateStore",width:100,align:"right"},{title:"积分",key:"points",width:100,align:"right"},{title:"累计积分",key:"accumulatePoints",width:120,align:"right"},{title:"状态",key:"status",width:70,render:e=>j("div",null,[1===e.status?"启用":"禁用"])},{title:"创建时间",key:"createTime",width:120},{title:"操作",key:"options",width:160,render:e=>[{text:"编辑",props:{onClick:()=>{o.isEdit=!0,o.dialogSubmitForm=Object.assign(o.dialogSubmitForm,e),o.dialogVisible=!0}}},{text:"积分流水",props:{onClick:()=>{o.pointsVisible=!0,o.pointsSubmitForm.memberUuid=e.uuid,s()}}},{text:"启用",judgment:()=>2===e.status,props:{onClick:()=>{p(e.uuid,1).then((e=>{l()}))}}},{text:"禁用",judgment:()=>1===e.status,props:{onClick:()=>{p(e.uuid,2).then((e=>{l()}))}}}].map((e=>{if(!e.judgment||e.judgment())return j(F("el-button"),k({type:"text",class:e.className},e.props),{default:()=>[e.text]})}))}],submitForm:{orderField:"createTime",orderDirection:"desc","page.currentPage":1,"page.pageSize":10},pointsSubmitForm:{"page.currentPage":1,"page.pageSize":10,orderField:"createTime",orderDirection:"desc"},dialogForm:{labelWidth:"85px",inline:!0,list:[{label:"会员ID",type:"INPUT",key:"memberId",design:{width:"350px"},rules:[{trigger:"blur",pattern:/^([a-z]|[A-Z]|[0-9]){1,30}$/}]},{label:"会员姓名",type:"INPUT",key:"name",require:!0,design:{width:"350px"},maxlength:50},{label:"手机号",type:"INPUT",key:"phone",require:!0,design:{width:"350px"},rules:[{trigger:"blur",required:!0,message:"请输入手机号码"},{trigger:"blur",pattern:/^1[3|4|5|6|7|8|9][0-9]{9}$/,message:"请输入正确的手机号码"}]},{label:"性别",type:"SELECT",key:"sex",design:{width:"350px"},list:()=>[{value:1,label:"男"},{value:2,label:"女"}]},{label:"来源机构",type:"SELECT",key:"businessUuid",design:{width:"350px"},require:!0,list:()=>a.storeList,props:{label:"name",value:"uuid"},config:{onChange:e=>{o.dialogSubmitForm.businessUuid=e,o.dialogSubmitForm.business=I.find(a.storeList,{uuid:e}).name}}},{label:"身份证号",type:"INPUT",key:"idCard",design:{width:"350px"},rules:[{trigger:"blur",pattern:/(^\d{8}(0\d|10|11|12)([0-2]\d|30|31)\d{3}$)|(^\d{6}(18|19|20)\d{2}(0[1-9]|10|11|12)([0-2]\d|30|31)\d{3}(\d|X|x)$)/,message:"请输入正确的身份证号码"}]},{label:"会员生日",type:"DATEPICKER",key:"birthday",config:{"value-format":"YYYY-MM-DD"},design:{width:"350px"}},{label:"地址",type:"INPUT",key:"address",design:{width:"350px"},maxlength:50}]},dialogSubmitForm:{}});const s=()=>{u(o.pointsSubmitForm).then((e=>{o.pointsSubmitForm.total=e.total,o.pointsTableData=e.records}))},l=()=>{b(o.submitForm).then((e=>{o.submitForm.total=e.totalCount,o.tableData=e.list}))},d=()=>{o.dialogVisible=!1,o.isEdit=!1,o.dialogSubmitForm={}};return w((()=>{l()})),x((()=>{(async()=>{a.storeList=await e.dispatch("common/mechanism")})()})),m=r(r({},v(o)),v(a)),t(m,i({addVipDialog:()=>{o.dialogVisible=!o.dialogVisible},getVipListData:l,getList:s,beforeDialogClose:e=>{o.isEdit=!1,o.dialogSubmitForm={},o.editForm.resetFields(),o.editForm.form.resetFields(),e()},addOrUpdateVipRate:()=>{let{editForm:e}=o,t=!0;t=e.handleClick(!0),t&&(o.isEdit?c(o.dialogSubmitForm).then((e=>{d(),l()})):g(o.dialogSubmitForm).then((e=>{d(),l()})))},cancelPointRatio:d}));var m}};const L=E("新增"),_={class:"dialogFoot"},O=E("取 消"),z=E("确 定"),N=E(" //积分流水 ");var B=P(U,[["render",function(e,t,i,a,o,s){const l=F("el-button"),r=d,p=m,u=F("el-dialog"),b=n;return S(),C(V,null,[j(r,{"form-data":e.baseForm,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.columns,pagination:e.submitForm,options:!0,select:a.getVipListData},{buttons:T((()=>[j(l,{size:"small",type:"primary",onClick:a.addVipDialog},{default:T((()=>[L])),_:1},8,["onClick"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select"]),j(u,{title:e.isEdit?"编辑会员":"新增会员",modelValue:e.dialogVisible,"onUpdate:modelValue":t[3]||(t[3]=t=>e.dialogVisible=t),width:"600px","before-close":a.beforeDialogClose},{footer:T((()=>[D("div",_,[j(l,{size:"small",onClick:a.cancelPointRatio},{default:T((()=>[O])),_:1},8,["onClick"]),j(l,{size:"small",type:"primary",onClick:a.addOrUpdateVipRate},{default:T((()=>[z])),_:1},8,["onClick"])])])),default:T((()=>[j(p,{"form-data":e.dialogForm,"onUpdate:form-data":t[1]||(t[1]=t=>e.dialogForm=t),"submit-form":e.dialogSubmitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.dialogSubmitForm=t),ref:"editForm"},null,8,["form-data","submit-form"])])),_:1},8,["title","modelValue","before-close"]),N,j(u,{title:"积分流水",modelValue:e.pointsVisible,"onUpdate:modelValue":t[4]||(t[4]=t=>e.pointsVisible=t),width:"700px"},{default:T((()=>[j(b,{"table-data":e.pointsTableData,pagination:e.pointsSubmitForm,columns:e.pointsColumns,optionShow:!1,select:a.getList,style:{"margin-bottom":"16px"}},null,8,["table-data","pagination","columns","select"])])),_:1},8,["modelValue"])],64)}],["__scopeId","data-v-8239fc2c"]]);export{B as default};
