var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,r=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;import{_ as o}from"./SubmitButton.99d990fd.js";import{_ as d}from"./EditForm.8c35f1a6.js";import{_ as p}from"./BaseTable.36f55649.js";import{_ as u}from"./BaseCard.46de0c24.js";import{_ as n}from"./imageUpload.e9124177.js";import{r as m,a as b,b as c,c as f}from"./index.c5c9c03a.js";import{a as y}from"./index.778e5621.js";import{v as h}from"./public.9c1d8f39.js";import{c as v,_ as g}from"./element-plus.b44d97a8.js";import{b as k,u as D}from"./vue-router.91336ba9.js";import{u as S,m as j}from"./vuex.c868d4e0.js";import{c as I}from"./common.6e2a0964.js";import{g as A}from"./pinyin.e6905309.js";import{h as N,j as U,e as C,B as F,Y as P,G as T,S as x,g as _,n as w,D as q,t as E,q as V,L as R,o as z,a5 as Y,w as O,a6 as L,c as B,v as M,F as $,N as K,J as H,a9 as Q,aa as W}from"./@vue.23a4bd1a.js";import{_ as G}from"./trash.2476a68d.js";import{_ as J}from"./index.ab904951.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var X={name:"AddEditRequisition",components:{BaseTable:p,BaseCard:u,imageUpload:n,SubmitButton:o,EditForm:d},setup(){const{_:e}=I(),o=k();D();const d=S(),p=j("common",["dict"]),u=N(p.dict.bind({$store:d})),R={span:8,labelWidth:"120px",list:[{type:"INPUT",key:"name",label:"姓名"},{type:"INPUT",key:"idNumber",label:"身份证号码",rules:[{trigger:"blur",pattern:/(^\d{8}(0\d|10|11|12)([0-2]\d|30|31)\d{3}$)|(^\d{6}(18|19|20)\d{2}(0[1-9]|10|11|12)([0-2]\d|30|31)\d{3}(\d|X|x)$)/,message:"请输入正确法人身份证号码"}]},{type:"DATEPICKER",key:"validTime",label:"身份证有效期",config:{"value-format":"YYYY-MM-DD"}},{type:"INPUT",key:"mobile",label:"手机号码",rules:[{trigger:"blur",pattern:/^(\+86|0086)?\s*1[345789]\d{9}$/,message:"请输入正确的手机号码"}]}]},z=U({supplierTypeList:[{label:"启用",value:0},{label:"禁用",value:1}],type:"",reduceNum:180,activeName:"first",options:[],isSee:null,props:{multiple:!0},options1:[],options2:[],submitForm:{pageNumber:1,size:10,total:200},columns:[{title:"序号",type:"index",formConfig:{width:50}},{width:180,key:"name",title:"资质名称",render:(e,a,l,s)=>{if(e){if(e.name&&!e.canDelete)return C("div",null,[e.name]);{let a;return C(F("el-select"),{modelValue:e.name,"onUpdate:modelValue":a=>e.name=a,placeholder:"请选择"},"function"==typeof(t=a=z.options2.map((e=>C(F("el-option"),{key:s,label:e.key,value:e.key},null))))||"[object Object]"===Object.prototype.toString.call(t)&&!P(t)?a:{default:()=>[a]})}}return C("div",null,null);var t}},{width:100,key:"png",title:"图片",render:(e,a,l,s)=>e?T(n,{files:e.png,disabled:"see"===z.type,onHandleSuccess:e=>{M(e,s)},onHandleRemove:()=>{$(s)}}):C("div",null,null)},{width:200,key:"issuer",title:"发证机关",render:e=>e?T(v,{size:"small",maxlength:100,placeholder:"请输入",disabled:"see"===z.type,"model-value":e.issuer,onInput:a=>{e.issuer=a}}):C("div",null,null)},{width:200,key:"number",title:"编号",render:e=>e?T(v,{size:"small",maxlength:100,placeholder:"请输入",disabled:"see"===z.type,"model-value":e.number,onInput:a=>{e.number=a}}):C("div",null,null)},{width:240,key:"registerDate",title:"注册日期",render:(e,a,l,s)=>{if(e)return C(F("el-date-picker"),{modelValue:e.registerDate,"onUpdate:modelValue":a=>e.registerDate=a,size:"small",type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD",placement:"top",disabled:"see"===z.type},null);C("div",null,null)}},{width:240,key:"validity",title:"有效期至",render:(e,a,l,s)=>{if(e)return C(F("el-date-picker"),{modelValue:e.validity,"onUpdate:modelValue":a=>e.validity=a,size:"small",type:"date",placeholder:"选择日期","value-format":"YYYY-MM-DD",placement:"top",disabled:"see"===z.type},null);C("div",null,null)}},{width:80,key:"isControl",title:"控制",render:(e,a,l,s)=>{if(e)return C(F("el-switch"),{modelValue:e.isControl,"onUpdate:modelValue":a=>e.isControl=a,"active-color":"#409EFF","inactive-color":"#DCDFE6",disabled:"see"===z.type,"active-value":1,"inactive-value":0},null);C("div",null,null)}},{width:80,key:"isRemind",title:"提示",render:(e,a,l,s)=>{if(e)return C(F("el-switch"),{modelValue:e.isRemind,"onUpdate:modelValue":a=>e.isRemind=a,"active-color":"#409EFF","inactive-color":"#DCDFE6",disabled:"see"===z.type,"active-value":1,"inactive-value":0},null);C("div",null,null)}},{width:200,key:"supplierKey",title:"操作",render:(e,a,l,s)=>{if(e){if(e.canDelete)return[C(F("el-button"),{type:"text",style:"color: #f56c6c",size:"small",onClick:e=>{L(s)}},{default:()=>[x("删除")]})]}else C("div",null,null)}}],haveSupplier:!1,supplierList:[],loading:!1,baseAuditData:{isForbid:0,reason:"",supplierName:"",basicInfo:{salers:[],isFirst:0,credentials:[]}},itemRefs:[],tabClose:!1,isEdit:o.query.uuid,formData:{span:8,labelWidth:"100px",list:[{type:"INPUT",key:"supplierKey",label:"供应商编号",disabled:()=>!0,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"supplierName",label:"供应商名称",require:!0,disabled:()=>!z.haveSupplier,config:{onChange:e=>{z.baseAuditData.basicInfo.mnemonic=A(e,"",!0)}},placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"SELECT",key:"supplierType",label:"供应商类别",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示",props:{value:"key",label:"key"},list:()=>z.options},{type:"DATEPICKER",key:"registerDate",label:"注册日期",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"address",label:"地址",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"legalPerson",label:"法定代表人",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"mnemonic",label:"助记码",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"bank",label:"开户行",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"bankAccount",label:"银行账户",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"accountName",label:"开户户名",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"ceo",label:"企业负责人",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"qa",label:"质量负责人",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示"},{type:"INPUT",key:"mobile",label:"联系电话",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示",rules:[{trigger:"blur",pattern:/^([\(\)\-\+0-9]{1,20})$/,message:"请输入正确的手机号码"}]},{type:"INPUT",key:"mail",label:"邮箱",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示",rules:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}]},{type:"INPUT",key:"postalCode",label:"邮政编码",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示",rules:[{trigger:"blur",pattern:/^[0-9]{6}$/,message:"请输入正确的邮政编码"}]},{type:"SELECT",key:"businessScope",disabled:()=>!z.haveSupplier,placeholder:()=>z.haveSupplier?"请输入":"输入供应商后显示",label:"经营范围",props:{value:"key",label:"key"},config:{multiple:!0,filterable:!1,remote:!1},list:()=>z.options1}]},salersForm:[],queryUuid:""}),Y=_(null),O=()=>{z.options2=[],setTimeout((()=>{z.options2=e.find(u.value,{key:"qualificationSupplier"}).data}))},L=e=>{z.baseAuditData.basicInfo.credentials.splice(e,1)},B=e=>{z.loading=!0,z.salersForm=[],z.itemRefs=[],y(e).then((e=>{z.haveSupplier=!0,z.baseAuditData=Object.assign(z.baseAuditData,e),z.baseAuditData.basicInfo.credentials=z.baseAuditData.basicInfo.credentials||[],z.loading=!1,V((()=>{O()})),z.baseAuditData.basicInfo.salers&&z.baseAuditData.basicInfo.salers.length&&z.baseAuditData.basicInfo.salers.map((e=>{z.salersForm.push(R)}))}))},M=(e,a)=>{z.baseAuditData.basicInfo.credentials[a].png=e},$=e=>{z.baseAuditData.basicInfo.credentials[e].png=""},K=_(null);return w((()=>{z.isSee=o.query.isSee,z.reduceNum=o.query.reduceNum})),q((()=>{z.type=o.query.type,c().then((e=>{z.supplierList=e})),z.queryUuid!==o.query.uuid&&(z.options=e.find(u.value,{key:"supplier"}).data,z.options1=e.find(u.value,{key:"category1"}).data,o.query.uuid?"otherEdit"===o.query.type?(z.baseAuditData.supplierName=o.query.uuid,B(z.baseAuditData.supplierName)):(z.loading=!0,f(o.query.uuid).then((e=>{z.baseAuditData={isForbid:e.isForbid,reason:e.reason,uuid:e.uuid,supplierName:e.supplierName,basicInfo:e.basicInfo,state:3},z.haveSupplier=!0,z.salersForm=[],z.loading=!1,z.baseAuditData.basicInfo.salers&&z.baseAuditData.basicInfo.salers.length&&z.baseAuditData.basicInfo.salers.map((e=>{z.salersForm.push(R)})),z.queryUuid=o.query.uuid}))):(z.haveSupplier=!1,z.salersForm=[],z.queryUuid=void 0,z.baseAuditData={isForbid:0,reason:"",supplierName:"",basicInfo:{salers:[],isFirst:0,credentials:[]}}),V((()=>{O()}))),V((()=>{O()}))})),H=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&r(e,l,a[l]);if(s)for(var l of s(a))i.call(a,l)&&r(e,l,a[l]);return e})({},E(z)),a(H,l({chooseSupplier:B,addPerson:()=>{z.baseAuditData.basicInfo.salers.push({}),z.salersForm.push(R),z.itemRefs=[]},pushSh:async()=>{let e=!0,a=K.value.handleClick(1);e=a;let{itemRefs:l,salersForm:s}=z;l.length==s.length-1&&(l=[]),l.forEach((a=>{a.handleClick(1)||(e=!1)}));let t=await h(Y);e?e&&t&&(z.loading=!0,z.isEdit&&!o.query.type?m(1,z.baseAuditData).then((e=>{g.success("提交成功！"),z.loading=!1,z.tabClose=!0})).catch((e=>{g.error(e)})):b(1,z.baseAuditData).then((e=>{g.success("提交成功！"),z.loading=!1,z.tabClose=!0})).catch((e=>{g.error(e)}))):z.activeName="first"},topForm:Y,addQualification:()=>{z.baseAuditData.basicInfo.credentials.unshift({name:"",png:"",issuer:"",number:"",registerDate:"",validity:"",isControl:0,isRemind:0,canDelete:!0}),V((()=>{O()}))},handleChange:M,handlePictureCardRemove:$,delCredentials:L,delPerson:e=>{z.baseAuditData.basicInfo.salers.splice(e,1),z.salersForm.splice(e,1),z.itemRefs=[]},setItemRef:e=>{let{itemRefs:a}=z;e&&a.push(e)},editForm:K}));var H}};const Z=e=>(Q("data-v-007b34a4"),e=e(),W(),e),ee={class:"supplier"},ae=Z((()=>L("span",{style:{"font-size":"16px"}},null,-1))),le=x(" 提交审核 "),se={class:"box"},te={class:"person"},ie=Z((()=>L("p",null,"销售人员信息",-1))),re=x(" 新增 "),oe=["onClick"],de=x(" 新增 ");var pe=J(X,[["render",function(e,a,l,s,t,i){const r=o,n=F("el-input"),m=F("el-form-item"),b=F("el-option"),c=F("el-select"),f=F("el-form"),y=d,h=F("el-button"),v=F("el-tab-pane"),g=p,k=F("el-scrollbar"),D=F("el-tabs"),S=u,j=R("loading");return z(),Y("div",ee,[C(S,{close:e.tabClose,route:{path:"/business-manage/editRequisition"},isEdit:e.isSee,id:"tab"},{header:O((()=>[ae,L("div",null,["see"!=e.type?(z(),B(r,{key:0,class:"btn",onClick:s.pushSh,config:{size:"small"}},{default:O((()=>[le])),_:1},8,["onClick"])):M("",!0)])])),default:O((()=>[C(k,null,{default:O((()=>[L("div",se,[C(f,{ref:"topForm",model:e.baseAuditData,"label-width":"100px",disabled:"see"==e.type},{default:O((()=>[C(m,{label:"申请理由",prop:"reason",size:"small",rules:[{required:!0,message:"请输入申请理由",trigger:"blur"}]},{default:O((()=>[C(n,{modelValue:e.baseAuditData.reason,"onUpdate:modelValue":a[0]||(a[0]=a=>e.baseAuditData.reason=a),type:"textarea",rows:2,style:{width:"420px","margin-left":"12px"},maxlength:"200","show-word-limit":"",placeholder:"请输入申请理由，不超过200字"},null,8,["modelValue"])])),_:1}),C(m,{label:"供应商名称",prop:"supplierName",size:"small",rules:[{required:!0,message:"请输入供应商名称",trigger:"blur"}]},{default:O((()=>[C(c,{filterable:"",placeholder:"请输入，可模糊搜索",style:{width:"224px","margin-left":"12px"},onChange:s.chooseSupplier,modelValue:e.baseAuditData.supplierName,"onUpdate:modelValue":a[1]||(a[1]=a=>e.baseAuditData.supplierName=a)},{default:O((()=>[(z(!0),Y($,null,K(e.supplierList,(e=>(z(),B(b,{key:e.uuid,label:e.supplierName,value:e.uuid},null,8,["label","value"])))),128))])),_:1},8,["onChange","modelValue"])])),_:1}),C(m,{size:"small",label:"供应商状态",prop:"supplierName"},{default:O((()=>[C(c,{style:{"margin-left":"12px"},modelValue:e.baseAuditData.isForbid,"onUpdate:modelValue":a[2]||(a[2]=a=>e.baseAuditData.isForbid=a)},{default:O((()=>[(z(!0),Y($,null,K(e.supplierTypeList,(e=>(z(),B(b,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","disabled"]),H(C(D,{modelValue:e.activeName,"onUpdate:modelValue":a[5]||(a[5]=a=>e.activeName=a),"element-loading-text":"加载中..."},{default:O((()=>[C(v,{label:"基础信息",name:"first"},{default:O((()=>[C(y,{disabled:"see"==e.type,"form-data":e.formData,"onUpdate:form-data":a[3]||(a[3]=a=>e.formData=a),"submit-form":e.baseAuditData.basicInfo,"onUpdate:submit-form":a[4]||(a[4]=a=>e.baseAuditData.basicInfo=a),ref:"editForm"},null,8,["disabled","form-data","submit-form"]),L("div",te,[ie,"see"!=e.type?(z(),B(h,{key:0,type:"primary",disabled:!e.haveSupplier,onClick:s.addPerson,size:"small"},{default:O((()=>[re])),_:1},8,["disabled","onClick"])):M("",!0),(z(!0),Y($,null,K(e.salersForm,((a,l)=>(z(),Y("div",{class:"person-box",key:l},[C(y,{disabled:"see"==e.type,"form-data":e.salersForm[l],"onUpdate:form-data":a=>e.salersForm[l]=a,"submit-form":e.baseAuditData.basicInfo.salers[l],"onUpdate:submit-form":a=>e.baseAuditData.basicInfo.salers[l]=a,ref:s.setItemRef},null,8,["disabled","form-data","onUpdate:form-data","submit-form","onUpdate:submit-form"]),e.salersForm.length>1?(z(),Y("img",{key:0,class:"person-trash",src:G,alt:"",onClick:e=>s.delPerson(l)},null,8,oe)):M("",!0)])))),128))])])),_:1}),C(v,{label:"资质信息",name:"second"},{default:O((()=>["see"!=e.type?(z(),B(h,{key:0,type:"primary",style:{"margin-bottom":"20px"},disabled:!e.haveSupplier,onClick:s.addQualification,size:"small"},{default:O((()=>[de])),_:1},8,["disabled","onClick"])):M("",!0),C(k,{class:"scollbar"},{default:O((()=>[C(g,{optionShow:!1,"fixed-head":!1,class:"select-table","class-id":"tab","table-data":e.baseAuditData.basicInfo.credentials,columns:e.columns,ref:"baseTable"},null,8,["table-data","columns"])])),_:1})])),_:1})])),_:1},8,["modelValue"]),[[j,e.loading]])])])),_:1})])),_:1},8,["close","isEdit"])])}],["__scopeId","data-v-007b34a4"]]);export{pe as default};
