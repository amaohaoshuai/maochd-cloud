var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,r=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&l(e,a,t[a]);if(i)for(var a of i(t))o.call(t,a)&&l(e,a,t[a]);return e},d=(e,i)=>t(e,a(i));import{_ as m}from"./BaseForm.bc55ad6b.js";import"./lodash.d7ab6f48.js";import{s as n,a as c,g as b,b as p,c as u}from"./data.706dd79a.js";import{_ as y}from"./index.ab904951.js";import{s as f,g as h}from"./businessRule.60794e55.js";import{u as g}from"./vuex.c868d4e0.js";import{j as v,m as w,D as C,n as j,t as k,B as x,o as F,a5 as L,a6 as M,e as S,w as O,F as E,N as D,a8 as P,z,S as B,v as I,ab as A,q as U,a9 as N,aa as Y}from"./@vue.23a4bd1a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./dayjs.bad04745.js";import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./vue-router.91336ba9.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";const V={name:"RetailStatistics",setup(){const e=g();let t=v({findList:[]}),a=v({title:"",isClear:!1,t:[{value:0,name:"会员"},{value:0,name:"客流"}],countMsg:{},activeName:"1",radio1:"销售额",radio2:"会员占比",data:{},datax:{},tData:[],myChart:"",myChart2:"",myChart3:"",formData:[],dtList:[{type:"SELECT",placeholder:"请选择",label:"门店",key:"mechanismUuid",props:{label:"name",value:"uuid"},config:{multiple:!0},list:()=>t.findList}],submitForm:{mechanismUuid:[]},show:!1}),i=w("ec");const s=()=>{let e=i.init(document.getElementById("myChart"));e.setOption({tooltip:{trigger:"axis",axisPointer:{lineStyle:{color:"#1890FF"}}},xAxis:{boundaryGap:!1,data:a.datax[a.radio1],axisLine:{lineStyle:{color:"#606266"}},silent:!0},yAxis:{lineStyle:{type:"dashed"}},grid:{left:"5%",right:"5%",containLabel:!0},series:[{type:"line",smooth:.6,symbol:"circle",symbolSize:8,data:a.data[a.radio1],lineStyle:{color:"#1890FF",width:4},itemStyle:{borderWidth:2,borderColor:"#fff",color:"#1890FF",shadowColor:"rgba(0, 43, 83, 0.2)",shadowBlur:8,shadowOffsetY:4},areaStyle:{opacity:.8,color:new i.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(24,144,255,0.10)"},{offset:1,color:"rgba(24,144,255,0.00)"}])},blur:{labelLine:{show:!0,lineStyle:{color:"#000"}}}}]}),a.myChart=e},o=()=>{let e=i.init(document.getElementById("myChart2"));e.setOption({legend:{bottom:20,data:l(a.countMsg.customerPie),selectedMode:!1},tooltip:{trigger:"item",formatter:"{b}: {c}%"},color:["#74A0FA","#73DEB3"],series:[{type:"pie",top:"-15%",radius:["40%","60%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},itemStyle:{borderColor:"#fff",borderWidth:3},data:a.data[a.radio2]}]}),a.myChart2=e},l=e=>{let t=[];return e.forEach((e=>{t.push(d(r({},e),{icon:"circle"}))})),t},m=v({list:[{title:"应收金额",key:"shouldMoney",bef:"￥"},{title:"实收金额",key:"payAmount",bef:"￥"},{title:"优惠金额",key:"discountAmount",bef:"￥"},{title:"成本金额",key:"costAmount",bef:"￥"},{title:"毛利",key:"grossProfit",bef:"￥"},{title:"毛利率",key:"grossMargin",aft:"%"},{title:"充值金额",key:"rechargeAmount",bef:"￥"},{title:"客流量/客单价",key:"customerFlow",key1:"customerPrice",aft:"人",bef1:"￥"}],formData:{inline:!0,labelWidth:"82px",config:{size:"medium"}},dateList:{1:[{type:"DATEPICKER",placeholder:"供应商编号/供应商名称/助记码",label:"日期",key:"1",config:{clearable:!1}}],2:[{type:"TIME",placeholder:"供应商编号/供应商名称/助记码",label:"日期",config:{type:"week",format:"gggg 第 ww 周",placeholder:"选择周",clearable:!1},key:"2"}],3:[{type:"TIME",placeholder:"供应商编号/供应商名称/助记码",label:"日期",config:{type:"month",placeholder:"选择月","value-format":"YYYY-MM",clearable:!1},key:"3"}],4:[{type:"TIME",placeholder:"供应商编号/供应商名称/助记码",label:"日期",config:{type:"year",placeholder:"选择年","value-format":"YYYY",clearable:!1},key:"4"}]}}),y=async()=>{a.title=["","近七日","近七周销","近七月","当年月份"][a.activeName];let e={type:a.activeName,startDate:a.submitForm[a.activeName],mechanismUuid:f(a.submitForm.mechanismUuid)},t=await n(e);a.countMsg=t,a.data["会员占比"]=t.customerPie,a.data["会员销售占比"]=t.customerSellPie;let i=await c(e);a.data["销售额"]=i.yaxisSales,a.data["销售数量"]=i.yaxisOrderCount,a.data["客流"]=i.yaxisUsers,a.datax["销售额"]=i.xaxisSales,a.datax["销售数量"]=i.xaxisOrderCount,a.datax["客流"]=i.xaxisUsers,F()},x=()=>{let e=new Date;a.submitForm[1]=b(e),a.submitForm[2]=p(e),a.submitForm[3]=u(e),a.submitForm[4]=e.getFullYear().toString(),a.submitForm.mechanismUuid=void 0},F=()=>{s(),o(),(()=>{let e=i.init(document.getElementById("myChart3"));e.setOption({legend:{bottom:10,data:l(a.countMsg.payInfoPie),selectedMode:!1},color:["#EB7F65","#73DEB3","#90D5FB","#F7C739","#74A0FA","#FFAC68","#B193E4"],tooltip:{trigger:"item",formatter:"{b}: {d}%(￥{c})"},series:[{type:"pie",radius:["40%","60%"],top:"-15%",avoidLabelOverlap:!1,label:{show:!1,position:"outer",margin:"25%",formatter:"{b}: {d}%"},itemStyle:{borderColor:"#fff",borderWidth:3},labelLine:{show:!1},data:a.countMsg.payInfoPie}]}),a.myChart3=e})(),U((()=>{window.onresize=()=>{a.myChart.resize(),a.myChart2.resize(),a.myChart3.resize()}}))};return C((()=>{a.show=!1,e.dispatch("common/mechanism").then((e=>{t.findList=e,h(t.findList,a,a.dtList)})).then((()=>{U((async()=>{a.show=!0,await y()}))}))})),j((()=>{x()})),d(r(r(r({},k(a)),k(m)),k(t)),{drawLine:s,handleClick:({props:e},t)=>{},getBatchNumberListData:y,setInitial:x,drawing:F,drawLine2:o,setData:l})}},T={class:"retail-sta",id:"retail-sta"},_={class:"top"},W={class:"top-div"},R={class:"con-auto"},G={class:"con"},q={class:"list"},H=["src"],K={class:"tips"},J={class:"name"},Q={key:0,style:{"font-size":"20px"}},X={key:0},Z={class:"btn"},$={class:"btn-d1"},ee={class:"header"},te={key:0,id:"myChart",style:{width:"100%",height:"90%"}},ae={class:"btn-d2"},ie={class:"header"},se={class:"btn-d2"},oe=(e=>(N("data-v-4f1f3574"),e=e(),Y(),e))((()=>M("div",{class:"header2"},[M("div",null,"支付方式占比")],-1)));var le=y(V,[["render",function(e,t,a,i,s,o){const l=x("el-tab-pane"),n=x("el-tabs"),c=m,b=x("el-radio-button"),p=x("el-radio-group");return F(),L("div",T,[M("div",_,[S(n,{modelValue:e.activeName,"onUpdate:modelValue":t[0]||(t[0]=t=>e.activeName=t),onTabClick:i.handleClick},{default:O((()=>[S(l,{label:"日",name:"1"}),S(l,{label:"周",name:"2"}),S(l,{label:"月",name:"3"}),S(l,{label:"年",name:"4"})])),_:1},8,["modelValue","onTabClick"]),M("div",W,[S(c,{"form-data":d(r({},e.formData),{list:[...e.dateList[e.activeName],...e.dtList]}),options:!0,"submit-form":e.submitForm,"onUpdate:submit-form":t[1]||(t[1]=t=>e.submitForm=t),select:i.getBatchNumberListData,reset:i.setInitial,isClear:e.isClear,ref:"selectForm"},null,8,["form-data","submit-form","select","reset","isClear"])])]),M("div",R,[M("div",G,[M("div",q,[(F(!0),L(E,null,D(e.list,((t,a)=>(F(),L("div",{key:a,class:P({"bon-b":a<4,"bon-r":(a+1)%4!=0})},[M("img",{src:"./static/images/home/s"+(a+1)+".png"},null,8,H),M("div",K,[M("div",J,z(t.title),1),e.countMsg[t.key]||!e.countMsg[t.key]&&0===e.countMsg[t.key]?(F(),L("div",Q,[B(z(t.bef)+z(e.countMsg[t.key])+z(t.aft),1),t.key1?(F(),L("span",X,"/"+z(t.bef1)+z(e.countMsg[t.key1])+z(t.aft1),1)):I("",!0)])):I("",!0)])],2)))),128))])]),M("div",Z,[M("div",$,[M("div",ee,[S(p,{modelValue:e.radio1,"onUpdate:modelValue":t[2]||(t[2]=t=>e.radio1=t),onChange:t[3]||(t[3]=e=>i.drawLine()),size:"mini"},{default:O((()=>[S(b,{label:"销售额"}),S(b,{label:"销售数量"}),S(b,{label:"客流"})])),_:1},8,["modelValue"]),B(" "+z(e.title)+z(e.radio1),1)]),e.show?(F(),L("div",te)):I("",!0)]),M("div",ae,[M("div",ie,[S(p,{modelValue:e.radio2,"onUpdate:modelValue":t[4]||(t[4]=t=>e.radio2=t),onChange:t[5]||(t[5]=e=>i.drawLine2()),size:"mini"},{default:O((()=>[S(b,{label:"会员占比"}),S(b,{label:"会员销售占比"})])),_:1},8,["modelValue"])]),e.show?(F(),L("div",{key:0,id:"myChart2",style:A({width:"100%",height:"calc(100% - 40px)"})},null,4)):I("",!0)]),M("div",se,[oe,e.show?(F(),L("div",{key:0,id:"myChart3",style:A({width:"100%",height:"calc(100% - 40px)"})},null,4)):I("",!0)])])])])}],["__scopeId","data-v-4f1f3574"]]);export{le as default};
