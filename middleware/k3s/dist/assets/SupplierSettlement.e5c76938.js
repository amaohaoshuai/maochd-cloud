var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i;import{_ as l}from"./BaseStencil.46c3d678.js";import{s as m,_ as n}from"./index.ab904951.js";import"./element-plus.b44d97a8.js";import{_ as p}from"./BaseName.1aa32b4b.js";import{G as u,g as d,j as b,i as c,D as f,t as g,L as h,o as y,a5 as j,J as v,e as S,w as T,a6 as w,z as F}from"./@vue.23a4bd1a.js";import{a as k}from"./axios.7b768d2b.js";import{d as D}from"./index.6efc7880.js";import{u as U,b as x}from"./vue-router.91336ba9.js";import{g as N,f as O}from"./filter.c2c8f0b9.js";import{s as P,g as I}from"./businessRule.60794e55.js";import"./lodash.d7ab6f48.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./vuex.c868d4e0.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./dayjs.bad04745.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";/* empty css                                                             */const E={0:"未结算",1:"结算中",2:"结算完成"},B=["name","specification","unit","manufacturer"];function z(e,t,a,i,s){return{formData:{inline:!0,labelWidth:"100px",list:[{placeholder:"业务编号",type:"INPUT",key:"orderNo"},{type:"LINKAGETIME",design:{width:"240px"},keys:["startTime","endTime"],key:"createTime",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{placeholder:"供应商名称",type:"SELECT",key:"supplierUuid",props:{label:"supplierName",value:"uuid"},list:()=>i.value},{placeholder:"商品名称",type:"INPUT",key:"name"},{placeholder:"结算状态",type:"SELECT",key:"settleState",config:{multiple:!0},list:()=>[{label:"未结算",value:0},{label:"结算中",value:1},{label:"结算完成",value:2}]},{placeholder:"门店",type:"SELECT",key:"businessUuid",props:{label:"name",value:"uuid"},config:{multiple:!0},list:()=>a.value}]},tableConfig:{columns:[{type:"index",title:"序号",width:42,fixed:"left"},{title:"业务单编号",key:"orderNo",width:135,fixed:"left"},{title:"商品编码",key:"code",width:100,fixed:"left"},{title:"门店",key:"business",width:120},{title:"商品名称/规格/单位/生产厂家",key:"name",width:256,fixed:"left",formConfig:{"show-overflow-tooltip":!1},render:e=>u(p,{row:e,list:B})},{title:"供应商名称",key:"supplierName",width:176},{title:"数量",key:"num",width:120,align:"right"},{title:"含税进价",key:"taxPaid",width:120,align:"right"},{title:"应结算金额",key:"shouldBeSettled",width:120,align:"right"},{title:"已结算金额",key:"hasBeenSettled",width:120,align:"right"},{title:"未结算金额",key:"noSettled",width:120,align:"right"},{title:"结算状态",key:"settleState",width:120,render:(e,t,a,i)=>u("div",E[e.settleState])},{title:"制单时间",key:"planDate",width:180},{title:"采购员",key:"purchaseUser"},{title:"门店",key:"business"}]}}}const C={class:"business-manage"},_={class:"span"},L={style:{margin:"20px"}};var q=n({name:"SupplierSettlement",components:{BaseStencil:l},setup(e,l){const n=new Date;let p=N(n,30,!0);const u=d(null),{keepAlive:h}=m.state.common,y=d([]),j=d([]),v=d([]),S=d(0);U();const T=x(),w=b({tableInfo:{},otherData:{},tableData:[],loading:!1,deepSearchTable:z(0,0,y,v,S.value),submitForm:{"page.currentPage":1,"page.pageSize":10,startTime:p[0],endTime:O(new Date)}}),F=async()=>{w.loading=!0;try{let t=[];for(var e=0;e<w.submitForm.settleState.length;e++)t.push(w.submitForm.settleState[e]);let a=w.submitForm,{businessUuid:o}=a;((e,t)=>{var a={};for(var o in e)s.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&i)for(var o of i(e))t.indexOf(o)<0&&r.call(e,o)&&(a[o]=e[o])})(a,["businessUuid"]);o=P(o);let l={"page.currentPage":w.submitForm["page.currentPage"],"page.pageSize":w.submitForm["page.pageSize"],settleState:t.join(),orderNo:w.submitForm.orderNo,startTime:w.submitForm.startTime,endTime:w.submitForm.endTime,supplierUuid:w.submitForm.supplierUuid,name:w.submitForm.name,businessUuid:o};const m=await function(e){return k.get("/gateway/chain-store/supplierSettleDetail/queryPage",{params:e})}(l);w.submitForm.pageNumber=m.pageData.currentPage,m.pageData.list.map((e=>{e.name=e.productName})),w.tableInfo=m,w.tableData=m.pageData.list,w.submitForm.total=m.pageData.totalElements,w.loading=!1}catch(t){return w.loading=!1,t}},E=async()=>{const e=await m.dispatch("common/mechanism");y.value=e};c(h,((e,t)=>{if(e){e.includes("SupplierSettlement")||m.commit("common/SUPPLIERCOUNTINFO",[])}})),f((()=>{S.value=T.query.islook,B();const{supplierCountInfo:e}=m.state.common;w.submitForm.startTime=e.startTime,w.submitForm.endTime=e.endTime,w.submitForm.supplierUuid=e.supplierOtherUuid?e.supplierOtherUuid:e.supplierUuid,w.submitForm.businessUuid=e.businessUuid,e.startTime||(w.submitForm.startTime=p[0],w.submitForm.endTime=p[1]),u.value.setTime([w.submitForm.startTime,w.submitForm.endTime]),F(),E(),(async()=>{const e=await D();v.value=e})()}));const B=async()=>{let{storeUuid:e}=m.state.common.info;w.submitForm.storeUuid=e,j.value=await m.dispatch("common/mechanism"),I(j.value,w,w.deepSearchTable.formData)};return C=((e,t)=>{for(var a in t||(t={}))s.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))r.call(t,a)&&o(e,a,t[a]);return e})({},g(w)),t(C,a({supplierSettleDetailData:F,businessMechanismListData:E,form:u}));var C}},[["render",function(e,t,a,i,s,r){const o=l,m=h("loading");return y(),j("div",C,[v(S(o,{"form-data":e.deepSearchTable.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.deepSearchTable.tableConfig.columns,pagination:e.submitForm,draggable:!1,options:!0,"option-show":!1,select:i.supplierSettleDetailData,ref:"form"},{buttons:T((()=>[w("div",_,[w("span",null," 应结算金额合计："+F(e.tableInfo.shouldBeSettled)+"元 ",1),w("span",L," 未结算金额合计："+F(e.tableInfo.noSettled)+"元 ",1),w("span",null,"本次结算金额合计："+F(e.tableInfo.hasBeenSettled)+"元",1)])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select"]),[[m,e.loading]])])}],["__scopeId","data-v-42039c35"]]);export{q as default};
