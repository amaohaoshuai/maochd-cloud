var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,d=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&o(e,a,t[a]);return e},n=(e,i)=>t(e,a(i));import{_ as c}from"./BaseForm.bc55ad6b.js";import{_ as u}from"./BaseTable.36f55649.js";import{_ as r}from"./BaseCard.46de0c24.js";import{_ as m}from"./BaseName.1aa32b4b.js";import{u as p}from"./vuex.c868d4e0.js";import{b,_ as h}from"./element-plus.b44d97a8.js";import{f as g,h as f,d as y,i as D}from"./index.e7529637.js";import{s as v,_ as L}from"./index.ab904951.js";import{_ as k}from"./lodash.d7ab6f48.js";import{j as x,e as C,S as w,B as U,D as j,t as S,o as z,a5 as F,w as V,a6 as _,c as B,v as T,F as I,N as A,z as N,a9 as E,aa as O}from"./@vue.23a4bd1a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./public.9c1d8f39.js";/* empty css                                                             */import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";const{dict:P}=v.state.common;var G={name:"AddInventoryWarning",setup(){let e=p();const t=x({pot:0,tableData:[],findList:[],getDictList:[]});let a=x({storeList:[],selectArr:[]}),i=x({pagination:{page:1,size:10,total:100},cacheData:[],options:[],value:"",loading:!1,tabClose:!1,query:"***",sellDays:"",numLimit:"",daysLimit:"",isDisabled1:!0,isDisabled2:!0,checked1:!1,checked2:!1,tableUuid:[],multipleSelectionList1:[],multipleSelectionList2:[],baseNameList:["name","specification","unit","manufacturer"],dialogVisible:!1,editLowerLimit:!1,editBtn:"编辑",isClear:!1,chooseListId:[],tableData:[],tableData2:[],columns:[{type:"selection",title:"序号"},{title:"序号",type:"index",fixed:"left",width:52},{title:"门店",fixed:"left",width:120,render:e=>C("div",null,[i.tableUuid[0].mechanismName])},{title:"商品编码",fixed:"left",key:"code",width:150},{title:"商品名称/规格/单位/生产厂家",fixed:"left",render:e=>C(m,{row:e,list:i.baseNameList},null)},{title:"库存数量",fixed:"left",width:150,render:e=>C("div",null,[e.concatStockNum])},{title:"库存周转",fixed:"left",key:"daysLimit",width:150},{title:"预警下限",fixed:"left",key:"numLimit",width:150},{title:"操作",key:"options",width:120,render:(e,t,a,i)=>C(U("el-button"),{type:"text",class:"delete",onClick:()=>{s(e,i)}},{default:()=>[w("删除")]})}],columns2:[{type:"selection",title:"序号",fixed:"left",width:50,formConfig:{selectable:e=>{let a=t.tableData;return k.findIndex(a,{productUuid:e.productUuid})<0}}},{title:"序号",type:"index",fixed:"left",width:52},{title:"商品编码",key:"code",fixed:"left"},{title:"商品名称",key:"name",fixed:"left"},{title:"商品类别",key:"category1",fixed:"left"},{title:"剂型",fixed:"left",key:"dosageForm"},{title:"规格",fixed:"left",key:"specification"},{title:"单位",fixed:"left",key:"unit"},{title:"库存数量",key:"overallPackNum",fixed:"left"},{title:"生产厂家",fixed:"left",key:"manufacturer"}],formData:{labelWidth:"70px",span:8,inline:!0,list:[{type:"SELECT",placeholder:"门店",list:()=>a.storeList,key:"businessUuid",props:{label:"name",value:"uuid"},config:{onChange:e=>{i.submitForm.businessUuid=e,i.submitForm2.businessUuid=e,i.tableData.length>0&&b.confirm("切换当前门店会清空数据!","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{i.tableData=[],i.multipleSelectionList2=[]})).catch((()=>{}))}}}]},formData2:{labelWidth:"70px",span:8,inline:!0,list:[{label:"商品类别",type:"SELECT",placeholder:"商品类别",list:()=>l(),key:"category1",props:{label:"label",value:"value"}},{label:"商品名称",type:"INPUT",placeholder:"名称/编号/助记码",key:"keyword"}]},submitForm:{businessUuid:[]},submitForm2:{"page.currentPage":1,"page.pageSize":10,businessUuid:[]},cacheAll:[]});const l=()=>{if(P.length>0){return P.filter(((e,t)=>"category1"===e.key))[0].data.map((e=>({value:e.key,label:e.key})))}},s=(e,a)=>{b.confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{i.tableData.splice(a,1),t.tableData.splice(a,1),i.cacheData.splice(a,1)}))};return j((async()=>{a.storeList=await e.dispatch("common/mechanism")})),n(d(d({},S(a)),S(i)),{batchDelete:()=>{0==i.multipleSelectionList2.length&&h.warning({message:"还未选择商品！",type:"warning"}),i.multipleSelectionList2.map(((e,a)=>{i.tableData.map(((a,l)=>{a.productUuid==e.productUuid&&(i.tableData.splice(l,1),t.tableData.splice(l,1),i.cacheData.splice(l,1))}))}))},BatchAddGoods:()=>{if(!i.submitForm.businessUuid)return i.dialogVisible=!1,void h.warning("添加商品前请选择门店!");i.dialogVisible=!0,i.submitForm,g(i.submitForm2).then((e=>{i.tableData2=e.records,i.submitForm2.total=e.total})),t.getDictList=l()},submitGoods:async()=>{if(!i.checked1&&!i.checked2)return void h.warning("请至少设置一种库存预警方式!");if(i.checked2&&!i.daysLimit||i.checked2&&!i.sellDays)return void h.warning("请完整设置库存周转预警!");if(!i.tableData.length)return void h.warning("请至少添加一种预警商品!");let e=/^([1-9][0-9]{0,3})$/;if(i.checked1&&!e.test(i.numLimit))return void h.warning("库存数量预警只能输入四位的正整数!");if(i.checked2&&!e.test(i.daysLimit)||i.checked2&&!e.test(i.sellDays))return void h.warning("库存周转天数预警只能输入四位的正整数!");let t=[],a={};i.tableData.map((e=>{a={businessUuid:e.businessUuid,daysLimit:e.daysLimit,numLimit:e.numLimit,sellDays:e.sellDays,productUuid:e.productUuid},t.push(a)})),await f(t);let l={stockWarns:i.tableData};i.loading=!0,await y(l),i.tabClose=!0},singleSelection:(e,t)=>{i.chooseListId.includes(t.productUuid)?i.chooseListId.forEach(((e,a)=>{e===t.productUuid&&(i.chooseListId.splice(a,1),i.chooseList.splice(a,1))})):(i.chooseListId.push(t.productUuid),i.chooseList.push(t))},allSelection:e=>{e.length>0?e.forEach((e=>{i.chooseListId.includes(e.productUuid)||(i.chooseListId.push(e.productUuid),i.chooseList.push(e))})):i.tableData.forEach((e=>{i.chooseListId.forEach(((t,a)=>{t===e.productUuid&&(i.chooseListId.splice(a,1),i.chooseList.splice(a,1))}))}))},delTable:s,WarehousingGoodsData:()=>{g()},multipleSelectionDrugs:e=>{i.cacheAll[i.submitForm2["page.currentPage"]-1]=e,i.cacheData=[].concat.apply([],i.cacheAll),i.cacheData=[...i.cacheData,...e],i.cacheData=k.uniqBy(i.cacheData,"productUuid"),i.multipleSelectionList1=i.cacheData},multipleSelectionTable:e=>{i.multipleSelectionList2=e},handleClose:e=>{e()},handleSubmit:async()=>{let e=i.multipleSelectionList1,l={};e.map((e=>{l=d({daysLimit:i.daysLimit,numLimit:i.numLimit,sellDays:i.sellDays,businessUuid:i.submitForm.businessUuid},e),i.tableData.push(l)})),i.tableData=k.uniqBy(i.tableData,"productUuid"),i.tableUuid=a.storeList.filter((e=>e.uuid===i.submitForm.businessUuid)),t.tableData=k.cloneDeep(i.tableData),i.dialogVisible=!1},checkedChange:()=>{i.checked1?i.isDisabled1=!1:(i.isDisabled1=!0,i.numLimit="",i.tableData.map((e=>{delete e.numLimit}))),i.checked2?i.isDisabled2=!1:(i.isDisabled2=!0,i.daysLimit="",i.sellDays="",i.tableData.map((e=>{delete e.daysLimit,delete e.sellDays})))},inputChange:e=>{"numLimit"===e?i.tableData.map((e=>{e.numLimit=i.numLimit})):"daysLimit"===e?i.tableData.map((e=>{e.daysLimit=i.daysLimit})):i.tableData.map((e=>{e.sellDays=i.sellDays}))},getAddGoods:()=>{i.multipleSelectionList2=[],g(i.submitForm2).then((e=>{i.tableData2=e.records,i.submitForm2.total=e.total}))},getDictList:l,handlcurrentChange:e=>{i.pagination.page=e},handlSizeChange:e=>{i.pagination.size=e},drugChange:()=>{i.tableUuid=a.storeList.filter((e=>e.uuid===i.submitForm.businessUuid));let e=k.findIndex(i.options,{productUuid:i.value});t.tableData.unshift(n(d({},i.options[e]),{businessUuid:i.submitForm.businessUuid,numLimit:i.numLimit,daysLimit:i.daysLimit,sellDays:i.sellDays})),i.value="",i.options=[],t.pot=t.tableData.length-1,i.tableData=t.tableData},drugBlur:()=>{i.value="",i.options=[]},remoteMethod:async e=>{if(0!=i.submitForm.businessUuid.length){if(""!==e){let t={keywords:e,businessUuid:i.submitForm.businessUuid};i.options=await D(t)}}else b.confirm("请选择门店后,再进行操作","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then((()=>{i.isFlag=!0})).catch((()=>{i.isFlag=!0}))},getStr:e=>e||!e&0===e?e:"-",isDisabled:e=>k.findIndex(t.tableData,{productUuid:e})>-1,handleSubmitClose:()=>{i.dialogVisible=!1,0===i.cacheData.length&&(i.multipleSelectionList1=[])}})}};const W=e=>(E("data-v-6aedcf38"),e=e(),O(),e),q={class:"stencil",id:"tab"},M=W((()=>_("span",{style:{"font-size":"16px"}},"新增商品库存预警",-1))),H={class:"top"},K={class:"box"},$={class:"stockChang"},J={style:{flex:"1"}},Q={class:"stockChangTitle"},R=w("库存数量预警"),X=w(" 商品整装库存数量小于"),Y=w("时，系统预警提示。 "),Z={style:{flex:"1"}},ee=w("库存周转天数预警"),te=w(" 周转天数小于"),ae=w("天，系统预警提示。当前周转天数=当前库存/近"),ie=w("天日均销量。 "),le={class:"content"},se={class:"getInfo"},oe=w(" 批量添加商品 "),de=w(" 批量删除 "),ne=w(" 完成 "),ce={class:"add-msg"},ue=W((()=>_("i",{class:"el-icon-plus"},null,-1))),re=W((()=>_("div",{class:"space-list"},[_("div",{class:"space",style:{width:"80px"}},"编号"),_("div",{class:"space",style:{width:"150px"}},"商品名称"),_("div",{class:"space",style:{width:"150px"}},"规格"),_("div",{class:"space",style:{width:"50px"}},"单位"),_("div",{class:"space",style:{width:"110px"}},"剂型")],-1))),me={class:"space-list"},pe={style:{width:"80px"}},be={class:"space",style:{width:"150px"}},he={class:"space",style:{width:"150px"}},ge={class:"space",style:{width:"50px"}},fe={class:"space",style:{width:"110px"}},ye={class:"block"},De={class:"dialog-footer"},ve={class:"selectedItem"},Le=w(" 已选择"),ke=w("种商品 "),xe=w("取 消"),Ce=w(" 确 定 ");var we=L(G,[["render",function(e,t,a,i,l,s){const o=c,d=U("el-checkbox"),n=U("el-input"),m=U("el-button"),p=u,b=U("el-scrollbar"),h=U("el-option"),g=U("el-select"),f=U("el-pagination"),y=U("el-dialog"),D=r;return z(),F("div",q,[C(D,{close:e.tabClose,route:{path:"/storage/inventory-warning"}},{header:V((()=>[M])),default:V((()=>[C(b,null,{default:V((()=>[_("div",H,[_("div",K,[C(o,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),options:!1,isClear:e.isClear},null,8,["form-data","submit-form","isClear"])]),_("div",$,[_("div",J,[_("div",Q,[C(d,{modelValue:e.checked1,"onUpdate:modelValue":t[1]||(t[1]=t=>e.checked1=t),onChange:i.checkedChange,label:"1",size:"large"},{default:V((()=>[R])),_:1},8,["modelValue","onChange"])]),_("div",null,[X,C(n,{size:"small",style:{width:"100px"},modelValue:e.numLimit,"onUpdate:modelValue":t[2]||(t[2]=t=>e.numLimit=t),disabled:e.isDisabled1,onBlur:t[3]||(t[3]=e=>i.inputChange("numLimit"))},null,8,["modelValue","disabled"]),Y])]),_("div",Z,[_("div",null,[C(d,{class:"stockChangTitle",modelValue:e.checked2,"onUpdate:modelValue":t[4]||(t[4]=t=>e.checked2=t),label:"2",onChange:i.checkedChange,size:"large"},{default:V((()=>[ee])),_:1},8,["modelValue","onChange"])]),_("div",null,[te,C(n,{size:"small",style:{width:"100px"},modelValue:e.daysLimit,"onUpdate:modelValue":t[5]||(t[5]=t=>e.daysLimit=t),disabled:e.isDisabled2,onBlur:t[6]||(t[6]=e=>i.inputChange("daysLimit"))},null,8,["modelValue","disabled"]),ae,C(n,{size:"small",style:{width:"100px"},modelValue:e.sellDays,"onUpdate:modelValue":t[7]||(t[7]=t=>e.sellDays=t),disabled:e.isDisabled2,onBlur:t[8]||(t[8]=e=>i.inputChange("sellDays"))},null,8,["modelValue","disabled"]),ie])])])]),_("div",le,[C(p,{class:"select-table",columns:e.columns,"table-data":e.tableData.slice((e.pagination.page-1)*e.pagination.size,(e.pagination.page-1)*e.pagination.size+e.pagination.size),"fixed-head":!1,delTable:i.delTable,pagination:e.submitForm,ref:"baseTable",classId:"tab",multipleSelection:i.multipleSelectionTable,reduceNum:295},{buttons:V((()=>[_("div",se,[C(m,{type:"primary",size:"small",onClick:i.BatchAddGoods},{default:V((()=>[oe])),_:1},8,["onClick"]),C(m,{type:"danger",size:"small",onClick:i.batchDelete},{default:V((()=>[de])),_:1},8,["onClick"]),C(m,{type:"primary",size:"small",onClick:i.submitGoods,loading:e.loading,plain:""},{default:V((()=>[ne])),_:1},8,["onClick","loading"])])])),_:1},8,["columns","table-data","delTable","pagination","multipleSelection"])])])),_:1}),_("div",ce,[ue,C(g,{class:"select-input",modelValue:e.value,"onUpdate:modelValue":t[9]||(t[9]=t=>e.value=t),filterable:"",remote:"",size:"small",style:{width:"350px"},"reserve-keyword":"",onChange:i.drugChange,placeholder:"请输入商品编码/助记码/商品名称/条码","remote-method":i.remoteMethod,loading:e.loading,onClick:i.drugBlur},{default:V((()=>[e.options.length?(z(),B(h,{key:0,disabled:"",value:"-999",label:"-999"},{default:V((()=>[re])),_:1})):T("",!0),(z(!0),F(I,null,A(e.options,(e=>(z(),B(h,{key:e.productUuid,label:i.getStr(e.name),disabled:i.isDisabled(e.productUuid),value:e.productUuid},{default:V((()=>[_("div",me,[_("div",pe,N(i.getStr(e.code)),1),_("div",be,N(i.getStr(e.name)),1),_("div",he,N(i.getStr(e.specification)),1),_("div",ge,N(i.getStr(e.unit)),1),_("div",fe,N(i.getStr(e.dosageForm)),1)])])),_:2},1032,["label","disabled","value"])))),128))])),_:1},8,["modelValue","onChange","remote-method","loading","onClick"])]),_("div",ye,[C(f,{"current-page":e.pagination.page,"page-sizes":[10,20,50,100],"page-size":e.pagination.size,layout:"total, sizes, prev, pager, next, jumper",total:e.tableData.length,onCurrentChange:i.handlcurrentChange,onSizeChange:i.handlSizeChange},null,8,["current-page","page-size","total","onCurrentChange","onSizeChange"])]),e.dialogVisible?(z(),B(y,{key:0,title:"请选择商品",modelValue:e.dialogVisible,"onUpdate:modelValue":t[12]||(t[12]=t=>e.dialogVisible=t),width:"1200px","before-close":i.handleClose},{footer:V((()=>[_("span",De,[_("div",ve,[Le,_("span",null,N(e.multipleSelectionList1.length),1),ke]),C(m,{size:"small",onClick:i.handleSubmitClose},{default:V((()=>[xe])),_:1},8,["onClick"]),C(m,{size:"small",type:"primary",onClick:i.handleSubmit},{default:V((()=>[Ce])),_:1},8,["onClick"])])])),default:V((()=>[C(o,{"form-data":e.formData2,"onUpdate:form-data":t[10]||(t[10]=t=>e.formData2=t),"submit-form":e.submitForm2,"onUpdate:submit-form":t[11]||(t[11]=t=>e.submitForm2=t),options:!0,select:i.getAddGoods},null,8,["form-data","submit-form","select"]),C(p,{"table-data":e.tableData2,pagination:e.submitForm2,columns:e.columns2,select:i.BatchAddGoods,"single-select":i.multipleSelectionDrugs,"all-select":i.multipleSelectionDrugs,cache:e.cacheData,cacheKey:"productUuid","option-show":!1},null,8,["table-data","pagination","columns","select","single-select","all-select","cache"])])),_:1},8,["modelValue","before-close"])):T("",!0)])),_:1},8,["close"])])}],["__scopeId","data-v-6aedcf38"]]);export{we as default};
