var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,s=(e,t)=>{for(var i in t||(t={}))a.call(t,i)&&o(e,i,t[i]);if(r)for(var i of r(t))l.call(t,i)&&o(e,i,t[i]);return e},n=(e,r)=>t(e,i(r)),p=(e,t)=>{var i={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&r)for(var o of r(e))t.indexOf(o)<0&&l.call(e,o)&&(i[o]=e[o]);return i};import{_ as d}from"./BaseStencil.46c3d678.js";import{d as u}from"./element-plus.b44d97a8.js";import{r as m,_ as c}from"./index.ab904951.js";import{c as f,d as h,g as y,a as g}from"./index.74922d77.js";import{d as b}from"./public.9c1d8f39.js";import{_ as k}from"./BaseName.1aa32b4b.js";import{G as w,j as v,D as C,t as j,B as T,o as x,a5 as N,e as U,w as L,J as S,Q as P,S as E}from"./@vue.23a4bd1a.js";import{j as O}from"./index.1eb722f1.js";import{u as M}from"./vue-router.91336ba9.js";import{g as _,f as D}from"./filter.c2c8f0b9.js";import{s as I,g as F}from"./businessRule.60794e55.js";import{u as H}from"./vuex.c868d4e0.js";import{d as z}from"./index.7c4fa9df.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";/* empty css                                                             */const A=["productName","specification","unit","manufacturer"];const B={name:"PurchaseOrder",setup(e,t){const i=M(),r=H(),a=new Date,l=_(a,30,!0),o=v({supList:[]}),d=v({findOgList:[]}),c=v(s({storeList:[],pageType:1,tloading:!1,isClear:!1,submitForm:{"page.currentPage":1,"page.pageSize":10,startTime:l[0],endTime:D(new Date),businessUuids:[]},tableData:[]},function(e,t,i){const r=[{type:"index",title:"序号",formConfig:{width:50}},{title:"采购单编号",key:"orderNo",formConfig:{"min-width":135},render:e=>w(u,{type:"text",innerHTML:e.orderNo,onClick:()=>{l(e.uuid)}})},{title:"计划单编号",key:"planNo",formConfig:{"min-width":135},render:e=>w(u,{type:"text",innerHTML:e.planNo,onClick:()=>{o(e.planUuid)}})},{title:"商品种类数量",key:"category1",formConfig:{"min-width":135},align:"right"},{title:"供应商名称",key:"supplierName",formConfig:{"min-width":176}},{title:"含税金额",key:"totalAmountTax",width:130,align:"right"},{title:"金额",key:"totalAmount",width:130,align:"right"},{title:"门店",key:"business",formConfig:{"min-width":176}},{title:"订单状态",key:"completeStatus",width:120,render:e=>w("span",{innerText:["未完成","已完成"][e.completeStatus]})},{title:"审核状态",key:"auditStatus",width:78,render:e=>w("span",{innerText:["待提交","待审核","审核通过","审核拒绝","订单完成"][e.auditStatus]})},{title:"采购人员",key:"createUser",formConfig:{"min-width":78}},{title:"制单日期",key:"planDate",formConfig:{"min-width":110}},{title:"备注",key:"remark",width:256,formConfig:{"show-overflow-tooltip":!0}},{title:"操作",key:"options",width:120,render:({uuid:e,planStatus:i,completeStatus:r,auditStatus:a})=>w("div",[{type:"text",show:0===a,innerHTML:"查看",onClick:()=>{l(e)}},{type:"text",innerHTML:"编辑",show:0!==a&&3!==a,onClick:()=>{m.push({path:"/purchase/purchase-order-add",query:{uuid:e,type:"edit"}})}},{type:"text",innerHTML:"订单完成",show:!(2===a&&0===r),onClick:()=>{f(e).then((e=>{t()}))}},{type:"text",innerHTML:"删除",show:0!==a,onClick:()=>{b({msg:"确认删除吗？",fun:h,uuid:e,callback:t})},style:{color:"#f56c6c"}}].map((e=>{if(!e.show)return w(u,e)})))}],a=[{type:"index",title:"序号",formConfig:{width:50}},{title:"采购单编号",key:"orderNo",formConfig:{"min-width":135},render:e=>w(u,{type:"text",innerHTML:e.orderNo,onClick:()=>{l(e.orderUuid)}})},{title:"计划单编号",key:"planNo",formConfig:{"min-width":135},render:e=>w(u,{type:"text",innerHTML:e.planNo,onClick:()=>{o(e.planUuid)}})},{title:"门店",key:"business",formConfig:{"min-width":176}},{title:"商品编号",key:"code",formConfig:{"min-width":135}},{title:"商品名称/规格/单位/生产厂家",key:"",formConfig:{"min-width":200},render:e=>w(k,{row:e,list:A})},{title:"库存数量",key:"",formConfig:{"min-width":135},render:e=>(0==e.overallPackNum?"0"+e.unit:e.overallPackNum?e.overallPackNum+e.unit:"")+(e.deleavePackNum?e.deleavePackNum+e.splitUnit:"")||"-"},{title:"月销量",formConfig:{"min-width":135},render:e=>(0==e.overallMonthSales?"0"+e.unit:e.overallMonthSales?e.overallMonthSales+e.unit:"")+(e.deleaveMonthSales?e.deleaveMonthSales+e.splitUnit:"")||"-"},{title:"周销量",key:"",formConfig:{"min-width":135},render:e=>(0==e.overallWeekSales?"0"+e.unit:e.overallWeekSales?e.overallWeekSales+e.unit:"")+(e.deleaveWeekSales?e.deleaveWeekSales+e.splitUnit:"")||"-"},{title:"采购数量",key:"purchaseNum",formConfig:{"min-width":135},align:"right"},{title:"含税进价",key:"taxPaid",formConfig:{"min-width":135},align:"right"},{title:"含税金额",key:"taxAmount",width:130,align:"right"},{title:"进价",key:"price",width:130,align:"right"},{title:"金额",key:"amount",width:130,align:"right"},{title:"差额",key:"diffAmount",width:80,align:"right"},{title:"进项税率",key:"inputTaxRate",width:130,align:"right"},{title:"税额",key:"tax",width:130,align:"right"},{title:"零售价",key:"retailPrice",width:130,align:"right"},{title:"零售金额",key:"retailAmount",width:130,align:"right"},{title:"供应商名称",key:"supplierName",formConfig:{"min-width":176}},{title:"批准文号",key:"approvalNumber",formConfig:{"min-width":176}},{title:"上市许可持有人",key:"holderPermit",formConfig:{"min-width":176}},{title:"制单日期",key:"planDate",formConfig:{"min-width":110}}],l=e=>{m.push({path:"/purchase/purchase-order-add",query:{uuid:e,type:"see",returnPath:"/purchase/purchase-order"}})},o=e=>{m.push({path:"/purchase/pocurement-plan-add",query:{uuid:e,type:"see",returnPath:"/purchase/purchase-order"}})};return{form:{inline:!0,labelWidth:"100px",list:[]},columns:[],columns1:r,columns2:a,form2:{list:[{type:"LINKAGETIME",design:{width:"240px"},keys:["startTime","endTime"],key:"createTime",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{type:"SELECT",placeholder:"门店",key:"businessUuids",config:{multiple:!1},props:{label:"name",value:"uuid"},list:()=>i()},{placeholder:"供应商名称",key:"supplierUuid",type:"SELECT",props:{label:"supplierName",value:"supplierUuid"},list:()=>e()},{placeholder:"订单状态",key:"completeStatus",type:"SELECT",hidden:!0,props:{label:"label",value:"value"},config:{filterable:!1},list:()=>[{label:"未完成",value:"0"},{label:"已完成",value:"1"}]},{placeholder:"计划单编号",type:"INPUT",key:"planNo"},{placeholder:"采购单编号",type:"INPUT",key:"orderNo"},{placeholder:"商品信息",type:"INPUT",key:"invincible"}]},form1:{list:[{type:"LINKAGETIME",design:{width:"240px"},keys:["startTime","endTime"],key:"createTime",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{type:"SELECT",placeholder:"门店",key:"businessUuids",config:{multiple:!1},props:{label:"name",value:"uuid"},list:()=>i()},{placeholder:"订单状态",key:"completeStatus",type:"SELECT",props:{label:"label",value:"value"},config:{filterable:!1},list:()=>[{label:"未完成",value:"0"},{label:"已完成",value:"1"}]},{placeholder:"计划单编号",type:"INPUT",key:"planNo"},{placeholder:"供应商名称",key:"supplierUuid",type:"SELECT",props:{label:"supplierName",value:"supplierUuid"},list:()=>e()},{placeholder:"采购单编号",type:"INPUT",key:"orderNo"},{placeholder:"商品信息",type:"INPUT",key:"invincible",hidden:!0}]}}}((()=>o.supList),(()=>T()),(()=>d.findOgList)))),T=()=>{c.tloading=!0;let e=c.submitForm,{businessUuids:t}=e,i=p(e,["businessUuids"]);t=I(t);let r=s({businessUuids:t},i);1==c.pageType?(c.columns=c.columns1,c.form.list=c.form1.list,y(r).then((e=>{c.tableData=e.list,c.submitForm.total=e.totalCount,c.tloading=!1}))):(c.columns=c.columns2,c.form.list=c.form2.list,g(r).then((e=>{c.tableData=e.list,c.submitForm.total=e.totalCount,c.tloading=!1})))};C((async()=>{O().then((e=>{o.supList=e})),c.storeList=await r.dispatch("common/mechanism"),d.findOgList=c.storeList,T(),F(c.storeList,c,c.form)}));return n(s(s(s({handleClick:({item:e,type:t})=>{if("dblclick"===t){let t=1==c.pageType?e.uuid:e.orderUuid,r=0==e.auditStatus?{uuid:t}:{uuid:t,type:"see"};i.push({path:"/purchase/purchase-order-add",query:r,returnPath:"/purchase/purchase-order"})}}},j(c)),j(o)),j(d)),{getList:T,typeChange:async e=>{c.pageType=e,F(c.storeList,c,1==e?c.form1:c.form2),T()},exportExcel:()=>{let{storeUuid:e}=r.state.common.info,t=c.submitForm,{businessUuids:i}=t,a=p(t,["businessUuids"]),l={};l=0==c.submitForm.businessUuids.length?s({businessUuids:c.storeList.map((e=>e.uuid)).join(",")},a):c.submitForm;let o=z("/gateway/chain-store/purchaseOrder/orderExport",n(s({},l),{storeUuid:e}));window.open(o,"_self")}})}},W={class:"supplier"},q=E(" 导出 "),G=E("汇总"),V=E("明细");var K=c(B,[["render",function(e,t,i,r,a,l){const o=T("el-button"),s=T("el-radio-button"),n=T("el-radio-group"),p=d;return x(),N("div",W,[U(p,{add:{path:"/purchase/purchase-order-add"},"form-data":e.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.submitForm=t),options:!0,columns:e.columns,select:r.getList,tableData:e.tableData,loading:e.tloading,"option-show":!1,onOnClick:r.handleClick,isClear:e.isClear},{buttons:L((()=>[S(U(o,{style:{position:"absolute",right:"66px"},size:"small",plain:"",type:"primary",onClick:r.exportExcel},{default:L((()=>[q])),_:1},8,["onClick"]),[[P,1!=e.pageType]]),U(n,{modelValue:e.pageType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.pageType=t),size:"small",style:{float:"left","margin-right":"10px","margin-bottom":"10px"},onChange:t[1]||(t[1]=t=>r.typeChange(e.pageType))},{default:L((()=>[U(s,{label:"1"},{default:L((()=>[G])),_:1}),U(s,{label:"2"},{default:L((()=>[V])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["form-data","submit-form","columns","select","tableData","loading","onOnClick","isClear"])])}],["__scopeId","data-v-4b4f73f5"]]);export{K as default};
