var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,d=(e,t)=>{for(var a in t||(t={}))r.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))l.call(t,a)&&o(e,a,t[a]);return e},s=(e,i)=>t(e,a(i));import{_ as n}from"./EditForm.8c35f1a6.js";import{_ as m}from"./BaseTable.36f55649.js";import{_ as p}from"./BaseCard.46de0c24.js";import{_ as u}from"./BaseName.1aa32b4b.js";import{b as c}from"./vue-router.91336ba9.js";import{f as y,a as f,c as b,e as h}from"./index.2b658791.js";import{u as v}from"./vuex.c868d4e0.js";import{_ as k}from"./index.ab904951.js";import{_ as g}from"./lodash.d7ab6f48.js";import"./element-plus.b44d97a8.js";import{j as x,e as j,S as w,h as N,D,t as I,B as F,o as C,c as P,w as V,a6 as T,a5 as U,v as _,z as A,a9 as O,aa as B}from"./@vue.23a4bd1a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./public.9c1d8f39.js";/* empty css                                                             */import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./dayjs.bad04745.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";var z={name:"PurchaseDispatchDetail",setup(){let e=c(),t=v(),{dict:a}=t.state.common,i=x({people:[],supplier:[],mechanism:[],selectArr:[],keys:["code","name","dosageForm","specification","manufacturer"],transportationMode:a.find((e=>"transportationMode"===e.key)).data,transportMeans:a.find((e=>"transportMeans"===e.key)).data,temperControlEquip:a.find((e=>"temperControlEquip"===e.key)).data,refuseReason:a.find((e=>"refuseReason"===e.key)).data}),r=x({index:0,editForm:null,editForm1:null,baseTable:null,keyBoard:null,visibility:!1,close:!1,go:{path:"/purchase/purchase-dispatch"},config:{size:"medium"},formData:{labelWidth:"90px",fixedText:":",span:8,list:[{label:"运输方式",type:"DIV",key:"transportMode"},{label:"运输工具",key:"transportMeans",type:"DIV"},{label:"温控设备",type:"DIV",key:"temperControlEquip"},{label:"启运温度",type:"DIV",key:"temperShip",render:()=>`${r.info.temperShip} ℃`},{label:"到达温度",type:"DIV",key:"arriveTemper",render:()=>`${r.info.arriveTemper} ℃`},{label:"启运时间",type:"DIV",key:"shipTime"},{label:"到达时间",key:"arriveTime",type:"DIV"}]},formInfo:{labelWidth:"90px",span:8,list:[{label:"收货单编号:",type:"DIV",key:"receiveNo"},{label:"创建人:",type:"DIV",key:"user"},{label:"采购单编号:",type:"DIV",key:"orderNo"},{label:"采购员:",type:"DIV",key:"createUser"},{label:"供应商名称:",type:"DIV",key:"supplierName"},{label:"门店:",type:"DIV",key:"business"},{label:"开票日期:",type:"DIV",key:"invoiceTime"},{label:"随货同行单:",type:"DIV",key:"peer"}]},info:{user:t.state.common.info.userName},columns:[{title:"序号",type:"index",formConfig:{width:50},fixed:"left"},{title:"商品编码",key:"code",width:150,fixed:"left"},{title:"商品名称",width:180,render:e=>j(u,{row:e},null),fixed:"left"},{title:"订单数量(剩余未收)",width:230,render:e=>`${e.purchaseNum}(${e.outStandNum})`},{title:"批号",key:"batchNumber",width:220,render:e=>e.batchNumber||"-"},{title:"生产日期",key:"productionDate",width:220,render:e=>e.productionDate||"-"},{title:"有效期至",key:"expireDate",width:220,render:e=>e.expireDate||"-"},{title:"本次收货数量",key:"receiveNum",align:"right",width:220,render:e=>j("div",{style:""},[e.receiveNum])},{title:"含税进价",require:!0,key:"taxPaid",align:"right",width:150,render:e=>j("div",{style:""},[e.taxPaid])},{title:"进价",align:"right",key:"price",width:150,render:e=>j("div",{style:""},[e.price])},{title:"含税金额",key:"taxAmount",align:"right",width:150,render:e=>j("div",{style:""},[e.taxAmount])},{title:"金额",key:"amount",align:"right",width:150,render:e=>j("div",{style:""},[e.amount])},{title:"税额",key:"tax",width:150,align:"right",render:e=>j("div",{style:""},[e.tax])},{title:"零售价",key:"retailPrice",align:"right",width:150,render:e=>j("div",{style:""},[e.retailPrice])},{title:"零售金额",key:"retailAmount",width:150,align:"right",render:e=>j("div",{style:""},[e.retailAmount])},{title:"进项税率(%)",key:"inputTaxRate",align:"right",width:150,render:e=>j("div",{style:""},[e.inputTaxRate])},{title:"批准文号",key:"approvalNumber",width:150,render:e=>j("div",null,[e.approvalNumber||"-"])},{title:"上市许可持有人",key:"holderPermit",width:150,render:e=>j("div",null,[e.holderPermit||"-"])},{title:"拒收数量",key:"returnNum",width:150,align:"right",render:e=>j("div",null,[e.returnNum||"-"])},{title:"拒收原因",key:"refuseReason",width:150,render:e=>j("div",null,[e.refuseReason||"-"])},{title:"中药饮片产地",key:"medicineBeverage",width:150,render:e=>j("div",null,[e.medicineBeverage||"-"])}],data:[],dialog:{columns:[{title:"序号",type:"index",formConfig:{width:50}},{title:"采购单编号",key:"orderNo"},{title:"计划单编号",key:"planNo"},{title:"采购员",key:"createUser"},{title:"供应商名称",key:"supplierName"},{title:"商品种类",key:"category1"},{title:"含税金额合计",key:"totalAmountTax"}],columns1:[{type:"selection",width:55},{title:"序号",type:"index",formConfig:{width:50}},{title:"商品编码",key:"code"},{title:"商品名称",key:"name",width:180},{title:"商品类别",key:"category1"},{title:"剂型",key:"dosageForm"},{title:"规格",key:"specification"},{title:"单位",key:"unit"},{title:"订单数量(剩余未收)",width:150,render:e=>j("div",null,[e.purchaseNum||e.purchaseNum.toFixed(6),w("("),e.outStandNum||e.outStandNum.toFixed(6),w(")")])},{title:"生产厂家",key:"manufacturer"},{title:"产地",key:"origin"},{title:"批准文号",key:"approvalNumber"},{title:"上市许可持有人",key:"holderPermit",width:150}],items:[],data:[],data1:[],info:{},info1:{"page.pageSize":5,"page.currentPage":1},formData:{inline:!0,labelWidth:"90px",list:[{label:"供应商名称",type:"div",key:"supplierName"},{label:"采购单编号",key:"orderNo",type:"INPUT"}]}}});const l=N((()=>!!r.data.find((e=>e.coldChain)))),o=N((()=>{let e={code:g.uniqBy(r.data,"code").length,receiveNum:0,taxAmount:0,amount:0,tax:0};return r.data.forEach((t=>{let{receiveNum:a,taxAmount:i,amount:r,tax:l}=t;e.receiveNum+=parseFloat(a||0,10),e.taxAmount+=parseFloat(i||0,10),e.amount+=parseFloat(r||0,10),e.tax+=parseFloat(l||0,10)})),e})),n=async()=>{let e=await b(r.dialog.info1),{list:t,totalCount:a}=e||{list:[],totalCount:0};r.dialog.info1.total=a,r.dialog.data1=t},m=async e=>{let{info:t,details:a}=await h(e);r.info=t,r.data=a};return D((()=>{let{query:t}=e;m(t.uuid)})),s(d(d({},I(r)),I(i)),{getDetail:m,handleInput:async e=>{let{selectParams:t}=r;t.fuzzyValue=e,i.selectArr=await y(t)},handleChange:e=>{g.find(r.data,{code:e.code})&&(e.receiveNum=void 0),r.data.push(g.cloneDeep(e)),r.pot=r.data.length-1},coldChain:l,handleGetOrder:async()=>{r.dialog.data=await f(r.dialog.info),r.visibility||(r.index=0,r.visibility=!0)},handleTableClick:async({item:e,type:t})=>{r.itemCache=s(d({},e),{orderUuid:e.uuid}),"dblclick"===t&&(r.selectParams.orderUuid=r.itemCache.orderUuid,r.dialog.info1=s(d({},r.dialog.info1),{orderUuid:e.uuid}),await n(),r.index=1)},multipleSelection:e=>{r.dialog.items=[...r.dialog.items,...e],r.dialog.items=g.uniqBy(r.dialog.items,"uuid")},getOrder:n,totalNum:o})}};const S=e=>(O("data-v-817d2e8e"),e=e(),B(),e),q=S((()=>T("div",{class:"title"},"查看采购收货",-1))),E={class:"top-content"},M=S((()=>T("div",{class:"tit",style:{"margin-bottom":"12px"}},"单据信息",-1))),R={key:0,class:"line"},W={class:"main"},$=S((()=>T("div",{class:"tit"},"商品信息",-1))),G={class:"getInfo"},H={class:"text",style:{flex:"1"}};var J=k(z,[["render",function(e,t,a,i,r,l){const o=n,d=m,s=F("el-scrollbar"),u=p;return C(),P(u,{class:"detail-view",close:e.close,route:e.go,backTips:!1},{header:V((()=>[q])),top:V((()=>[T("div",E,[M,j(o,{"form-data":e.formInfo,"onUpdate:form-data":t[0]||(t[0]=t=>e.formInfo=t),"submit-form":e.info,"onUpdate:submit-form":t[1]||(t[1]=t=>e.info=t),ref:"editForm"},null,8,["form-data","submit-form"]),i.coldChain?(C(),U("div",R)):_("",!0),i.coldChain?(C(),P(o,{key:1,"form-data":e.formData,"onUpdate:form-data":t[2]||(t[2]=t=>e.formData=t),"submit-form":e.info,"onUpdate:submit-form":t[3]||(t[3]=t=>e.info=t),ref:"editForm1"},null,8,["form-data","submit-form"])):_("",!0),j(o,{"form-data":{span:24,labelWidth:"90px",list:[{label:"备注:",type:"DIV",key:"remark"}]},"submit-form":e.info,"onUpdate:submit-form":t[4]||(t[4]=t=>e.info=t)},null,8,["submit-form"])])])),default:V((()=>[j(s,null,{default:V((()=>[T("div",W,[$,j(d,{class:"select-table",columns:e.columns,"table-data":e.data,"fixed-head":!1,ref:"baseTable","option-show":!1},{buttons:V((()=>[T("div",G,[T("div",H,[T("span",null,"商品种类合计："+A(i.totalNum.code.toFixed(0)),1),T("span",null,"收货数量合计："+A(i.totalNum.receiveNum.toFixed(6)),1),T("span",null,"含税金额合计："+A(i.totalNum.taxAmount.toFixed(2))+"元",1),T("span",null,"金额合计："+A(i.totalNum.amount.toFixed(2))+"元",1),T("span",null,"税额合计："+A(i.totalNum.tax.toFixed(2))+"元",1)])])])),_:1},8,["columns","table-data"])])])),_:1})])),_:1},8,["close","route"])}],["__scopeId","data-v-817d2e8e"]]);export{J as default};
