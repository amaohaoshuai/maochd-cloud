var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,o=(e,t)=>{for(var i in t||(t={}))r.call(t,i)&&l(e,i,t[i]);if(a)for(var i of a(t))s.call(t,i)&&l(e,i,t[i]);return e},d=(e,t)=>{var i={};for(var l in e)r.call(e,l)&&t.indexOf(l)<0&&(i[l]=e[l]);if(null!=e&&a)for(var l of a(e))t.indexOf(l)<0&&s.call(e,l)&&(i[l]=e[l]);return i};import{_ as u}from"./BaseStencil.46c3d678.js";import{s as n}from"./index.1eb722f1.js";import{d as p,g as c}from"./index.2b658791.js";import{d as h}from"./public.9c1d8f39.js";import{u as m}from"./vue-router.91336ba9.js";import{d as y}from"./element-plus.b44d97a8.js";import{g as b,f as g}from"./filter.c2c8f0b9.js";import{g as f,a as k,b as w}from"./index.6037074b.js";import{_ as v}from"./BaseName.1aa32b4b.js";import{s as x,g as N}from"./businessRule.60794e55.js";import{u as j}from"./vuex.c868d4e0.js";import{g as T,j as C,G as D,e as U,x as q,B as O,D as L,n as P,q as F,t as A,o as E,c as _,w as S,a6 as z,z as B}from"./@vue.23a4bd1a.js";import{_ as H}from"./index.ab904951.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";/* empty css                                                             */import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";const I={style:{clear:"both","text-align":"left","margin-left":"120px",height:"32px","line-height":"32px"}},M={class:"money"};var R=H({name:"PurchaseDispatch",setup(){const e=m(),a=j(),r=T([]),s=T("汇总");let l=C({supplier:[]});const u=new Date;let E=b(u,30,!0),_=C({isClear:!1,baseNameList:["name","specification","unit","manufacturer"],findOgList:[],tloading:!1,receiveTotal:{},receiveDetailTotal:{},form:{labelWidth:"0px",inline:!0,list:[{type:"LINKAGETIME",design:{width:"240px"},keys:["beginTime","endTime"],key:"time",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{type:"SELECT",key:"supplierName",props:{label:"supplierName",value:"supplierName"},list:()=>l.supplier,placeholder:"供应商名称"},{label:"",type:"SELECT",placeholder:"门店",config:{multiple:!0},key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>r.value},{type:"INPUT",key:"receiveNo",placeholder:"收货单编号"},{type:"INPUT",key:"orderNo",placeholder:"采购单编号"},{type:"INPUT",key:"productName",placeholder:"商品信息",hidden:!0}]},columns:[{title:"序号",type:"index",fixed:"left",width:50},{title:"收货单编号",key:"receiveNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.receiveNo,onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}})},{title:"随货同行单",key:"peer",width:80},{title:"开票日期",key:"invoiceTime",width:110},{title:"供应商名称",key:"supplierName",formConfig:{"min-width":200}},{title:"商品种类",key:"category1",width:80},{title:"收货数量",width:85,align:"right",key:"receiveNum"},{title:"含税金额",key:"totalAmountTax",width:118,align:"right"},{title:"金额",key:"totalAmount",width:118,align:"right"},{title:"税额",key:"tax",width:118,align:"right"},{title:"创建人",key:"user",width:105},{title:"制单时间",key:"createTime",width:110},{title:"门店",key:"business",formConfig:{"min-width":150}},{title:"采购单编号",key:"orderNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.orderNo,onClick:()=>{e.push({path:"/purchase/purchase-order-detail",query:{uuid:t.purchaseUuid}})}})},{title:"操作",key:"options",width:150,render:t=>{let i=[{text:"查看",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}}},{text:"编辑",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isEdit:!0,businessUuid:t}})}}},{text:"删除",className:"delete",props:{onClick:()=>{h({msg:"确定删除该收货单吗？",callback:async()=>{await p(t.uuid),await z()}})}}}];return t.status&&(i=[{text:"查看",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}}}]),i.map((e=>U(O("el-button"),q({class:e.className},e.props,{type:"text"}),{default:()=>[e.text]})))}}],tableData:[],submitForm:{"page.currentPage":1,"page.pageSize":10,beginTime:E[0],endTime:g(new Date),businessUuid:[]}});const S=async()=>{l.supplier=await n()},z=async()=>{let t=_.submitForm,{businessUuid:i}=t,a=d(t,["businessUuid"]);i=x(i);let r=o({businessUuid:i},a);if(_.tloading=!0,_.tableData=[],"明细"==s.value)B();else{_.receiveTotal=await f(r);let{totalCount:t,list:i}=await c(r).finally((()=>{_.tloading=!1}));_.submitForm.total=t,_.tableData=i,_.columns=[{title:"序号",type:"index",fixed:"left",width:50},{title:"收货单编号",key:"receiveNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.receiveNo,onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}})},{title:"随货同行单",key:"peer",width:80},{title:"开票日期",key:"invoiceTime",width:110},{title:"供应商名称",key:"supplierName",formConfig:{"min-width":200}},{title:"商品种类",key:"category1",width:80},{title:"收货数量",width:85,align:"right",key:"receiveNum"},{title:"含税金额",key:"totalAmountTax",width:118,align:"right"},{title:"金额",key:"totalAmount",width:118,align:"right"},{title:"税额",key:"tax",width:118,align:"right"},{title:"创建人",key:"user",width:105},{title:"制单时间",key:"createTime",width:110},{title:"门店",key:"business",formConfig:{"min-width":150}},{title:"采购单编号",key:"orderNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.orderNo,onClick:()=>{e.push({path:"/purchase/purchase-order-detail",query:{uuid:t.purchaseUuid}})}})},{title:"操作",key:"options",width:150,render:t=>{let i=[{text:"查看",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}}},{text:"编辑",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isEdit:!0,businessUuid:t}})}}},{text:"删除",className:"delete",props:{onClick:()=>{h({msg:"确定删除该收货单吗？",callback:async()=>{await p(t.uuid),await z()}})}}}];return t.status&&(i=[{text:"查看",props:{onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.uuid,isDetail:!0}})}}}]),i.map((e=>U(O("el-button"),q({class:e.className},e.props,{type:"text"}),{default:()=>[e.text]})))}}]}},B=async()=>{let t=_.submitForm,{businessUuid:i}=t,a=d(t,["businessUuid"]);i=x(i);let r=o({businessUuid:i},a),l=_.form.list;if("汇总"==s.value)l[l.length-1].hidden=!0,z();else{_.tloading=!0,_.receiveDetailTotal=await k(r),_.tableData=[],l[l.length-1].hidden=!1;let t=await w(r).finally((()=>{_.tloading=!1}));t.list.map((e=>{e.name=e.productName})),_.columns=[{title:"序号",type:"index",fixed:"left",width:50},{title:"收货单编号",key:"receiveNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.receiveNo,onClick:()=>{e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:t.receiveUuid,isDetail:!0}})}})},{title:"随货同行单",key:"peer",width:80},{title:"开票日期",key:"invoiceTime",width:110},{title:"商品编号",key:"productCode",formConfig:{"min-width":200}},{title:"商品名称/规格/单位/生产厂家",key:"name",width:256,render:e=>D(v,{row:e,list:_.baseNameList}),formConfig:{"show-overflow-tooltip":!1}},{title:"批号",width:178,align:"right",key:"batchNumber"},{title:"生产日期",width:110,key:"productionDate"},{title:"有效期至",width:110,key:"expireDate"},{title:"收货数量",width:85,align:"right",key:"receiveNum"},{title:"含税进价",key:"taxPaid",width:118,align:"right"},{title:"含税金额",key:"taxAmount",width:118,align:"right"},{title:"进价",key:"price",width:118,align:"right"},{title:"金额",key:"amount",width:118,align:"right"},{title:"差额",key:"diffAmount",width:80,align:"right"},{title:"零售价",key:"retailPrice",width:118,align:"right"},{title:"零售金额",key:"retailAmount",width:118,align:"right"},{title:"税率",key:"tax",width:118,align:"right"},{title:"税额",key:"inputTaxRate",width:118,align:"right"},{title:"订单数量/未收",key:"outStandNum",align:"right",width:200,render:e=>U("div",null,[e.purchaseNum+"/"+e.outStandNum])},{title:"拒收数量",key:"returnNum",align:"right",width:110},{title:"拒收原因",key:"refuseReson",width:110},{title:"中药饮片产地",key:"medicineBeverage",width:140},{title:"批准文号",key:"approvalNumber",width:180},{title:"上市许可持有人",key:"holderPermit",width:220},{title:"制单时间",key:"planDate",width:110},{title:"门店",key:"business",formConfig:{"min-width":150}},{title:"采购单编号",key:"orderNo",width:135,render:t=>D(y,{type:"text",innerHTML:t.orderNo,onClick:()=>{e.push({path:"/purchase/purchase-order-detail",query:{uuid:t.purchaseUuid}})}})}],t.list.forEach((e=>{e.name=e.productName})),_.submitForm.total=t.totalCount,_.tableData=t.list}},H=async()=>{try{r.value=await a.dispatch("common/mechanism"),N(r.value,_,_.form)}catch(e){return e}};return L((async()=>{z(),H()})),P((()=>{F((()=>{_.submitForm.beginTime=E[0],_.submitForm.endTime=g(new Date)})),S()})),I=o({},A(_)),t(I,i({supplier:S,queue:l,select:z,handleClick:({item:t,type:i})=>{if("dblclick"===i&&"汇总"==s.value){let i=t.uuid;e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:i,type:"see",isDetail:!0}})}else if("dblclick"===i&&"明细"==s.value){let i=t.receiveUuid;e.push({path:"/purchase/add-purchase-dispatch",query:{uuid:i,type:"see",isDetail:!0}})}},radio1:s,handleChange:B,getFindListData:H}));var I}},[["render",function(e,t,i,a,r,s){const l=O("el-radio-button"),o=O("el-radio-group"),d=u;return E(),_(d,{"form-data":e.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[1]||(t[1]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.columns,pagination:e.submitForm,options:!0,loading:e.tloading,optionShow:!1,onOnClick:a.handleClick,select:a.select,spanNmu:4,isClear:e.isClear,add:{name:"新增收货单",path:{path:"/purchase/add-purchase-dispatch",query:{isEdit:!1}}}},{buttons:S((()=>[U(o,{modelValue:a.radio1,"onUpdate:modelValue":t[0]||(t[0]=e=>a.radio1=e),size:"small",onChange:a.handleChange,style:{position:"absolute",left:"0px"}},{default:S((()=>[U(l,{label:"汇总"}),U(l,{label:"明细"})])),_:1},8,["modelValue","onChange"]),z("div",I,[z("div",M,[z("span",null,"收货数量："+B("汇总"===a.radio1?e.receiveTotal.receiveNum:e.receiveDetailTotal.receiveNum),1),z("span",null,"含税金额："+B("汇总"===a.radio1?e.receiveTotal.totalAmountTax:e.receiveDetailTotal.taxAmount),1),z("span",null,"金额："+B("汇总"===a.radio1?e.receiveTotal.totalAmount:e.receiveDetailTotal.amount),1),z("span",null,"税额："+B("汇总"===a.radio1?e.receiveTotal.tax:e.receiveDetailTotal.tax),1)])])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","loading","onOnClick","select","isClear"])}],["__scopeId","data-v-3b069d09"]]);export{R as default};
