var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(t,i,a)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[i]=a,l=(e,t)=>{for(var i in t||(t={}))o.call(t,i)&&n(e,i,t[i]);if(a)for(var i of a(t))r.call(t,i)&&n(e,i,t[i]);return e},s=(e,a)=>t(e,i(a)),m=(e,t)=>{var i={};for(var n in e)o.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&a)for(var n of a(e))t.indexOf(n)<0&&r.call(e,n)&&(i[n]=e[n]);return i};import{_ as p}from"./BaseStencil.46c3d678.js";import{d}from"./element-plus.b44d97a8.js";import{r as u,_ as f}from"./index.ab904951.js";import{c,d as g,a as h,b}from"./index.1eb722f1.js";import{d as y}from"./public.9c1d8f39.js";import{_ as k}from"./BaseName.1aa32b4b.js";import{G as w,g as C,j as v,D as j,t as x,B as T,o as S,a5 as U,e as P,w as L,J as N,Q as O,S as _}from"./@vue.23a4bd1a.js";import{u as D}from"./vue-router.91336ba9.js";import{g as E,f as F}from"./filter.c2c8f0b9.js";import{u as M}from"./vuex.c868d4e0.js";import{s as z,g as A}from"./businessRule.60794e55.js";import"./moment.08a7f518.js";import{d as B}from"./index.7c4fa9df.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";/* empty css                                                             */const I=["productName","specification","unit","manufacturer"];const W={name:"ProcurementPlan",setup(e,t){const i=new Date,a=E(i,30,!0),o=D(),r=M();C([]);const n=v({findOgList:[]}),p=v(l({pageType:1,storeList:[],tloading:!1,submitForm:{"page.currentPage":1,"page.pageSize":10,startTime:a[0],endTime:F(new Date),businessUuids:[]},isClear:!1,tableData:[]},function(e,t){return{form:{inline:!0,labelWidth:"82px",list:[{type:"LINKAGETIME",design:{width:"240px"},keys:["startTime","endTime"],key:"createTime",config:{"start-placeholder":"制单开始时间","end-placeholder":"制单结束时间"}},{label:"",type:"SELECT",placeholder:"门店",key:"businessUuids",config:{multiple:!0},props:{label:"name",value:"uuid"},list:()=>t()},{key:"planStatus",type:"SELECT",props:{label:"label",value:"value"},placeholder:"订单状态",config:{filterable:!1},list:()=>[{label:"未转单",value:"0"},{label:"已转单",value:"2"},{label:"已作废",value:"3"}]},{type:"INPUT",key:"planNo",placeholder:"计划单编号"}]},columns:[],columns1:[{type:"index",title:"序号",fixed:"left",width:50},{title:"计划单编号",key:"planNo",formConfig:{"min-width":135}},{title:"商品种类数量",key:"category1",align:"right",formConfig:{"min-width":110}},{title:"含税金额",key:"totalAmountTax",align:"right",formConfig:{"min-width":110}},{title:"金额",key:"totalAmount",align:"right",formConfig:{"min-width":110}},{title:"门店",key:"business",formConfig:{"min-width":110}},{title:"订单状态",key:"planStatus",formConfig:{"min-width":78},render:e=>w("span",{innerText:["未转单","","已转单","已作废"][e.planStatus]})},{title:"创建人",key:"createUser",formConfig:{"min-width":110}},{title:"制单时间",key:"planDate",formConfig:{"min-width":110}},{title:"备注",key:"remark",formConfig:{"min-width":256}},{title:"操作",key:"options",width:150,render:({uuid:t,planStatus:i})=>w("div",[{type:"text",innerHTML:"查看",show:0==i,onClick:()=>{u.push({path:"/purchase/pocurement-plan-add",query:{uuid:t,type:"see"}})}},{type:"text",innerHTML:"编辑",show:0!==i,onClick:()=>{u.push({path:"/purchase/pocurement-plan-add",query:{uuid:t,type:"edit"}})}},{type:"text",innerHTML:"作废",show:3==i,onClick:()=>{c(t).then((t=>{e()}))}},{type:"text",innerHTML:"删除",show:0!==i,onClick:()=>{y({msg:"确认删除吗？",fun:g,uuid:t,callback:e})},style:{color:"#f56c6c"}}].map((e=>{if(!e.show)return w(d,e)})))}],columns2:[{type:"index",title:"序号",formConfig:{width:50}},{title:"计划单编号",key:"planNo",formConfig:{"min-width":176}},{title:"商品编号",key:"code",formConfig:{"min-width":110}},{title:"商品名称/规格/单位/生产厂家",key:"",formConfig:{"min-width":200},render:e=>w(k,{row:e,list:I})},{title:"参考库存",key:"",formConfig:{"min-width":110},render:e=>(0==e.overallPackNum?"0"+e.unit:e.overallPackNum?e.overallPackNum+e.unit:"")+(e.deleavePackNum?e.deleavePackNum+e.splitUnit:"")||"-"},{title:"参考月销量",key:"",formConfig:{"min-width":110},render:e=>(0==e.overallMonthSales?"0"+e.unit:e.overallMonthSales?e.overallMonthSales+e.unit:"")+(e.deleaveMonthSales?e.deleaveMonthSales+e.splitUnit:"")||"-"},{title:"参考周销量",key:"",formConfig:{"min-width":110},render:e=>(0==e.overallWeekSales?"0"+e.unit:e.overallWeekSales?e.overallWeekSales+e.unit:"")+(e.deleaveWeekSales?e.deleaveWeekSales+e.splitUnit:"")||"-"},{title:"采购数量",key:"purchaseNum",formConfig:{"min-width":110}},{title:"含税进价",key:"taxPaid",align:"right",formConfig:{"min-width":110}},{title:"供应商名称",key:"supplierName",formConfig:{"min-width":176}},{title:"含税金额",key:"taxAmount",align:"right",formConfig:{"min-width":110}},{title:"进价",key:"price",align:"right",formConfig:{"min-width":110}},{title:"金额",key:"amount",align:"right",formConfig:{"min-width":110}},{title:"差额",key:"diffAmount",width:80,align:"right"},{title:"进项税率",key:"inputTaxRate",formConfig:{"min-width":110}},{title:"税额",key:"tax",align:"right",formConfig:{"min-width":110}},{title:"零售价",key:"retailPrice",align:"right",formConfig:{"min-width":110}},{title:"零售金额",key:"retailAmount",align:"right",formConfig:{"min-width":110}},{title:"批准文号",key:"approvalNumber",formConfig:{"min-width":110}},{title:"上市许可持有人",key:"holderPermit",formConfig:{"min-width":110}},{title:"业务机构",key:"business",formConfig:{"min-width":110}},{title:"订单状态",key:"planStatus",formConfig:{"min-width":100},render:e=>w("span",{innerText:["未转单","转单","已转单","已作废"][e.planStatus]})},{title:"创建人",key:"createUser",formConfig:{"min-width":80}},{title:"创建时间",key:"createTime",formConfig:{"min-width":110}}]}}((()=>f()),(()=>n.findOgList)))),f=()=>{p.tloading=!0;let e=p.submitForm,{businessUuids:t}=e,i=m(e,["businessUuids"]);t=z(t);let a=l({businessUuids:t},i);1==p.pageType?(p.columns=p.columns1,h(a).then((e=>{p.tableData=e.list,p.submitForm.total=e.totalCount})),p.tloading=!1):(p.columns=p.columns2,b(a).then((e=>{p.tableData=e.list,p.submitForm.total=e.totalCount})),p.tloading=!1)};j((async()=>{p.storeList=await r.dispatch("common/mechanism"),n.findOgList=p.storeList,p.storeList&&(A(p.storeList,p,p.form),f())}));return s(l(l({},x(p)),x(n)),{getList:f,onClick:({item:e,type:t})=>{if("dblclick"==t){let t=1==p.pageType?e.uuid:e.planUuid;o.push({path:"/purchase/pocurement-plan-add",query:{uuid:t,type:"see"},returnPath:"/purchase/purchase-plan"})}},exportExcel:()=>{let{storeUuid:e}=r.state.common.info,t=p.submitForm,{businessUuids:i}=t,a=m(t,["businessUuids"]),o={};o=0==p.submitForm.businessUuids.length?l({businessUuids:p.storeList.map((e=>e.uuid)).join(",")},a):p.submitForm;let n=B("/gateway/chain-store/purchasePlan/planExport",s(l({},o),{storeUuid:e}));window.open(n,"_self")},typeChange:async e=>{p.pageType=e,A(p.storeList,p,p.form);let t={type:"INPUT",key:"invincible",placeholder:"商品信息"};1==e?p.form.list.pop():p.form.list.push(t),f()}})}},H={class:"supplier"},q=_(" 导出 "),V=_("汇总"),G=_("明细");var R=f(W,[["render",function(e,t,i,a,o,r){const n=T("el-button"),l=T("el-radio-button"),s=T("el-radio-group"),m=p;return S(),U("div",H,[P(m,{add:{path:"/purchase/pocurement-plan-add?type=add"},"form-data":e.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[2]||(t[2]=t=>e.submitForm=t),options:!0,columns:e.columns,select:a.getList,tableData:e.tableData,onOnClick:a.onClick,loading:e.tloading,isClear:e.isClear,"option-show":!1},{buttons:L((()=>[N(P(n,{style:{position:"absolute",right:"66px"},size:"small",plain:"",type:"primary",onClick:a.exportExcel},{default:L((()=>[q])),_:1},8,["onClick"]),[[O,1!=e.pageType]]),P(s,{modelValue:e.pageType,"onUpdate:modelValue":t[0]||(t[0]=t=>e.pageType=t),size:"small",style:{float:"left","margin-right":"10px","margin-bottom":"10px"},onChange:t[1]||(t[1]=t=>a.typeChange(e.pageType))},{default:L((()=>[P(l,{label:"1"},{default:L((()=>[V])),_:1}),P(l,{label:"2"},{default:L((()=>[G])),_:1})])),_:1},8,["modelValue"])])),_:1},8,["form-data","submit-form","columns","select","tableData","onOnClick","loading","isClear"])])}],["__scopeId","data-v-e14e4464"]]);export{R as default};
