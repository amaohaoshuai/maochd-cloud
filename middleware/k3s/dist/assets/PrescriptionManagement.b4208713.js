var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,l=(e,t)=>{for(var a in t||(t={}))s.call(t,a)&&r(e,a,t[a]);if(i)for(var a of i(t))o.call(t,a)&&r(e,a,t[a]);return e},n=(e,i)=>t(e,a(i));import{_ as d}from"./BaseStencil.46c3d678.js";import{o as p,a5 as c,a6 as m,g as u,j as y,e as g,J as f,Q as b,S as h,L as v,x as k,B as j,D as w,t as x,w as I,z as D,a8 as T,F as N,N as U,v as L,a9 as O,aa as P}from"./@vue.23a4bd1a.js";import{_ as C,s as M}from"./index.ab904951.js";import{u as S}from"./vue-router.91336ba9.js";import{k as _,l as F,m as E}from"./RetailReport.1533bc91.js";import{T as R}from"./tim-js-sdk.797ebc1d.js";import{h as Y}from"./moment.08a7f518.js";import{_ as q}from"./element-plus.b44d97a8.js";import{g as z,f as V}from"./filter.c2c8f0b9.js";import{s as G,g as A}from"./businessRule.60794e55.js";import{d as B}from"./index.7c4fa9df.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./vuex.c868d4e0.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";const J=[{label:"处方申请中",value:1},{label:"处方开具成功",value:2},{label:"处方开具失败",value:3},{label:"处方已使用",value:4},{label:"处方已失效",value:5}];function K(e,t){return{form:{inline:!0,labelWidth:"100px",list:[{label:"",type:"INPUT",key:"prescriptionNo",placeholder:"处方单号"},{label:"",type:"SELECT",key:"state",list:()=>J,placeholder:"处方状态"},{label:"",type:"SELECT",key:"businesses",placeholder:"门店",list:()=>t.value,config:{multiple:!0},props:{label:"name",value:"uuid"}},{type:"LINKAGETIME",keys:["startTime","endTime"],design:{width:"220px"},key:"time",config:{"start-placeholder":"开始时间","end-placeholder":"结束时间"}}]}}}const H={class:"image-print"},Q=["src"];var W=C({props:{png:{type:String,default:()=>""}}},[["render",function(e,t,a,i,s,o){return p(),c("div",H,[m("div",null,[m("img",{src:a.png},null,8,Q)])])}],["__scopeId","data-v-666eb55e"]]);var X=class{constructor(){this.tim=this.create(),this.tim.setLogLevel(0),this.groupId=""}create(){return R.create({SDKAppID:"1400544049"})}async login(e){return await this.tim.login(e)}async logout(){return await this.tim.logout()}createTextMessage(e){let{tim:t,groupId:a="1212"}=this,{createTextMessage:i}=t;return i({to:a,conversationType:R.TYPES.CONV_GROUP,payload:{text:e}})}async sendMessage(e){let{createTextMessage:t}=this;return this.tim.sendMessage(t(e))}async getMessageList(e,t){return await this.tim.getMessageList({conversationID:"GROUP"+e,count:t})}setGroupId(e){this.groupId=e}destroy(){this.tim.destroy()}},Z={name:"PrescriptionManagement",components:{Print:W},setup(e,t){const{dict:a}=M.state.common,i=new Date,s=z(i,30,!0),o=u([]),r=S(),d={1:"协助申请",2:"自主申请"},p={1:"处方申请中",2:"开具成功",3:"开具失败",4:"处方已使用",5:"处方已失效"},c=y({treatmentState:{1:"待接诊",2:"问诊中",3:"已结束",4:"已结束",5:"已结束"},borderColor:{1:"border-orange",2:"border-blue",3:"border-green",4:"border-green",5:"border-green"},png:"",printObj:{id:"printMe",popTitle:"处方打印",extraHead:'<meta http-equiv="Content-Language"content="zh-cn"/>',beforeOpenCallback:async e=>{},openCallback(e){},closeCallback(e){}}}),m=y({options:e=>[{label:"查看",in:[0,1,2,3,4,5],props:{onClick:()=>{r.push({name:"PrescriptionManagementDetails",query:{uuid:e.uuid}})}}},{label:"问诊记录",in:[0,1,2,3,4,5],props:{onClick:()=>{N(e)}}},{label:"打印",in:[2,4],props:{onClick:()=>{c.png=e.prescriptionPngUrl}}},{label:"下载",in:[2,4],props:{onClick:()=>{window.open(e.prescriptionPdfUrl,"_blank")}}}]}),I=y({doctorInfo:{},im:new X,data:[],columns:[{type:"index",title:"序号",width:52,fixed:"left"},{title:"处方单号",key:"prescriptionNo",width:180},{title:"处方号",key:"hospitalPrescriptionNo",width:180},{title:"销售单号",key:"orderNo",width:180,render:e=>g("div",null,[f(g("div",{onClick:()=>{r.push({name:"SaleOrderDetail",query:{uuid:e.orderUuid}})},style:"color: #1890ff;cursor: pointer;"},[e.orderNo]),[[b,e.orderNo]]),f(g("div",null,[h("-")]),[[b,!e.orderNo]])])},{title:"姓名",key:"name",width:124},{title:"手机号",key:"phone",width:120,formConfig:{"show-overflow-tooltip":!1}},{title:"处方来源",key:"source",width:135,render:e=>d[e.source]},{title:"开方医生",key:"prescriptionDoctor",width:110},{title:"开方时间",key:"createTime",width:110},{title:"审方药师",key:"auditDoctor",width:110},{title:"处方状态",key:"state",width:135,render:e=>p[e.state]},{title:"门店",key:"storeName",width:110},{title:"创建时间",key:"createTime",width:180,align:"right"},{title:"操作",key:"options",width:300,render:e=>m.options(e).map((t=>{if(t.in.includes(e.state))return"打印"===t.label?f(g(j("el-button"),k({type:"text"},t.props),{default:()=>[t.label]}),[[v("print"),c.printObj]]):g(j("el-button"),k({type:"text"},t.props),{default:()=>[t.label]})}))}],pdfUrl:"",visibility:!1,design:{width:"470px"},keys:["createTime.start","createTime.end"],activeName:"first",dict:a,excelUrl:"",tableData:[],loading:!1,deepSearchTable:K(0,o),prescriptionDialogList:[],otherInfo:{},submitForm:{"page.currentPage":1,"page.pageSize":10,prescriptionNo:"",state:"",businesses:"",startTime:s[0],endTime:V(new Date)}}),D=async()=>{I.loading=!0;try{const e=await F(I.submitForm);I.submitForm.pageNumber=e.currentPage,I.tableData=e.list,I.tableData.map((e=>{e.name=e.productName,e.drugUuid=e.productUuid})),I.submitForm.total=e.totalElements,I.loading=!1}catch(e){return I.loading=!1,e}},T=e=>{if("string"==typeof e)try{var t=JSON.parse(e);return!("object"!=typeof t||!t)}catch(a){return!1}};w((async()=>{(async()=>{o.value=await M.dispatch("common/mechanism"),A(o.value,I,I.deepSearchTable.form)})(),D()}));const N=e=>{1===e.state?U(e.uuid):(async(e,t,a,i)=>{const s=await E(a);await I.im.login({userID:a,userSig:s}),setTimeout((async()=>{U(e);try{const e=await I.im.getMessageList(t,i);I.prescriptionDialogList=e.data.messageList,I.prescriptionDialogList.map((e=>{"1"!==e.payload.description&&"4"!==e.payload.description||(e.createTime=Y(e.createTime).format("YYYY-MM-DD hh:mm:ss"),T(e.payload.data)&&(e.payload.data=JSON.parse(e.payload.data))),e.payload.form=a}))}catch(s){q.error(s)}}),300),I.otherInfo={uuid:e,groupUuid:t,customerUuid:a,num:i}})(e.uuid,e.groupUuid,e.customerUuid,15)},U=async e=>{const t=await _(e);I.visibility=!0,I.doctorInfo=n(l({},t.doctorVo),{hospital:t.hospital,status:t.status})};return n(l(l(l({},x(I)),x(c)),x(m)),{getPrescriptionListData:D,exportExcel:()=>{let{storeUuid:e}=M.state.common.info,t="";t=I.submitForm.businesses.length?G(I.submitForm.businesses):info.map((e=>e.uuid)).join(",");let a=B("/gateway/outside/prescription/export/prescription",n(l({},I.submitForm),{storeUuid:e,businesses:t}));window.open(a,"_self")},businessMechanismList:o,handleClick:({item:e,type:t})=>{if("dblclick"===t){let t=e.uuid;r.push({name:"PrescriptionManagementDetails",query:{uuid:t}})}},consultationRecord:N,load:async()=>{I.otherInfo.num+=1;const e=await I.im.getMessageList(I.otherInfo.groupUuid,I.otherInfo.num);I.prescriptionDialogList=e.data.messageList,I.prescriptionDialogList.map((e=>{"1"!==e.payload.description&&"4"!==e.payload.description||(e.createTime=Y(e.createTime).format("YYYY-MM-DD hh:mm:ss"),T(e.payload.data)&&(e.payload.data=JSON.parse(e.payload.data))),e.payload.form=I.otherInfo.customerUuid}))}})}},$="./assets/doctor-icon.2859f7ff.png";const ee=e=>(O("data-v-35b52213"),e=e(),P(),e),te={class:"prescription-management"},ae=["href"],ie=h(" 导出 "),se={class:"tit"},oe={style:{"margin-right":"10px"},class:"name"},re={style:{"margin-right":"10px"},class:"tips"},le={key:0,style:{display:"flex","justify-content":"center","align-items":"center",height:"500px"}},ne=[ee((()=>m("img",{style:{width:"200px",height:"200px"},src:"./assets/meet-diagnosis.5929e475.png",alt:""},null,-1)))],de={key:1,style:{width:"100%"},class:"content"},pe={key:0,style:{"text-align":"center",color:"#606266"}},ce={key:1,style:{"text-align":"center",color:"#606266"},class:"mg-top-20"},me={key:2,class:"mg-top-20"},ue={class:"left common top"},ye={class:"head-icon"},ge={key:0,src:$},fe=["src"],be={class:"label"},he={class:"tx"},ve={class:"name"},ke={class:"info"},je={class:"situation"},we={class:"diagnosis"},xe={class:"diagnosis"},Ie={key:3,class:"mg-top-20"},De={key:0},Te={style:{display:"flex","justify-content":"end","align-items":"center"}},Ne={class:"mg-right-8 meet-text-patient"},Ue={class:"head-icon"},Le={key:0},Oe=[ee((()=>m("img",{src:"./assets/nan.b832dfe5.png"},null,-1)))],Pe=["src"],Ce={key:1,style:{display:"flex","align-items":"center"}},Me={class:"head-icon mg-right-8"},Se={key:0,src:$},_e=["src"],Fe={class:"meet-text"},Ee={key:4,class:"mg-top-20"},Re={class:"left common top"},Ye={class:"head-icon"},qe={key:0,src:$},ze=["src"],Ve={class:"label"},Ge=ee((()=>m("div",{class:"tx",style:{"justify-content":"space-between"}},[m("div",{class:"name"},"电子处方"),m("div",{class:"name",style:{"font-weight":"bold",color:"#30bf8b"}}," 通过 ")],-1))),Ae={class:"situation"},Be={class:"diagnosis"},Je={class:"diagnosis",style:{display:"flex"}},Ke=h(" 用药需求： "),He={class:"diagnosis"};var Qe=C(Z,[["render",function(e,t,a,i,s,o){const r=j("el-button"),l=d,n=j("el-dialog"),u=j("Print"),y=v("loading"),b=v("infinite-scroll");return p(),c("div",te,[f(g(l,{"form-data":e.deepSearchTable.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.columns,pagination:e.submitForm,draggable:!1,options:!0,"option-show":!1,select:i.getPrescriptionListData,reduceNum:10,ref:"form",onOnClick:i.handleClick},{buttons:I((()=>[m("a",{href:e.excelUrl,download:"处方管理明细.xlsx"},[g(r,{style:{"margin-bottom":"22px"},class:"retail-details-btn",plain:"",type:"primary",onClick:i.exportExcel},{default:I((()=>[ie])),_:1},8,["onClick"])],8,ae)])),_:1},8,["form-data","submit-form","table-data","columns","pagination","select","onOnClick"]),[[y,e.loading]]),g(n,{modelValue:e.visibility,"onUpdate:modelValue":t[1]||(t[1]=t=>e.visibility=t)},{title:I((()=>[m("div",se,[m("div",oe,D(e.doctorInfo.doctorName?e.doctorInfo.doctorName:"-"),1),m("div",re,D(e.doctorInfo.hospital?e.doctorInfo.hospital:"-")+" | "+D(e.doctorInfo.department?e.doctorInfo.department:"-")+" | "+D(e.doctorInfo.titleValue?e.doctorInfo.titleValue:"-"),1),m("div",{class:T(e.borderColor[e.doctorInfo.status])},D(e.treatmentState[e.doctorInfo.status]),3)])])),default:I((()=>[1===e.doctorInfo.status||2===e.doctorInfo.status?(p(),c("div",le,ne)):(p(),c("div",de,[(p(!0),c(N,null,U(e.prescriptionDialogList,((t,a)=>f((p(),c("div",{id:"content",key:a},["5"===t.payload.description?(p(),c("div",pe,D(t.payload.data),1)):L("",!0),"0"===t.payload.description?(p(),c("div",ce,D(t.payload.data),1)):L("",!0),"1"===t.payload.description?(p(),c("div",me,[m("div",ue,[m("div",ye,[e.doctorInfo.fileUrl?(p(),c("img",{key:1,src:e.doctorInfo.fileUrl},null,8,fe)):(p(),c("img",ge))]),m("div",be,[m("div",he,[m("div",ve,D(t.payload.data.patientName),1),m("div",ke,D(1===t.payload.data.patientGender?"男":"女")+" | "+D(t.payload.data.patientAge),1)]),m("div",je," 肝/肾功能"+D(t.payload.data.liverAndKidney)+" | "+D(t.payload.data.fertility)+"妊娠哺乳 | "+D(t.payload.data.allergy)+"过敏史 | "+D(t.payload.data.trauma)+"其他病史 ",1),m("div",we," 病情诊断："+D(t.payload.data.inquiryResults?t.payload.data.inquiryResults:"无"),1),m("div",xe," 用药需求："+D(t.payload.data.normalNames),1)])])])):L("",!0),t.payload.hasOwnProperty("text")?(p(),c("div",Ie,[t.from===t.payload.form?(p(),c("div",De,[m("div",Te,[m("div",Ne,D(t.payload.text),1),m("div",Ue,[t.avatar?(p(),c("img",{key:1,src:t.avatar},null,8,Pe)):(p(),c("div",Le,Oe))])])])):(p(),c("div",Ce,[m("div",Me,[t.avatar?(p(),c("img",{key:1,src:t.avatar},null,8,_e)):(p(),c("img",Se))]),m("div",Fe,D(t.payload.text),1)]))])):L("",!0),"4"===t.payload.description?(p(),c("div",Ee,[m("div",Re,[m("div",Ye,[e.doctorInfo.fileUrl?(p(),c("img",{key:1,src:e.doctorInfo.fileUrl},null,8,ze)):(p(),c("img",qe))]),m("div",Ve,[Ge,m("div",Ae,D(t.payload.data.patientName)+" "+D("1"===t.payload.data.patientGender?"男":"女")+"| "+D(t.payload.data.patientAge)+" 开方医生："+D(e.doctorInfo.doctorName),1),m("div",Be," 病情诊断："+D(t.payload.data.inquiryResult),1),m("div",Je,[Ke,(p(!0),c(N,null,U(t.payload.data.prescribeRpDetails,((e,t)=>(p(),c("div",{key:t},[m("div",null,D(e.drugName)+" * "+D(e.drugNum),1)])))),128))]),m("div",He,"开方日期："+D(t.createTime),1)])])])):L("",!0)],512)),[[b,i.load]]))),128))]))])),_:1},8,["modelValue"]),g(u,{id:"printMe",png:e.png},null,8,["png"])])}],["__scopeId","data-v-35b52213"]]);export{Qe as default};
