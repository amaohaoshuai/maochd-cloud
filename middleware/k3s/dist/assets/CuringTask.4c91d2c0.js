var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,o=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&s(e,a,t[a]);if(i)for(var a of i(t))r.call(t,a)&&s(e,a,t[a]);return e};import{_ as n}from"./BaseStencil.46c3d678.js";import{_ as d}from"./EditForm.8c35f1a6.js";import{e as u,G as m,J as c,Q as p,S as b,B as g,g as f,j as y,D as h,t as k,L as v,o as C,a5 as j,w as T,c as w,a6 as x,v as D}from"./@vue.23a4bd1a.js";import{r as E,_ as S}from"./index.ab904951.js";import{b as F,_ as q}from"./element-plus.b44d97a8.js";import{d as L,m as O,a as U}from"./CuringTask.23b43602.js";import{u as _}from"./vue-router.91336ba9.js";import{_ as B}from"./lodash.d7ab6f48.js";import{g as P}from"./index.41a8010a.js";import{s as V,g as z}from"./businessRule.60794e55.js";import{u as I}from"./vuex.c868d4e0.js";import"./BaseForm.bc55ad6b.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./BaseTable.36f55649.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./dayjs.bad04745.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";const N={0:"待养护",1:"养护中",2:"已养护"};function Y(e,t,a){const i={columns:[{type:"index",title:"序号",formConfig:{width:50}},{title:"任务名称",key:"taskName"},{title:"养护类型",key:"mteType"},{title:"门店",key:"business"},{title:"商品类型",key:"productCategory",width:128,render:e=>u("div",null,[e.productCategory.join(",")])},{title:"养护排序",key:"sortCode"},{title:"任务生成时间",key:"createTime",width:110},{title:"养护时间",key:"lastTime",width:110},{title:"养护状态",key:"state",render:(e,t,a,i)=>m("div",N[e.state])},{title:"养护人",key:"maintenanceBy"},{title:"操作",key:"c",width:180,render:(e,t,a,i)=>[c(u(g("el-button"),{type:"text",style:"margin-right: 10px;",onClick:t=>{r(t,"c",e)}},{default:()=>[b("养护")]}),[[p,"0"==e.state||"1"==e.state]]),u(g("el-button"),{type:"text",style:"margin-right: 10px;",onClick:t=>{l(t,"c",e)}},{default:()=>[b("查看")]}),u(g("el-button"),{type:"text",style:"color: #F56C6C;",onClick:t=>{s(t,"c",e)}},{default:()=>[b("删除")]})]}]},l=(e,t,a)=>{E.push({name:"CuringTaskDetail",query:{uuid:a.uuid}})},r=(e,t,a)=>{E.push({name:"ConfirmCuringTask",query:{uuid:a.uuid}})},s=(e,a,i)=>{F.confirm("此操作将删除该养护任务,是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",beforeClose:(e,a,l)=>{if("confirm"===e){a.confirmButtonLoading=!0,a.confirmButtonText="执行中...";let e={uuid:i.uuid};L(e).then((e=>{a.confirmButtonLoading=!1,l(),t.value.select()}))}else l()}}).catch((e=>e))};return{form:{inline:!0,labelWidth:"100px",list:[{placeholder:"任务名称",type:"INPUT",key:"taskName"},{placeholder:"养护类型",type:"SELECT",key:"mteType",list:()=>[{label:"一般养护",value:1},{label:"重点养护",value:2},{label:"近效期养护",value:3}]},{placeholder:"门店",type:"SELECT",key:"businessUuid",props:{value:"uuid",label:"name"},list:()=>a.value,config:{multiple:!0}},{placeholder:"养护状态",type:"SELECT",key:"state",list:()=>[{label:"待养护",value:0},{label:"养护中",value:1},{label:"已养护",value:2}]},{type:"LINKAGETIME",keys:["createTime.start","createTime.end"],design:{width:"220px"},key:"createTime",config:{"start-placeholder":"开始时间","end-placeholder":"结束时间"}}]},tableConfig:i}}var M={name:"CuringTask",components:{BaseStencil:n},setup(e,s){const n=f(null),d=f(null),u=f([]),m=I(),{dict:c}=m.state.common,p=_(),b=B.find(c,{key:"category1"}),g=y({isClear:!1,dialogVisible:!1,title:"新增养护任务",info:{sortCode:"商品编码",state:0},formData:{inline:!1,labelWidth:"110px",config:{size:"medium"},list:[{type:"INPUT",key:"taskName",label:"任务名称",require:!0,maxlength:30,design:{width:"350px"},width:350,rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"SELECT",key:"businessUuid",label:"门店",design:{width:"350px"},width:350,require:!0,props:{value:"uuid",label:"name"},list:()=>u.value,config:{onChange:e=>{let t=B.find(u.value,{uuid:e});g.info.business=t.name}},rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"SELECT",key:"mteType",width:350,design:{width:"350px"},label:"养护类型",require:!0,list:()=>[{label:"一般养护",value:1},{label:"重点养护",value:2},{label:"近效期养护",value:3}],rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"DATEPICKER",key:"taskDate",label:"任务时间",design:{width:"350px"},config:{format:"YYYY-MM-DD"},require:!0,rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"SELECT",key:"productCategory",label:"商品类型",width:350,design:{width:"350px"},require:!0,config:{multiple:!0},props:{label:"key",value:"key"},list:()=>b.data,rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"SELECT",key:"sortCode",width:350,design:{width:"350px"},label:"养护排序条件",require:!0,list:()=>[{label:"商品编码",value:"商品编码"}],rules:[{required:!0,message:"请输入商品分类",trigger:"change"}]},{type:"INPUT",key:"remark",label:"备注",maxlength:100,design:{width:"414px"},config:{type:"textarea"}}]},dict:c,otherData:{},tableData:[],loading:!1,deepSearchTable:Y(0,n,u),submitForm:{"page.currentPage":1,"page.pageSize":10,businessUuid:[]}}),v=async()=>{g.loading=!0;try{let e=g.submitForm,{businessUuid:t}=e,a=((e,t)=>{var a={};for(var s in e)l.call(e,s)&&t.indexOf(s)<0&&(a[s]=e[s]);if(null!=e&&i)for(var s of i(e))t.indexOf(s)<0&&r.call(e,s)&&(a[s]=e[s]);return a})(e,["businessUuid"]);t=V(t);let s=o({businessUuid:t},a);const n=await O(s);g.submitForm.pageNumber=n.currentPage,g.tableData=n.list,g.submitForm.total=n.totalElements,g.loading=!1}catch(e){return g.loading=!1,e}};h((async()=>{await C(),v(),j()}));const C=async()=>{try{u.value=await m.dispatch("common/mechanism"),z(u.value,g,g.deepSearchTable.form)}catch(e){return e}},j=()=>{P().then((e=>{m.commit("common/DICT",e)}))};return T=o({},k(g)),t(T,a({getCuringTaskListData:v,addCuringTask:()=>{g.dialogVisible=!0,g.info={},d.value&&d.value.resetFields()},handleClose:e=>{d.value.resetFields(),e()},handleSubmit:async e=>{let{info:t}=g;d.value.handleClick(e)&&(await U(t)||q.warning("暂无养护的商品"),v(),g.dialogVisible=!1,d.value.resetFields())},baseForm:d,mechanismList:u,clear:()=>{d.value.resetFields(),g.dialogVisible=!1},form:n,handleTableClick:({item:e,type:t})=>{"dblclick"==t&&p.push({name:"CuringTaskDetail",query:{uuid:e.uuid}})}}));var T}};const A={class:"business-manage"},G=b("新增养护任务"),K={class:"dialog-footer"},R=b("取 消"),W=b(" 确 定 ");var H=S(M,[["render",function(e,t,a,i,l,r){const s=g("el-button"),o=n,m=d,p=g("el-dialog"),b=v("loading");return C(),j("div",A,[c(u(o,{"form-data":e.deepSearchTable.form,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),class:"base-stencil","table-data":e.tableData,columns:e.deepSearchTable.tableConfig.columns,pagination:e.submitForm,draggable:!1,options:!0,"option-show":!1,onOnClick:i.handleTableClick,select:i.getCuringTaskListData,ref:"form",otherData:e.deepSearchTable.tableConfig.listData,isClear:e.isClear},{buttons:T((()=>[u(s,{style:{"margin-bottom":"10px"},size:"small",type:"primary",onClick:i.addCuringTask},{default:T((()=>[G])),_:1},8,["onClick"])])),_:1},8,["form-data","submit-form","table-data","columns","pagination","onOnClick","select","otherData","isClear"]),[[b,e.loading]]),e.dialogVisible?(C(),w(p,{key:0,"before-close":i.handleClose,title:e.title,modelValue:e.dialogVisible,"onUpdate:modelValue":t[5]||(t[5]=t=>e.dialogVisible=t),width:"600px"},{footer:T((()=>[x("span",K,[u(s,{onClick:t[3]||(t[3]=e=>i.clear()),size:"small",style:{"margin-right":"20px"}},{default:T((()=>[R])),_:1}),u(s,{type:"primary",loading:e.loading,size:"small",onClick:t[4]||(t[4]=e=>i.handleSubmit(!0))},{default:T((()=>[W])),_:1},8,["loading"])])])),default:T((()=>[u(m,{"form-data":e.formData,"onUpdate:form-data":t[1]||(t[1]=t=>e.formData=t),"submit-form":e.info,"onUpdate:submit-form":t[2]||(t[2]=t=>e.info=t),ref:"baseForm"},null,8,["form-data","submit-form"])])),_:1},8,["before-close","title","modelValue"])):D("",!0)])}],["__scopeId","data-v-034dc745"]]);export{H as default};
