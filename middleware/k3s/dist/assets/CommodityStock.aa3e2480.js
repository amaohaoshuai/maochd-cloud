var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,s=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))r.call(t,a)&&o(e,a,t[a]);return e},m=(e,i)=>t(e,a(i));import{_ as u}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./BaseTable.36f55649.js";import{_ as n}from"./BaseName.1aa32b4b.js";import{e as c}from"./element-resize-detector.5b0b5621.js";import{u as p}from"./vuex.c868d4e0.js";import{s as b}from"./PurchaseAcceptance.9cfc0e35.js";import{g as h}from"./RetailReport.1533bc91.js";import{g as k,a as f,b as v,c as y,d as g}from"./index.97161d3f.js";import{s as w,e as P,g as N}from"./businessRule.60794e55.js";import{j as F,e as x,S as j,B as U,h as S,n as C,D,t as T,q as G,L,o as I,a5 as _,a6 as O,J as E,w as B,z as M}from"./@vue.23a4bd1a.js";import{_ as z}from"./index.ab904951.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./lodash.d7ab6f48.js";import"./dayjs.bad04745.js";/* empty css                                                             */import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var H={name:"CommodityStock",components:{BaseName:n},setup(){let e=p(),t=F({storeList:[],supplierList:[],cabinetGroupList:[]}),a=F({isClear:!1,baseNameList:["name","specification","unit","manufacturer"],height:1e3,activeName:"first",number:void 0,numbertooltip:"",loading:!1,formData:{labelWidth:"110px",span:8,inline:!0,list:[{type:"INPUT",key:"uniteField",placeholder:"编码/品名/助记码/条码"},{type:"SELECT",list:()=>t.supplierList,placeholder:"供应商",key:"supplierName"},{type:"SELECT",placeholder:"门店",list:()=>t.storeList,key:"businessUuid",config:{multiple:!0},props:{label:"name",value:"uuid"}},{type:"SELECT",placeholder:"柜组",config:{multiple:!0},list:()=>t.cabinetGroupList,key:"cabinetGroupUuid",props:{label:"name",value:"uuid"}}]},columnsSP:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"商品编码",key:"code",width:100,fixed:"left",sortable:!0},{title:"商品信息",key:"name",width:180,formConfig:{"show-overflow-tooltip":!1},fixed:"left",sortable:!0,render:e=>x(n,{row:e,list:a.baseNameList},null)},{title:"库存数量",key:"overallPackNum",width:100,sortable:!0,align:"right",render:e=>x("div",null,[0==e.overallPackNum&&0!=e.deleavePackNum||0==e.overallPackNum&&0==e.deleavePackNum?"0":e.overallPackNum,e.overallPackNum||0==e.overallPackNum&&0!=e.deleavePackNum?e.unit:"",e.deleavePackNum?e.deleavePackNum:"",e.deleavePackNum?e.splitUnit:""])},{title:"成本进价",key:"overallPackPrice",formConfig:{"min-width":110},sortable:!0,align:"right"},{title:"成本金额",key:"totalPrice",width:140,sortable:!0,align:"right"},{title:"毛利率%",key:"grossMargin",width:120,align:"right"},{title:"零售价",key:"retailPrice",width:120,sortable:!0,align:"right"},{title:"最新进价",key:"purchasePrice",width:140,sortable:!0,align:"right"},{title:"最新供应商名称",key:"latestSupplier",width:180},{title:"最后入库时间",key:"lastInStorageDate",width:150},{title:"门店",key:"business",width:140},{title:"柜组",key:"cabinetGroupName",width:100},{title:"批准文号",key:"approvalNumber",width:224},{title:"上市许可持有人",key:"holderPermit",width:170},{title:"采购状态",key:"purchaseState",width:78},{title:"销售状态",key:"saleState",width:78}],columnsPH:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"商品编码",key:"code",width:100,fixed:"left",sortable:!0},{title:"商品信息",key:"name",width:180,formConfig:{"show-overflow-tooltip":!1},fixed:"left",sortable:!0,render:e=>x(n,{row:e,list:a.baseNameList},null)},{title:"批号",key:"batchNum",width:150,header:()=>x("div",{class:"table-title"},[x("i",null,[j("*")]),j("批号")])},{title:"生产日期",key:"producedTime",width:150},{title:"有效期至",key:"indate",width:150,sortable:!0,formConfig:{"show-overflow-tooltip":!0,class:"bathNumber-title-header"},header:()=>x(U("el-tooltip"),{class:"item",effect:"dark",content:a.numbertooltip,placement:"top"},{default:()=>[x("span",null,[x("span",{class:"tag-title"},[a.number<99?a.number:"99+"]),j("有效期至")])]}),render:e=>{let t=(new Date(e.indate).getTime()-(new Date).getTime())/864e5;return x("div",{style:{color:t<181&&t>=0?"#F5AD40":t<0?"#F56C6C":""}},[e.indate])}},{title:"库存数量",key:"overallPackNum",width:100,sortable:!0,align:"right",render:e=>x("div",null,[0==e.overallPackNum&&0!=e.deleavePackNum||0==e.overallPackNum&&0==e.deleavePackNum?"0":e.overallPackNum,e.overallPackNum||0==e.overallPackNum&&0!=e.deleavePackNum?e.unit:"",e.deleavePackNum?e.deleavePackNum:"",e.deleavePackNum?e.splitUnit:""])},{title:"最新供应商名称",key:"latestSupplier",width:180},{title:"最后入库时间",key:"lastInStorageDate",width:150},{title:"门店",key:"business",width:140},{title:"柜组",key:"cabinetGroupName",width:100},{title:"批准文号",key:"approvalNumber",width:150},{title:"上市许可持有人",key:"holderPermit",width:140},{title:"采购状态",key:"purchaseState",width:100},{title:"销售状态",key:"saleState",width:100}],columnsPC:[{type:"index",title:"序号",formConfig:{width:50},fixed:"left"},{title:"商品编码",key:"code",width:100,sortable:!0,fixed:"left"},{title:"商品信息",key:"name",width:180,formConfig:{"show-overflow-tooltip":!1},fixed:"left",sortable:!0,render:e=>x(n,{row:e,list:a.baseNameList},null)},{title:"批号",key:"batchNum",width:150,header:()=>x("div",{class:"table-title"},[x("i",null,[j("*")]),j("批号")])},{title:"生产日期",key:"producedTime",width:150},{title:"有效期至",sortable:!0,key:"indate",width:150},{title:"批次号",key:"batchNumIn",width:180},{title:"库存数量",key:"overallPackNum",width:100,sortable:!0,align:"right",render:e=>x("div",null,[0==e.overallPackNum&&0!=e.deleavePackNum||0==e.overallPackNum&&0==e.deleavePackNum?"0":e.overallPackNum,e.overallPackNum||0==e.overallPackNum&&0!=e.deleavePackNum?e.unit:"",e.deleavePackNum?e.deleavePackNum:"",e.deleavePackNum?e.splitUnit:""])},{title:"最新供应商名称",key:"latestSupplier",width:180},{title:"最后入库时间",key:"lastInStorageDate",width:150},{title:"门店",key:"business",width:140},{title:"柜组",key:"cabinetGroupName",width:100},{title:"批准文号",key:"approvalNumber",width:150},{title:"上市许可持有人",key:"holderPermit",width:140},{title:"采购状态",key:"purchaseState",width:100},{title:"销售状态",key:"saleState",width:100}],submitForm:{"page.currentPage":1,"page.pageSize":10,businessUuid:[],supplierName:"",uniteField:"",cabinetGroupUuid:[],orderField:"lastInStorageDate",orderDirection:"desc"},exportForm:{uniteField:"",supplierName:"",businessUuid:"",cabinetGroupUuid:""},tableData:[],excelUrl:"",summaryData:{overallPackNum:null,deleavePackNum:null,totalPrice:null}});const o=S((()=>{switch(a.activeName){case"first":return"商品库存列表.xls";case"second":return"批号库存列表.xls";case"third":return"批次库存列表.xls"}})),u=e=>{let{total:t,records:i}=e;a.submitForm.total=t,i.forEach((e=>{e.drugUuid=e.productUuid})),i.forEach((e=>{e.grossMargin=parseFloat(e.grossMargin).toFixed(2),e.totalPrice=parseFloat(e.totalPrice).toFixed(2),e.texPurchasePrice=parseFloat(e.texPurchasePrice).toFixed(2),e.retailPrice=parseFloat(e.retailPrice).toFixed(2),e.overallPackPrice=parseFloat(e.overallPackPrice).toFixed(2),e.purchasePrice=parseFloat(e.purchasePrice).toFixed(2)})),a.tableData=i},d=async()=>{let t=[];for(var o=0;o<a.submitForm.cabinetGroupUuid.length;o++)t.push(a.submitForm.cabinetGroupUuid[o]);let d=a.submitForm,{cabinetGroupUuid:n,businessUuid:c}=d,p=((e,t)=>{var a={};for(var o in e)l.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&i)for(var o of i(e))t.indexOf(o)<0&&r.call(e,o)&&(a[o]=e[o]);return a})(d,["cabinetGroupUuid","businessUuid"]);if(c=w(c),0==a.submitForm.businessUuid.length){const t=await e.dispatch("common/mechanism");let i=P(a.submitForm,t);a.exportForm.businessUuid=i.businessUuid}let b=m(s({},p),{cabinetGroupUuid:t.join(","),businessUuid:c});switch(a.activeName){case"first":G((()=>{v(b).then((e=>{u(e)})),O(b)}));break;case"second":G((()=>{f(b).then((e=>{u(e)})),O(b),B(b)}));break;case"third":G((()=>{k(b).then((e=>{u(e)})),O(b)}))}},L=async()=>{t.storeList=await e.dispatch("common/mechanism"),N(t.storeList,a,a.formData)},I=async()=>{t.cabinetGroupList=await h()},_=()=>{b().then((e=>{let a=e.map(((e,t)=>({label:e.supplierName,value:e.supplierName})));t.supplierList=a}))},O=e=>{y(e).then((e=>{e&&(a.summaryData=e)}))},E=t=>new Promise(((i,l)=>{i(`${t}?uniteField=`+a.exportForm.uniteField+"&supplierName="+a.exportForm.supplierName+"&businessUuid="+a.exportForm.businessUuid+"&storeUuid="+e.state.common.info.storeUuid+"&cabinetGroupUuid="+a.exportForm.cabinetGroupUuid)})),B=async e=>{try{a.number=await g(e),a.numbertooltip="近效期商品数量:"+a.number}catch(t){return t}};return C((()=>{(()=>{const e=c();setTimeout((()=>{e.listenTo(document.getElementById("tab"),(e=>{G((()=>{a.height=e.offsetHeight-130}))}))}),200)})()})),D((()=>{L(),_(),I(),d(),O(),B()})),m(s(s({},T(a)),T(t)),{downloadTxt:o,handleClick:e=>{a.submitForm["page.currentPage"]=1,a.submitForm.orderField="",a.submitForm.orderDirection="asc",d()},getCommodityStock:d,getStoreList:L,getSupplierList:_,getGroupList:I,axiosGetTemplate:async()=>{switch(a.exportForm=Object.assign(a.exportForm,{uniteField:a.submitForm.uniteField||"",supplierName:a.submitForm.supplierName||"",cabinetGroupUuid:a.submitForm.cabinetGroupUuid||""}),0!=a.submitForm.businessUuid.length&&(a.exportForm.businessUuid=a.submitForm.businessUuid),a.loading=!0,a.activeName){case"first":a.excelUrl=await E("/gateway/chain-store/stock/exportProductStockPage");break;case"second":a.excelUrl=await E("/gateway/chain-store/stock/exportStockBatchNumPage");break;case"third":a.excelUrl=await E("/gateway/chain-store/stock/exportStockBatchNumInPage")}a.loading=!1},sortTable:e=>{a.submitForm.orderField=e.prop,a.submitForm.orderDirection="ascending"===e.order?"asc":"desc",d()},getTotalData:O,getNumber:B})}};const R={class:"stencil"},V={class:"top"},A={class:"main"},q={class:"scollbar",id:"tab"},J={class:"mainbox"},W={class:"stock-statistics"},$=["href","download"],K=j(" 导出 ");var Q=z(H,[["render",function(e,t,a,i,l,r){const o=u,s=d,m=U("el-tab-pane"),n=U("el-tabs"),c=U("el-button"),p=L("loading");return I(),_("div",R,[O("div",V,[E(x(o,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),options:!0,select:i.getCommodityStock,isClear:e.isClear},null,8,["form-data","submit-form","select","isClear"]),[[p,e.loading]])]),O("div",A,[O("div",q,[O("div",J,[x(n,{modelValue:e.activeName,"onUpdate:modelValue":t[1]||(t[1]=t=>e.activeName=t),onTabClick:i.handleClick},{default:B((()=>[x(m,{label:"商品库存",name:"first"},{default:B((()=>[x(s,{select:i.getCommodityStock,sortMethod:i.sortTable,"table-data":e.tableData,columns:e.columnsSP,pagination:e.submitForm,optionShow:!1,reduceNum:50,classId:"tab"},null,8,["select","sortMethod","table-data","columns","pagination"])])),_:1}),x(m,{label:"批号库存",name:"second"},{default:B((()=>[x(s,{class:"bathNumber-title",select:i.getCommodityStock,sortMethod:i.sortTable,"table-data":e.tableData,columns:e.columnsPH,pagination:e.submitForm,optionShow:!1,reduceNum:50,classId:"tab"},null,8,["select","sortMethod","table-data","columns","pagination"])])),_:1}),x(m,{label:"批次库存",name:"third"},{default:B((()=>[x(s,{select:i.getCommodityStock,sortMethod:i.sortTable,"table-data":e.tableData,columns:e.columnsPC,pagination:e.submitForm,optionShow:!1,reduceNum:50,classId:"tab"},null,8,["select","sortMethod","table-data","columns","pagination"])])),_:1})])),_:1},8,["modelValue","onTabClick"])]),O("div",W,[O("p",null," 整装数量合计："+M(e.summaryData.overallPackNum?e.summaryData.overallPackNum:"0"),1),O("p",null," 拆零数量合计："+M(e.summaryData.deleavePackNum?e.summaryData.deleavePackNum:"0"),1),O("p",null," 成本金额合计："+M(e.summaryData.totalPrice?e.summaryData.totalPrice:"0.00")+"元 ",1)]),O("a",{href:e.excelUrl,download:i.downloadTxt},[E(x(c,{type:"primary",onClick:i.axiosGetTemplate,plain:"",size:"small",class:"stock-btn"},{default:B((()=>[K])),_:1},8,["onClick"]),[[p,e.loading]])],8,$)])])])}],["__scopeId","data-v-93dc7f9a"]]);export{Q as default};
