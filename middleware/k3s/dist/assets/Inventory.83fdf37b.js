var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,l=(a,t,i)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[t]=i,n=(e,a)=>{for(var t in a||(a={}))o.call(a,t)&&l(e,t,a[t]);if(i)for(var t of i(a))s.call(a,t)&&l(e,t,a[t]);return e},r=(e,i)=>a(e,t(i)),p=(e,a)=>{var t={};for(var l in e)o.call(e,l)&&a.indexOf(l)<0&&(t[l]=e[l]);if(null!=e&&i)for(var l of i(e))a.indexOf(l)<0&&s.call(e,l)&&(t[l]=e[l]);return t};import{_ as u}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./BaseTable.36f55649.js";import{u as m}from"./vuex.c868d4e0.js";import{u as c}from"./vue-router.91336ba9.js";import{d as b,p as y,i as g,a as f,s as h}from"./index.817e3859.js";import{d as v}from"./public.9c1d8f39.js";import"./lodash.d7ab6f48.js";import{g as k,f as C}from"./filter.c2c8f0b9.js";import{d as j}from"./index.7c4fa9df.js";import{g as w}from"./RetailReport.1533bc91.js";import{c as L}from"./data.c063697f.js";import{g as F}from"./index.6a02aeaf.js";import{s as T,g as U,a as S}from"./businessRule.60794e55.js";import{j as x,e as O,x as V,B as _,n as N,D,t as E,o as P,a5 as z,w as I,a6 as A,F as B,N as G,z as q,S as R,a9 as J,aa as K}from"./@vue.23a4bd1a.js";import{_ as Q}from"./index.ab904951.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";import"./axios.7b768d2b.js";import"./element-plus.b44d97a8.js";import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./BaseName.1aa32b4b.js";/* empty css                                                             */import"./BaseNotice.93ee8e4e.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";var H={name:"Inventory",setup(){const e=m(),a=c(),t=new Date;let i=k(t,30,!0);const o=x({options:e=>[{label:"查看",in:[0,1,2,3],props:{onClick:()=>{a.push({path:"/storage/inventory-detail",query:{uuid:e.uuid,row:JSON.stringify(e)}})}}},{label:"编辑",in:[0,3],props:{onClick:()=>{a.push({path:"/storage/inventory-add",query:{uuid:e.uuid,row:JSON.stringify(e)}})}}},{label:"录入单",in:[0,1,2,3],props:{onClick:()=>{let{uuid:t,inventoryNo:i,business:o}=e;a.push({path:"/storage/inventory-entry-sheet",query:{uuid:e.uuid,inventoryNo:e.inventoryNo,business:o,accountState:e.accountState}})}}},{label:"撤回",in:[1],props:{onClick:()=>{conosle.log("撤回")}}},{label:"记账",judgment:()=>0===e.notBatchNum,in:[0,3],props:{onClick:()=>{l.beekFrom=e,l.bookkeeping=!0}}},{label:"删除",in:[0,3],className:"delete",props:{onClick:()=>{v({title:"删除",msg:"确认删除盘点任务吗？删除后，该盘点任务的录入单一并删除",config:{pagination:l.pagination,data:l.data},callback:async()=>{await b(e.uuid),u()}})}}}],texts:["盘点中","待记账","已记账"],mechanism:[],findOgList:[],accountState:[{label:"盘点中",value:0},{label:"待记账",value:1},{label:"已记账",value:2}],differences:[{label:"无差异",value:0},{label:"盘损",value:1},{label:"盘溢",value:2}],pageType:"1",optionShow:!0,loading:!1,getCabinetgroupList:[],getAllCategoryList:[],inventoryType:1,addLoading:!1}),{home:s}=L(null,o),l=x({storeList:[],isClear:!1,baseForm:null,bookkeeping:!1,dialogVisible:!1,initFormList:[{label:"",type:"SELECT",placeholder:"请选择门店",key:"businessUuid",props:{label:"name",value:"uuid"},list:()=>o.mechanism,config:{multiple:!0}},{type:"LINKAGETIME",design:{width:"240px"},keys:["startPlanDate","endPlanDate"],key:"time",config:{"start-placeholder":"结算开始时间","end-placeholder":"结算结束时间"}},{placeholder:"盘点单号",type:"INPUT",key:"inventoryNo"},{type:"SELECT",placeholder:"记账状态",key:"accountState",list:()=>o.accountState,show:()=>"1"===o.pageType},{type:"SELECT",placeholder:"差异状态",key:"differences",list:()=>o.differences,show:()=>"2"===o.pageType},{type:"INPUT",placeholder:"编码/名称/助记码/条码",key:"fuzzyValue",show:()=>"2"===o.pageType}],selectForm:{inline:!0,list:[]},formData:{inline:!1,labelWidth:"80px",list:[{type:"SELECT",label:"门店",rules:[{required:!0,message:"请选择门店"}],list:()=>o.mechanism,props:{label:"name",value:"uuid"},key:"businessUuid",config:{onChange:e=>{l.submitForm.cabinetGroupUuidList=[],2===o.inventoryType&&P(e)}}},{type:"SELECT",label:"盘点类型",key:"inventoryType",list:[{value:1,label:"全盘"},{value:2,label:"柜组"},{value:3,label:"商品分类"}],rules:[{required:!0,message:"请选择盘点类型"}],config:{onChange:e=>{o.inventoryType=e,2===o.inventoryType&&P(l.submitForm.businessUuid)}}},{type:"SELECT",label:"柜组",key:"cabinetGroupUuidList",list:()=>o.getCabinetgroupList,props:{label:"name",value:"uuid"},hidden:()=>2===o.inventoryType,config:{multiple:!0}},{type:"SELECT",label:"商品分类",key:"categoryUuidList",list:()=>o.getAllCategoryList,props:{label:"categoryName",value:"uuid"},hidden:()=>3===o.inventoryType,config:{multiple:!0}}]},beekFrom:{},beekData:[{label:"实盘成本金额：",key:"firmOfferCostAmount",type:"DIV",unit:"元"},{label:"实盘零售金额合计：",key:"firmRetailAmount",type:"DIV",unit:"元"},{label:"盈亏成本金额：",key:"profitLossCostAmount",type:"DIV",unit:"元"},{label:"盈亏零售金额合计：",key:"profitLossRetailAmount",type:"DIV",unit:"元"}],columns:[],submitForm:{inventoryType:1,categoryUuidList:[],cabinetGroupUuidList:[]},initSubmitFor:{inventoryType:1,categoryUuidList:[],cabinetGroupUuidList:[]},pagination:{"page.currentPage":1,"page.pageSize":10,startPlanDate:i[0],endPlanDate:C(new Date),businessUuid:[]},data:[],columnsCache:{title:"操作",width:300,key:"options",render:e=>o.options(e).map((a=>{if(a.in.includes(e.accountState))return O(_("el-button"),V({type:"text",class:a.className},a.props),{default:()=>[a.label]})}))}}),u=async()=>{let e="1"===o.pageType?y:g,a=l.pagination,{businessUuid:t}=a,i=p(a,["businessUuid"]);t=T(t);let s=n({businessUuid:t},i),{list:r,totalCount:u}=await e(s);l.pagination.total=u,l.data=r,o.loading=!1},d=()=>{o.loading=!0,l.data=[],l.selectForm.list=l.initFormList.filter((e=>!e.show||e.show()));let e=s[o.pageType];"1"===o.pageType?o.optionShow=!0:o.optionShow=!1,l.columns=e},P=async e=>{const a={businessUuid:e};o.getCabinetgroupList=await w(a)};return N((async()=>{(()=>{o.loading=!0,l.data=[],l.selectForm.list=l.initFormList.filter((e=>!e.show||e.show()));let e=s[o.pageType];"1"===o.pageType?(o.optionShow=!0,e.push(l.columnsCache)):o.optionShow=!1,l.columns=e})(),(async()=>{o.getCabinetgroupList=await w(),o.getAllCategoryList=await F()})(),l.storeList=await e.dispatch("common/mechanism"),o.mechanism=l.storeList,U(o.mechanism,l,l.selectForm)})),D((async()=>{l.storeList=await e.dispatch("common/mechanism"),u()})),r(n(n({},E(o)),E(l)),{handleOpen:()=>{l.dialogVisible=!0,o.mechanism.length&&S(l.submitForm,o.mechanism),l.submitForm.inventoryType=1,l.submitForm.cabinetGroupUuidList=[],l.submitForm.categoryUuidList=[],o.inventoryType=1},handleCreat:async()=>{if(o.addLoading=!0,await l.baseForm.verification()){const e=l.storeList.filter((e=>e.uuid==l.submitForm.businessUuid));l.submitForm.business=e[0].mechanismName,await f(l.submitForm).catch((()=>{})),l.dialogVisible=!1,u()}o.addLoading=!1},handleKeeping:async()=>{await h(l.beekFrom.uuid),l.bookkeeping=!1,u()},getQueryPage:u,handleClick:({item:e,type:t})=>{"1"==o.pageType&&"dblclick"===t&&(e.uuid,a.push({path:"/storage/inventory-detail",query:{uuid:e.uuid,row:JSON.stringify(e)}}))},typeChange:e=>{d(),u()},handlDowLoad:async()=>{let{storeUuid:a}=e.state.common.info,t=l.pagination,{businessUuid:i}=t,s=p(t,["businessUuid"]),u={};u=0==l.pagination.businessUuid.length?n({businessUuid:l.storeList.map((e=>e.uuid)).join(",")},s):l.pagination;let d="1"===o.pageType?"/gateway/chain-store/inventory/pagelist/export":"/gateway/chain-store/inventoryrel/pagelist/export",m=j(d,r(n({},u),{storeUuid:a}));window.open(m,"_self")},handleSelect1:d,changeGroup:P})},components:{BaseForm:u}};const M=e=>(J("data-v-6ba52494"),e=e(),K(),e),W={class:"inventory",id:"tab"},X={class:"button-box"},Y={class:"left"},Z=R("汇总"),$=R("明细"),ee={class:"right"},ae=R("导出"),te=R("新增盘点"),ie={class:"dialog-footer"},oe=R("取 消"),se=R("确 定"),le=M((()=>A("div",{class:"title"},"确认提交记账审核吗？",-1))),ne={class:"other-from"},re={class:"temp-div"},pe=M((()=>A("div",{class:"note"},"注：审核通过后系统自动记账调整库存",-1))),ue={class:"dialog-footer"},de=R("取 消"),me=R("提交审核");var ce=Q(H,[["render",function(e,a,t,i,o,s){const l=u,n=_("el-radio-button"),r=_("el-radio-group"),p=_("el-button"),m=d,c=_("el-dialog");return P(),z("div",W,[O(l,{"form-data":e.selectForm,submitForm:e.pagination,"onUpdate:submitForm":a[0]||(a[0]=a=>e.pagination=a),ref:"baseForm",options:!0,select:i.getQueryPage,isClear:e.isClear},null,8,["form-data","submitForm","select","isClear"]),O(m,{pagination:e.pagination,"onUpdate:pagination":a[2]||(a[2]=a=>e.pagination=a),columns:e.columns,"table-data":e.data,select:i.getQueryPage,"class-id":"tab","reduce-num":74,"fixed-head":!1,"option-show":e.optionShow,loading:e.loading,onOnClick:i.handleClick},{buttons:I((()=>[A("div",X,[A("div",Y,[O(r,{modelValue:e.pageType,"onUpdate:modelValue":a[1]||(a[1]=a=>e.pageType=a),onChange:i.typeChange,size:"small"},{default:I((()=>[O(n,{label:"1"},{default:I((()=>[Z])),_:1}),O(n,{label:"2"},{default:I((()=>[$])),_:1})])),_:1},8,["modelValue","onChange"])]),A("div",ee,[O(p,{size:"small",onClick:i.handlDowLoad},{default:I((()=>[ae])),_:1},8,["onClick"]),O(p,{size:"small",type:"primary",onClick:i.handleOpen},{default:I((()=>[te])),_:1},8,["onClick"])])])])),_:1},8,["pagination","columns","table-data","select","option-show","loading","onOnClick"]),O(c,{title:"生成盘点任务",modelValue:e.dialogVisible,"onUpdate:modelValue":a[5]||(a[5]=a=>e.dialogVisible=a),width:"300px"},{footer:I((()=>[A("span",ie,[O(p,{onClick:a[4]||(a[4]=a=>e.dialogVisible=!1),size:"small"},{default:I((()=>[oe])),_:1}),O(p,{type:"primary",onClick:i.handleCreat,size:"small",loading:e.addLoading},{default:I((()=>[se])),_:1},8,["onClick","loading"])])])),default:I((()=>[O(l,{"form-data":e.formData,submitForm:e.submitForm,"onUpdate:submitForm":a[3]||(a[3]=a=>e.submitForm=a),ref:"baseForm"},null,8,["form-data","submitForm"])])),_:1},8,["modelValue"]),O(c,{"custom-class":"other-dialog",title:"记账",modelValue:e.bookkeeping,"onUpdate:modelValue":a[7]||(a[7]=a=>e.bookkeeping=a),width:"420px"},{footer:I((()=>[A("span",ue,[O(p,{onClick:a[6]||(a[6]=a=>e.bookkeeping=!1)},{default:I((()=>[de])),_:1}),O(p,{type:"primary",onClick:i.handleKeeping},{default:I((()=>[me])),_:1},8,["onClick"])])])),default:I((()=>[le,A("div",ne,[(P(!0),z(B,null,G(e.beekData,(a=>(P(),z("div",{key:a.key,class:"item"},[A("label",null,q(a.label),1),A("span",re,q(e.beekFrom[a.key])+"元",1)])))),128))]),pe])),_:1},8,["modelValue"])])}],["__scopeId","data-v-6ba52494"]]);export{ce as default};
