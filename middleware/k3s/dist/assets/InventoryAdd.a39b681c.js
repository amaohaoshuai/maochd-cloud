var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,r=(e,t)=>{for(var a in t||(t={}))o.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))i.call(t,a)&&s(e,a,t[a]);return e},m=(e,l)=>t(e,a(l));import{_ as u}from"./BaseForm.bc55ad6b.js";import{_ as n}from"./BaseTable.36f55649.js";import{_ as c}from"./BaseCard.46de0c24.js";import{e as d,b as p,c as b,f}from"./index.817e3859.js";import{u as v,b as h}from"./vue-router.91336ba9.js";import{c as N}from"./data.c063697f.js";import{e as y}from"./element-resize-detector.5b0b5621.js";import{g}from"./RetailReport.1533bc91.js";import{h as C}from"./moment.08a7f518.js";import{_ as j}from"./index.ab904951.js";import{j as x,i as k,t as L,o as P,a5 as F,F as R,N as w,a6 as O,z as A,a9 as S,aa as _,n as T,D as z,B as D,L as E,e as U,w as B,J as I,v as V,q,S as H}from"./@vue.23a4bd1a.js";import{_ as M}from"./lodash.d7ab6f48.js";/* empty css                                                             */import"./element-plus.b44d97a8.js";import"./BaseNotice.93ee8e4e.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vuex.c868d4e0.js";import"./public.9c1d8f39.js";import"./axios.7b768d2b.js";import"./BaseName.1aa32b4b.js";import"./batch-processor.94093b2a.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./dayjs.bad04745.js";import"./nprogress.8b4927f9.js";import"./default-passive-events.74004992.js";import"./resize-observer-polyfill.d4249adb.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";const Y={props:{data:{type:Object,default:()=>({})},time:{type:String,default:()=>""}},setup(e){const t=x({list:[],value:null});return k((()=>e.data),(e=>{e&&(({list:e})=>{let a=[];t.list=[];let l=!1;e.forEach(((e,o)=>{(o+1)%52==0?(t.list.push(a),a=[],l=!1):(a.push(e),l=!0)})),l&&t.list.push(a)})(e)})),r({},L(t))}},G=e=>(S("data-v-73e4ee62"),e=e(),_(),e),J={class:"table-print"},Z=G((()=>O("div",{class:"title",style:{"font-size":"24px","text-align":"center"}}," 盘点单打印 ",-1))),$={style:{display:"flex","justify-content":"space-between",margin:"0 2%"}},W={cellspacing:"0",style:{margin:"0 2%",width:"96%","border-top":"1px solid #000","border-left":"1px solid #000"}},K=G((()=>O("tr",null,[O("th",null,"编码"),O("th",null,"商品"),O("th",null,"规格"),O("th",null,"厂家"),O("th",null,"批号"),O("th",null,"有效期至"),O("th",null,"柜组"),O("th",null,"库存"),O("th",null,"实盘数量")],-1))),Q={style:{width:"90px"}},X={style:{width:"100px"}},ee={style:{width:"100px"}},te={style:{width:"90px"}},ae={style:{width:"90px"}},le={style:{width:"80px"}},oe={style:{width:"60px"}},ie={style:{width:"80px","text-align":"right"}},se={style:{width:"70px","text-align":"right"}},re={style:{"text-align":"right",padding:"0 20px"}};const me={name:"InventoryAdd",components:{Print:j(Y,[["render",function(e,t,a,l,o,i){return P(),F("div",J,[(P(!0),F(R,null,w(e.list,((t,l)=>(P(),F("div",{key:l,style:{padding:"10px 0 0"}},[Z,O("div",$,[O("div",null,"盘点单号: "+A(a.data.inventoryNo),1),O("div",null,"打印时间："+A(a.time),1)]),O("table",W,[K,(P(!0),F(R,null,w(t,(e=>(P(),F("tr",{key:e.uuid},[O("td",null,[O("span",Q,A(e.code.slice(0,10)),1)]),O("td",null,[O("span",X,A(e.productName),1)]),O("td",null,[O("span",ee,A(e.specification),1)]),O("td",null,[O("span",te,A(e.manufacturer),1)]),O("td",null,[O("span",ae,A(e.batchNum),1)]),O("td",null,[O("span",le,A(e.indate),1)]),O("td",null,[O("span",oe,A(e.cabinetGroupName),1)]),O("td",null,[O("span",ie,A(e.overallPackNum+e.unit+(e.deleavePackNum?e.deleavePackNum+e.splitUnit:"")),1)]),O("td",null,[O("span",se,A(e.overallRealNum),1)])])))),128))]),O("div",re,A(l+1)+"/"+A(e.list.length),1)])))),128))])}],["__scopeId","data-v-73e4ee62"]])},setup(e,t){v();const a=h(),l=x({active:"0",cache:[]}),o=e=>{let t=l.cache,a=M.findIndex(t,{uuid:e.uuid});a<0?l.cache.push(e):l.cache.splice(a,1,e)},i=x({getCabinetgroupList:[],checked:!0,printObj:{id:"printMe",popTitle:"盘点打印表",extraHead:'<meta http-equiv="Content-Language"content="zh-cn"/>',beforeOpenCallback:async e=>{},openCallback(e){},closeCallback(e){}}}),s=x({data:{}}),u=x({overallReal:{overallRealNum:"",deleaveRealNum:""},isClear:!1,time:"",close:!1,go:{path:"/storage/inventory"},formData:{labelWidth:"70px",inline:!0,list:[{label:"门店",type:"INPUT",key:"business",disabled:()=>!0},{label:"商品名称",type:"INPUT",key:"productName",placeholder:"请输入商品名称/助记码/编码"},{label:"差异状态",type:"SELECT",disabled:()=>"0"===l.active,key:"differences",list:()=>[{value:"0",label:"无差异"},{value:"1",label:"盘损"},{value:"2",label:"盘溢"}]},{type:"SELECT",label:"柜组",key:"cabinetGroupUuid",list:()=>i.getCabinetgroupList,props:{label:"name",value:"uuid"}}]},submitForm:{"page.currentPage":1,"page.pageSize":10,realNumNeZero:1},compList:[],compListDetail:[],notCompList:[],columns:N(o,"",!1,q,s),compListCount:0,notCompListCount:0,data:{},compObject:{}}),n=e=>{u.submitForm["page.currentPage"]=1,u.submitForm["page.pageSize"]=10,j()},c=async()=>{let{list:e,totalCount:t}=await p(m(r({},u.submitForm),{state:Number(l.active)}));var a,o;u.compList=(a=e,o=l.cache,a.forEach(((e,t)=>{let{uuid:l}=e,i=M.find(o,{uuid:l});i&&(a[t]=i)})),a),"0"===l.active&&(u.compObject[u.submitForm["page.currentPage"]-1]=u.compList),u.submitForm.total=t,s.data=await b(u.submitForm),u.data=s.data},j=()=>{c(),P()},P=async()=>{let{compListCount:e,notCompListCount:t}=await f(u.submitForm);u.compListCount=e,u.notCompListCount=t,i.getCabinetgroupList=await g()};return T((()=>{(()=>{const e=y();setTimeout((()=>{e.listenTo(document.getElementById("tab"),(e=>{q((()=>{u.height=e.offsetHeight-285}))}))}),200)})()})),z((()=>{let e=JSON.parse(a.query.row);e.uuid!==u.submitForm.uuid&&(u.submitForm=m(r(r({},u.submitForm),e),{inventoryUuid:e.uuid}),c(),P())})),k((()=>u.compObject),((e,t)=>{if(e){let t=0,a=0,l=0,o=0;for(let i in e)e[i].map((e=>{t=Number(t)+Number(e.firmOfferCostAmount),a=Number(a)+Number(e.profitLossCostAmount),l=Number(l)+Number(e.firmRetailAmount),o=Number(o)+Number(e.profitLossRetailAmount)}));u.submitForm.firmOfferCostAmount=t.toFixed(2),u.submitForm.profitLossCostAmount=a.toFixed(2),u.submitForm.firmRetailAmount=l.toFixed(2),u.submitForm.profitLossRetailAmount=o.toFixed(2)}}),{deep:!0}),m(r(r(r({},L(l)),L(u)),L(i)),{handleSubmit:async()=>{let{cache:e}=l,{submitForm:t}=u;await d({details:e,inventoryUuid:t.uuid}),u.close=!0},getDetail:c,setCache:o,getCount:P,handleSetNumber:e=>{u.compList.forEach((t=>{if("number"==typeof e)t.overallRealNum=0,t.deleaveRealNum=0;else{let{overallPackNum:e,deleavePackNum:a}=t;t.overallRealNum=e,t.deleaveRealNum=a}t.overallProfitLossNum=(1e6*Number(t.overallRealNum)-1e6*Number(t.overallPackNum))/1e6,t.firmOfferCostAmount=(Number(t.overallRealNum)*Number(t.overallPackPrice)+Number(t.deleaveRealNum)*Number(t.deleavePackPrice)).toFixed(2),t.profitLossCostAmount=(Number(t.overallProfitLossNum)*Number(t.overallPackPrice)+Number(t.deleaveProfitLossNum)*Number(t.deleavePackPrice)).toFixed(2),t.firmRetailAmount=Number(t.overallRealNum)*Number(t.fullRetailPrice)+Number(t.deleaveRealNum)*(t.isSplit?Number(t.fullRetailPrice)/Number(t.conversionRatio):0),t.profitLossRetailAmount=Number(t.overallProfitLossNum)*Number(t.fullRetailPrice)+Number(t.deleaveRealNum)*(t.isSplit?Number(t.fullRetailPrice)/Number(t.conversionRatio):0),o(t)}))},handleClick:n,query:j,handleCheckChange:e=>{u.submitForm.realNumNeZero=e?1:0,n()},handlePrintClick:()=>{u.time=C().format("YYYY-MM-DD HH:mm:ss")}})}},ue=(e=>(S("data-v-a5dfd504"),e=e(),_(),e))((()=>O("div",{class:"title"},"编辑盘点任务",-1))),ne=H(" 完成 "),ce={class:"top-content"},de={class:"tabs-box"},pe={key:0,class:"options"},be=H("只显示账面数量/实盘不为0"),fe=[H("打印")],ve={class:"result"},he={class:"box"},Ne={class:"text"},ye=H(" 实盘总成本金额合计： "),ge={style:{color:"#1890ff"}},Ce=H(" 元 "),je={class:"text"},xe=H(" 盈亏总成本金额合计： "),ke={style:{color:"#f56c6c"}},Le=H(" 元 "),Pe={class:"text"},Fe=H(" 实盘零售金额合计： "),Re={style:{color:"#1890ff"}},we=H(" 元 "),Oe={class:"text"},Ae=H(" 盈亏零售金额合计： "),Se={style:{color:"#f56c6c"}},_e=H(" 元 ");var Te=j(me,[["render",function(e,t,a,l,o,i){const s=D("el-button"),r=u,m=D("el-checkbox"),d=n,p=D("el-tab-pane"),b=D("el-tabs"),f=c,v=D("Print"),h=E("print");return P(),F(R,null,[U(f,{close:e.close,route:e.go,class:"inventory base-stencil","t-id":"tab"},{header:B((()=>[ue,O("div",null,[U(s,{type:"primary",size:"medium",onClick:l.handleSubmit},{default:B((()=>[ne])),_:1},8,["onClick"])])])),top:B((()=>[O("div",ce,[U(r,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),options:!0,select:l.query,isClear:e.isClear},null,8,["form-data","submit-form","select","isClear"])])])),default:B((()=>[O("div",de,["0"==e.active?(P(),F("div",pe,[U(m,{modelValue:e.checked,"onUpdate:modelValue":t[1]||(t[1]=t=>e.checked=t),onChange:l.handleCheckChange},{default:B((()=>[be])),_:1},8,["modelValue","onChange"]),I(O("button",{onClick:t[2]||(t[2]=(...e)=>l.handlePrintClick&&l.handlePrintClick(...e))},fe,512),[[h,e.printObj]]),O("button",{onClick:t[3]||(t[3]=e=>l.handleSetNumber(0))},"实盘数量清0"),O("button",{onClick:t[4]||(t[4]=e=>l.handleSetNumber())},"实盘数量等于账面数量")])):V("",!0),U(b,{modelValue:e.active,"onUpdate:modelValue":t[5]||(t[5]=t=>e.active=t),onTabClick:l.handleClick},{default:B((()=>[U(p,{label:`未盘商品批号(${e.notCompListCount})`,name:"0"},{default:B((()=>[O("div",null,[O("div",ve,[O("div",he,[O("div",Ne,[ye,O("span",ge,A(e.submitForm.firmOfferCostAmount),1),Ce]),O("div",je,[xe,O("span",ke,A(e.submitForm.profitLossCostAmount),1),Le]),O("div",Pe,[Fe,O("span",Re,A(e.submitForm.firmRetailAmount),1),we]),O("div",Oe,[Ae,O("span",Se,A(e.submitForm.profitLossRetailAmount),1),_e])])]),U(d,{columns:e.columns.notCompList,"table-data":e.compList,optionShow:!1,select:l.getDetail,pagination:e.submitForm,"class-id":"tab","reduce-num":120},null,8,["columns","table-data","select","pagination"])])])),_:1},8,["label"]),U(p,{label:`已盘商品批号(${e.compListCount})`,name:"1"},{default:B((()=>[U(d,{columns:e.columns.compList,"table-data":e.compList,optionShow:!1,select:l.getDetail,pagination:e.submitForm,"class-id":"tab","reduce-num":74},null,8,["columns","table-data","select","pagination"])])),_:1},8,["label"])])),_:1},8,["modelValue","onTabClick"])])])),_:1},8,["close","route"]),U(v,{id:"printMe",data:e.data,time:e.time},null,8,["data","time"])],64)}],["__scopeId","data-v-a5dfd504"]]);export{Te as default};
