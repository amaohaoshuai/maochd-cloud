var e=Object.defineProperty,t=Object.defineProperties,s=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,o=(t,s,i)=>s in t?e(t,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[s]=i,r=(e,t)=>{for(var s in t||(t={}))a.call(t,s)&&o(e,s,t[s]);if(i)for(var s of i(t))l.call(t,s)&&o(e,s,t[s]);return e};import{_ as n}from"./BaseForm.bc55ad6b.js";import{_ as d}from"./BaseTable.36f55649.js";import{_ as c}from"./BaseName.1aa32b4b.js";import{u as m}from"./vuex.c868d4e0.js";import{b as u,_ as p}from"./element-plus.b44d97a8.js";import{s as b,g as f}from"./businessRule.60794e55.js";import{r as y,_ as h}from"./index.ab904951.js";import{a as L,b as g,c as j,d as v,e as k}from"./index.e7529637.js";import"./lodash.d7ab6f48.js";import{j as w,e as I,B as x,S as D,D as U,t as W,o as S,a5 as T,w as B,a6 as C,z as _}from"./@vue.23a4bd1a.js";import"./TempHtml.vue_vue&type=script&lang.67ba229f.js";import"./sortablejs.621e50ab.js";import"./vue-router.91336ba9.js";import"./element-resize-detector.5b0b5621.js";import"./batch-processor.94093b2a.js";/* empty css                                                             */import"./resize-observer-polyfill.d4249adb.js";import"./dayjs.bad04745.js";import"./normalize-wheel.1d574cd1.js";import"./mitt.32ebca9f.js";import"./async-validator.1fa0d626.js";import"./@popperjs.192dcd39.js";import"./vue.6d04e91d.js";import"./echarts.e8cef18b.js";import"./tslib.34a40861.js";import"./zrender.5bef55a0.js";import"./vue3-print-nb.eccf419a.js";import"./nprogress.8b4927f9.js";import"./axios.7b768d2b.js";import"./default-passive-events.74004992.js";var E={name:"InventoryWarning",setup(){let e=m(),o=w({storeList:[],selectArr:[]}),n=w({baseNameList:["name","specification","unit","manufacturer"],multipleSelectionList2:[],editLowerLimit:!1,editBtn:"编辑",isClear:!1,chooseListId:[],chooseList:[],tableData:[],columns:[{type:"selection",fixed:"left"},{title:"序号",type:"index",fixed:"left",width:52},{title:"门店",key:"business",width:120},{title:"商品编码",width:150,render:e=>I("div",null,[e.productInfo.code?e.productInfo.code:"-"])},{title:"商品名称/规格/单位/生产厂家",render:e=>I(c,{row:e.productInfo,list:n.baseNameList},null)},{title:"库存数量",key:"concatStockNum",width:150,render:e=>e.numWarnFlag?I("div",{style:"color:red;"},[e.concatStockNum?e.concatStockNum:"-"]):I("div",null,[e.concatStockNum?e.concatStockNum:"-"])},{title:"可周转",key:"days",width:150,render:e=>e.daysWarnFlag?I("div",{style:"color:red;"},[e.days&&"-"!=e.days?e.days+"天":e.days]):I("div",null,[e.days&&"-"!=e.days?e.days+"天":e.days])},{title:"数量预警下限",key:"numLimit",width:150,render:e=>n.editLowerLimit?e.numLimit?I(x("el-input-number"),{size:"small",min:1,max:9999,step:1,"step-strictly":!0,modelValue:e.numLimit,"onUpdate:modelValue":t=>e.numLimit=t},null):void 0:I("div",null,[e.numLimit])},{title:"周转天数预警下限",key:"daysLimit",width:150,render:e=>n.editLowerLimit?e.sellDays?I(x("el-input-number"),{size:"small",min:1,max:9999,step:1,"step-strictly":!0,modelValue:e.daysLimit,"onUpdate:modelValue":t=>e.daysLimit=t,disabled:!e.sellDays},null):I("div",null,null):I("div",null,[e.daysLimit])},{title:"操作",key:"options",width:120,render:(e,t,s,i)=>I(x("el-button"),{type:"text",class:"delete",onClick:()=>{h(e)}},{default:()=>[D("删除")]})}],formData:{labelWidth:"70px",span:8,inline:!0,list:[{type:"SELECT",placeholder:"门店",list:()=>o.storeList,config:{multiple:!0},key:"businessUuid",props:{label:"name",value:"uuid"}},{type:"INPUT",placeholder:"编码/助记码/商品名称/条码",key:"keyword"}]},submitForm:{"page.currentPage":1,"page.pageSize":10,businessUuid:[],keyword:""}});const d=async()=>{let e=n.submitForm,{businessUuid:t}=e,s=((e,t)=>{var s={};for(var o in e)a.call(e,o)&&t.indexOf(o)<0&&(s[o]=e[o]);if(null!=e&&i)for(var o of i(e))t.indexOf(o)<0&&l.call(e,o)&&(s[o]=e[o]);return s})(e,["businessUuid"]);t=b(t);let o=r({businessUuid:t},s);k(o).then((e=>{n.tableData=e.records,n.submitForm.total=e.total,n.tableData.map((e=>{e.productInfo.name=e.productInfo.productName}))}))},h=e=>{u.confirm("确认删除?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{L(e.stockWarnUuid).then((t=>{n.tableData.forEach(((t,s)=>{t.stockWarnUuid===e.stockWarnUuid&&n.tableData.splice(s,1)})),d()}))}))};return U((async()=>{o.storeList=await e.dispatch("common/mechanism"),f(o.storeList,n,n.formData),d()})),S=r(r({},W(o)),W(n)),t(S,s({batchDelete:()=>{0==n.chooseListId?p.warning({message:"还未选择商品！",type:"warning"}):u.confirm("确定要删除所添加的商品吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{let e=n.chooseListId.join(",");g(e).then((()=>{d(),n.chooseListId=[]}))}))},batchEditing:async()=>{if(0!==n.tableData.length)if("编辑"===n.editBtn)n.editLowerLimit=!0,n.editBtn="保存";else{n.editLowerLimit=!1,n.editBtn="编辑";let e=[],t={};n.tableData.map((s=>{t={daysLimit:s.daysLimit,numLimit:s.numLimit,sellDays:s.sellDays,stockWarnUuid:s.stockWarnUuid},e.push(t)})),await j(e);let s={stockWarns:n.tableData};await v(s),d()}else p.warning("请至少添加一种预警商品!")},newlyAdded:()=>{y.push({name:"AddInventoryWarning"})},singleSelection:(e,t)=>{n.chooseListId.includes(t.stockWarnUuid)?n.chooseListId.forEach(((e,s)=>{e===t.stockWarnUuid&&(n.chooseListId.splice(s,1),n.chooseList.splice(s,1))})):(n.chooseListId.push(t.stockWarnUuid),n.chooseList.push(t))},allSelection:e=>{e.length>0?e.forEach((e=>{n.chooseListId.includes(e.stockWarnUuid)||(n.chooseListId.push(e.stockWarnUuid),n.chooseList.push(e))})):n.tableData.forEach((e=>{n.chooseListId.forEach(((t,s)=>{t===e.stockWarnUuid&&(n.chooseListId.splice(s,1),n.chooseList.splice(s,1))}))}))},delTable:h,getEarlyWarning:d,multipleSelectionTable:e=>{n.multipleSelectionList2=e}}));var S}};const N={class:"stencil",id:"tab"},z={class:"top"},O={class:"box"},F={class:"content"},P={class:"getInfo"},A=D(" 批量删除 "),V=D(" 新增 ");var R=h(E,[["render",function(e,t,s,i,a,l){const o=n,r=x("el-button"),c=d,m=x("el-scrollbar");return S(),T("div",N,[I(m,null,{default:B((()=>[C("div",z,[C("div",O,[I(o,{"form-data":e.formData,"submit-form":e.submitForm,"onUpdate:submit-form":t[0]||(t[0]=t=>e.submitForm=t),select:i.getEarlyWarning,options:!0,isClear:e.isClear},null,8,["form-data","submit-form","select","isClear"])])]),C("div",F,[I(c,{class:"select-table",columns:e.columns,"table-data":e.tableData,pagination:e.submitForm,"fixed-head":!1,delTable:i.delTable,"single-select":i.singleSelection,"all-select":i.allSelection,formConfig:{highlightCurrentRow:!0},select:i.getEarlyWarning,multipleSelection:i.multipleSelectionTable,ref:"baseTable",classId:"tab",reduceNum:60},{buttons:B((()=>[C("div",P,[I(r,{type:"danger",size:"small",onClick:i.batchDelete},{default:B((()=>[A])),_:1},8,["onClick"]),I(r,{type:"primary",size:"small",onClick:i.batchEditing},{default:B((()=>[D(_(e.editBtn),1)])),_:1},8,["onClick"]),I(r,{type:"primary",size:"small",onClick:i.newlyAdded,plain:""},{default:B((()=>[V])),_:1},8,["onClick"])])])),_:1},8,["columns","table-data","pagination","delTable","single-select","all-select","select","multipleSelection"])])])),_:1})])}],["__scopeId","data-v-1f2fa472"]]);export{R as default};
